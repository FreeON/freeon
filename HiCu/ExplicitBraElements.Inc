       Z=Prim%Zeta
       TwoZ=Two*Prim%Zeta
       SELECT CASE(Prim%Ell)
       CASE(0)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                Wght=Cube%Wght(I)
                IF(NSDen.EQ.1)THEN
                  dEdRho=Cube%Vals(I,1)
                  dEdAbsGradRho2=Cube%Vals(I,2)
                  GradRhoX=Cube%Vals(I,3)
                  GradRhoY=Cube%Vals(I,4)
                  GradRhoZ=Cube%Vals(I,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(1)=Ket(1)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                ELSEIF(NSDen.EQ.3)THEN
                  I1=I+  NGrid
                  I2=I+2*NGrid
                  dEdRhoA=Cube%Vals(I ,1)
                  dEdRhoB=Cube%Vals(I1,1)
                  dEdAbsGradRho2AA=Cube%Vals(I ,2)
                  dEdAbsGradRho2BB=Cube%Vals(I1,2)
                  dEdAbsGradRho2AB=Cube%Vals(I2,2)
                  GradRhoXA=Cube%Vals(I ,3)
                  GradRhoYA=Cube%Vals(I ,4)
                  GradRhoZA=Cube%Vals(I ,5)
                  GradRhoXB=Cube%Vals(I1,3)
                  GradRhoYB=Cube%Vals(I1,4)
                  GradRhoZB=Cube%Vals(I1,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  LMN1=1
                  LMN2=1+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                ELSE
                  CALL Halt('ExplicitBraElements.Inc: Wrong NSDen')
                ENDIF
             ENDIF
          ENDDO
       CASE(1)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                Wght=Cube%Wght(I)
                IF(NSDen.EQ.1)THEN
                  dEdRho=Cube%Vals(I,1)
                  dEdAbsGradRho2=Cube%Vals(I,2)
                  GradRhoX=Cube%Vals(I,3)
                  GradRhoY=Cube%Vals(I,4)
                  GradRhoZ=Cube%Vals(I,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(1)=Ket(1)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(4)=Ket(4)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(3)=Ket(3)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(2)=Ket(2)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                ELSEIF(NSDen.EQ.3)THEN
                  I1=I+  NGrid
                  I2=I+2*NGrid
                  dEdRhoA=Cube%Vals(I ,1)
                  dEdRhoB=Cube%Vals(I1,1)
                  dEdAbsGradRho2AA=Cube%Vals(I ,2)
                  dEdAbsGradRho2BB=Cube%Vals(I1,2)
                  dEdAbsGradRho2AB=Cube%Vals(I2,2)
                  GradRhoXA=Cube%Vals(I ,3)
                  GradRhoYA=Cube%Vals(I ,4)
                  GradRhoZA=Cube%Vals(I ,5)
                  GradRhoXB=Cube%Vals(I1,3)
                  GradRhoYB=Cube%Vals(I1,4)
                  GradRhoZB=Cube%Vals(I1,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  LMN1=1
                  LMN2=1+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  LMN1=4
                  LMN2=4+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  LMN1=3
                  LMN2=3+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  LMN1=2
                  LMN2=2+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                ELSE
                  CALL Halt('ExplicitBraElements.Inc: Wrong NSDen')
                ENDIF
             ENDIF
          ENDDO
       CASE(2)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaX(3)=TwoZ*(RPX*LambdaX(2)-2.D0*LambdaX(1))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaY(3)=TwoZ*(RPY*LambdaY(2)-2.D0*LambdaY(1))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                LambdaZ(3)=TwoZ*(RPZ*LambdaZ(2)-2.D0*LambdaZ(1))
                Wght=Cube%Wght(I)
                IF(NSDen.EQ.1)THEN
                  dEdRho=Cube%Vals(I,1)
                  dEdAbsGradRho2=Cube%Vals(I,2)
                  GradRhoX=Cube%Vals(I,3)
                  GradRhoY=Cube%Vals(I,4)
                  GradRhoZ=Cube%Vals(I,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(1)=Ket(1)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(4)=Ket(4)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(10)=Ket(10)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(3)=Ket(3)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(9)=Ket(9)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(7)=Ket(7)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(2)=Ket(2)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(8)=Ket(8)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(6)=Ket(6)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(5)=Ket(5)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                ELSEIF(NSDen.EQ.3)THEN
                  I1=I+  NGrid
                  I2=I+2*NGrid
                  dEdRhoA=Cube%Vals(I ,1)
                  dEdRhoB=Cube%Vals(I1,1)
                  dEdAbsGradRho2AA=Cube%Vals(I ,2)
                  dEdAbsGradRho2BB=Cube%Vals(I1,2)
                  dEdAbsGradRho2AB=Cube%Vals(I2,2)
                  GradRhoXA=Cube%Vals(I ,3)
                  GradRhoYA=Cube%Vals(I ,4)
                  GradRhoZA=Cube%Vals(I ,5)
                  GradRhoXB=Cube%Vals(I1,3)
                  GradRhoYB=Cube%Vals(I1,4)
                  GradRhoZB=Cube%Vals(I1,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  LMN1=1
                  LMN2=1+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  LMN1=4
                  LMN2=4+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  LMN1=10
                  LMN2=10+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  LMN1=3
                  LMN2=3+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  LMN1=9
                  LMN2=9+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  LMN1=7
                  LMN2=7+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  LMN1=2
                  LMN2=2+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  LMN1=8
                  LMN2=8+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  LMN1=6
                  LMN2=6+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  LMN1=5
                  LMN2=5+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                ELSE
                  CALL Halt('ExplicitBraElements.Inc: Wrong NSDen')
                ENDIF
             ENDIF
          ENDDO
       CASE(3)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaX(3)=TwoZ*(RPX*LambdaX(2)-2.D0*LambdaX(1))
                LambdaX(4)=TwoZ*(RPX*LambdaX(3)-3.D0*LambdaX(2))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaY(3)=TwoZ*(RPY*LambdaY(2)-2.D0*LambdaY(1))
                LambdaY(4)=TwoZ*(RPY*LambdaY(3)-3.D0*LambdaY(2))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                LambdaZ(3)=TwoZ*(RPZ*LambdaZ(2)-2.D0*LambdaZ(1))
                LambdaZ(4)=TwoZ*(RPZ*LambdaZ(3)-3.D0*LambdaZ(2))
                Wght=Cube%Wght(I)
                IF(NSDen.EQ.1)THEN
                  dEdRho=Cube%Vals(I,1)
                  dEdAbsGradRho2=Cube%Vals(I,2)
                  GradRhoX=Cube%Vals(I,3)
                  GradRhoY=Cube%Vals(I,4)
                  GradRhoZ=Cube%Vals(I,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(1)=Ket(1)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(4)=Ket(4)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(10)=Ket(10)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(20)=Ket(20)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(3)=Ket(3)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(9)=Ket(9)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(19)=Ket(19)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(7)=Ket(7)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(17)=Ket(17)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(14)=Ket(14)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(2)=Ket(2)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(8)=Ket(8)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(18)=Ket(18)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(6)=Ket(6)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(16)=Ket(16)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(13)=Ket(13)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(5)=Ket(5)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(15)=Ket(15)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(12)=Ket(12)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(11)=Ket(11)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                ELSEIF(NSDen.EQ.3)THEN
                  I1=I+  NGrid
                  I2=I+2*NGrid
                  dEdRhoA=Cube%Vals(I ,1)
                  dEdRhoB=Cube%Vals(I1,1)
                  dEdAbsGradRho2AA=Cube%Vals(I ,2)
                  dEdAbsGradRho2BB=Cube%Vals(I1,2)
                  dEdAbsGradRho2AB=Cube%Vals(I2,2)
                  GradRhoXA=Cube%Vals(I ,3)
                  GradRhoYA=Cube%Vals(I ,4)
                  GradRhoZA=Cube%Vals(I ,5)
                  GradRhoXB=Cube%Vals(I1,3)
                  GradRhoYB=Cube%Vals(I1,4)
                  GradRhoZB=Cube%Vals(I1,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  LMN1=1
                  LMN2=1+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  LMN1=4
                  LMN2=4+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  LMN1=10
                  LMN2=10+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  LMN1=20
                  LMN2=20+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  LMN1=3
                  LMN2=3+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  LMN1=9
                  LMN2=9+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  LMN1=19
                  LMN2=19+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  LMN1=7
                  LMN2=7+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  LMN1=17
                  LMN2=17+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  LMN1=14
                  LMN2=14+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  LMN1=2
                  LMN2=2+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  LMN1=8
                  LMN2=8+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  LMN1=18
                  LMN2=18+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  LMN1=6
                  LMN2=6+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  LMN1=16
                  LMN2=16+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  LMN1=13
                  LMN2=13+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  LMN1=5
                  LMN2=5+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  LMN1=15
                  LMN2=15+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  LMN1=12
                  LMN2=12+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  LMN1=11
                  LMN2=11+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                ELSE
                  CALL Halt('ExplicitBraElements.Inc: Wrong NSDen')
                ENDIF
             ENDIF
          ENDDO
       CASE(4)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaX(3)=TwoZ*(RPX*LambdaX(2)-2.D0*LambdaX(1))
                LambdaX(4)=TwoZ*(RPX*LambdaX(3)-3.D0*LambdaX(2))
                LambdaX(5)=TwoZ*(RPX*LambdaX(4)-4.D0*LambdaX(3))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaY(3)=TwoZ*(RPY*LambdaY(2)-2.D0*LambdaY(1))
                LambdaY(4)=TwoZ*(RPY*LambdaY(3)-3.D0*LambdaY(2))
                LambdaY(5)=TwoZ*(RPY*LambdaY(4)-4.D0*LambdaY(3))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                LambdaZ(3)=TwoZ*(RPZ*LambdaZ(2)-2.D0*LambdaZ(1))
                LambdaZ(4)=TwoZ*(RPZ*LambdaZ(3)-3.D0*LambdaZ(2))
                LambdaZ(5)=TwoZ*(RPZ*LambdaZ(4)-4.D0*LambdaZ(3))
                Wght=Cube%Wght(I)
                IF(NSDen.EQ.1)THEN
                  dEdRho=Cube%Vals(I,1)
                  dEdAbsGradRho2=Cube%Vals(I,2)
                  GradRhoX=Cube%Vals(I,3)
                  GradRhoY=Cube%Vals(I,4)
                  GradRhoZ=Cube%Vals(I,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(1)=Ket(1)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(4)=Ket(4)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(10)=Ket(10)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(20)=Ket(20)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(35)=Ket(35)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(3)=Ket(3)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(9)=Ket(9)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(19)=Ket(19)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(34)=Ket(34)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(7)=Ket(7)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(17)=Ket(17)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(32)=Ket(32)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(14)=Ket(14)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(29)=Ket(29)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(25)=Ket(25)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(2)=Ket(2)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(8)=Ket(8)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(18)=Ket(18)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(33)=Ket(33)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(6)=Ket(6)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(16)=Ket(16)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(31)=Ket(31)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(13)=Ket(13)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(28)=Ket(28)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(24)=Ket(24)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(5)=Ket(5)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(15)=Ket(15)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(30)=Ket(30)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(12)=Ket(12)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(27)=Ket(27)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(23)=Ket(23)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(11)=Ket(11)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(26)=Ket(26)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(22)=Ket(22)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(21)=Ket(21)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                ELSEIF(NSDen.EQ.3)THEN
                  I1=I+  NGrid
                  I2=I+2*NGrid
                  dEdRhoA=Cube%Vals(I ,1)
                  dEdRhoB=Cube%Vals(I1,1)
                  dEdAbsGradRho2AA=Cube%Vals(I ,2)
                  dEdAbsGradRho2BB=Cube%Vals(I1,2)
                  dEdAbsGradRho2AB=Cube%Vals(I2,2)
                  GradRhoXA=Cube%Vals(I ,3)
                  GradRhoYA=Cube%Vals(I ,4)
                  GradRhoZA=Cube%Vals(I ,5)
                  GradRhoXB=Cube%Vals(I1,3)
                  GradRhoYB=Cube%Vals(I1,4)
                  GradRhoZB=Cube%Vals(I1,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  LMN1=1
                  LMN2=1+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  LMN1=4
                  LMN2=4+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  LMN1=10
                  LMN2=10+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  LMN1=20
                  LMN2=20+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  LMN1=35
                  LMN2=35+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  LMN1=3
                  LMN2=3+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  LMN1=9
                  LMN2=9+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  LMN1=19
                  LMN2=19+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  LMN1=34
                  LMN2=34+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  LMN1=7
                  LMN2=7+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  LMN1=17
                  LMN2=17+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  LMN1=32
                  LMN2=32+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  LMN1=14
                  LMN2=14+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  LMN1=29
                  LMN2=29+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  LMN1=25
                  LMN2=25+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  LMN1=2
                  LMN2=2+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  LMN1=8
                  LMN2=8+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  LMN1=18
                  LMN2=18+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  LMN1=33
                  LMN2=33+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  LMN1=6
                  LMN2=6+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  LMN1=16
                  LMN2=16+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  LMN1=31
                  LMN2=31+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  LMN1=13
                  LMN2=13+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  LMN1=28
                  LMN2=28+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  LMN1=24
                  LMN2=24+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  LMN1=5
                  LMN2=5+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  LMN1=15
                  LMN2=15+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  LMN1=30
                  LMN2=30+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  LMN1=12
                  LMN2=12+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  LMN1=27
                  LMN2=27+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  LMN1=23
                  LMN2=23+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  LMN1=11
                  LMN2=11+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  LMN1=26
                  LMN2=26+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  LMN1=22
                  LMN2=22+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  LMN1=21
                  LMN2=21+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                ELSE
                  CALL Halt('ExplicitBraElements.Inc: Wrong NSDen')
                ENDIF
             ENDIF
          ENDDO
       CASE(5)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaX(3)=TwoZ*(RPX*LambdaX(2)-2.D0*LambdaX(1))
                LambdaX(4)=TwoZ*(RPX*LambdaX(3)-3.D0*LambdaX(2))
                LambdaX(5)=TwoZ*(RPX*LambdaX(4)-4.D0*LambdaX(3))
                LambdaX(6)=TwoZ*(RPX*LambdaX(5)-5.D0*LambdaX(4))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaY(3)=TwoZ*(RPY*LambdaY(2)-2.D0*LambdaY(1))
                LambdaY(4)=TwoZ*(RPY*LambdaY(3)-3.D0*LambdaY(2))
                LambdaY(5)=TwoZ*(RPY*LambdaY(4)-4.D0*LambdaY(3))
                LambdaY(6)=TwoZ*(RPY*LambdaY(5)-5.D0*LambdaY(4))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                LambdaZ(3)=TwoZ*(RPZ*LambdaZ(2)-2.D0*LambdaZ(1))
                LambdaZ(4)=TwoZ*(RPZ*LambdaZ(3)-3.D0*LambdaZ(2))
                LambdaZ(5)=TwoZ*(RPZ*LambdaZ(4)-4.D0*LambdaZ(3))
                LambdaZ(6)=TwoZ*(RPZ*LambdaZ(5)-5.D0*LambdaZ(4))
                Wght=Cube%Wght(I)
                IF(NSDen.EQ.1)THEN
                  dEdRho=Cube%Vals(I,1)
                  dEdAbsGradRho2=Cube%Vals(I,2)
                  GradRhoX=Cube%Vals(I,3)
                  GradRhoY=Cube%Vals(I,4)
                  GradRhoZ=Cube%Vals(I,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(1)=Ket(1)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(4)=Ket(4)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(10)=Ket(10)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(20)=Ket(20)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(35)=Ket(35)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(56)=Ket(56)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(3)=Ket(3)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(9)=Ket(9)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(19)=Ket(19)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(34)=Ket(34)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(55)=Ket(55)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(7)=Ket(7)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(17)=Ket(17)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(32)=Ket(32)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(53)=Ket(53)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(14)=Ket(14)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(29)=Ket(29)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(50)=Ket(50)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(25)=Ket(25)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(46)=Ket(46)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(41)=Ket(41)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(2)=Ket(2)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(8)=Ket(8)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(18)=Ket(18)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(33)=Ket(33)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(54)=Ket(54)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(6)=Ket(6)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(16)=Ket(16)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(31)=Ket(31)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(52)=Ket(52)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(13)=Ket(13)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(28)=Ket(28)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(49)=Ket(49)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(24)=Ket(24)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(45)=Ket(45)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(40)=Ket(40)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(5)=Ket(5)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(15)=Ket(15)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(30)=Ket(30)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(51)=Ket(51)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(12)=Ket(12)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(27)=Ket(27)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(48)=Ket(48)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(23)=Ket(23)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(44)=Ket(44)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(39)=Ket(39)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(11)=Ket(11)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(26)=Ket(26)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(47)=Ket(47)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(22)=Ket(22)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(43)=Ket(43)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(38)=Ket(38)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(21)=Ket(21)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(42)=Ket(42)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(37)=Ket(37)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(36)=Ket(36)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                ELSEIF(NSDen.EQ.3)THEN
                  I1=I+  NGrid
                  I2=I+2*NGrid
                  dEdRhoA=Cube%Vals(I ,1)
                  dEdRhoB=Cube%Vals(I1,1)
                  dEdAbsGradRho2AA=Cube%Vals(I ,2)
                  dEdAbsGradRho2BB=Cube%Vals(I1,2)
                  dEdAbsGradRho2AB=Cube%Vals(I2,2)
                  GradRhoXA=Cube%Vals(I ,3)
                  GradRhoYA=Cube%Vals(I ,4)
                  GradRhoZA=Cube%Vals(I ,5)
                  GradRhoXB=Cube%Vals(I1,3)
                  GradRhoYB=Cube%Vals(I1,4)
                  GradRhoZB=Cube%Vals(I1,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  LMN1=1
                  LMN2=1+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  LMN1=4
                  LMN2=4+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  LMN1=10
                  LMN2=10+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  LMN1=20
                  LMN2=20+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  LMN1=35
                  LMN2=35+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  LMN1=56
                  LMN2=56+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  LMN1=3
                  LMN2=3+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  LMN1=9
                  LMN2=9+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  LMN1=19
                  LMN2=19+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  LMN1=34
                  LMN2=34+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  LMN1=55
                  LMN2=55+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  LMN1=7
                  LMN2=7+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  LMN1=17
                  LMN2=17+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  LMN1=32
                  LMN2=32+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  LMN1=53
                  LMN2=53+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  LMN1=14
                  LMN2=14+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  LMN1=29
                  LMN2=29+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  LMN1=50
                  LMN2=50+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  LMN1=25
                  LMN2=25+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  LMN1=46
                  LMN2=46+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  LMN1=41
                  LMN2=41+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  LMN1=2
                  LMN2=2+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  LMN1=8
                  LMN2=8+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  LMN1=18
                  LMN2=18+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  LMN1=33
                  LMN2=33+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  LMN1=54
                  LMN2=54+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  LMN1=6
                  LMN2=6+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  LMN1=16
                  LMN2=16+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  LMN1=31
                  LMN2=31+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  LMN1=52
                  LMN2=52+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  LMN1=13
                  LMN2=13+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  LMN1=28
                  LMN2=28+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  LMN1=49
                  LMN2=49+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  LMN1=24
                  LMN2=24+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  LMN1=45
                  LMN2=45+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  LMN1=40
                  LMN2=40+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  LMN1=5
                  LMN2=5+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  LMN1=15
                  LMN2=15+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  LMN1=30
                  LMN2=30+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  LMN1=51
                  LMN2=51+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  LMN1=12
                  LMN2=12+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  LMN1=27
                  LMN2=27+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  LMN1=48
                  LMN2=48+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  LMN1=23
                  LMN2=23+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  LMN1=44
                  LMN2=44+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  LMN1=39
                  LMN2=39+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  LMN1=11
                  LMN2=11+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  LMN1=26
                  LMN2=26+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  LMN1=47
                  LMN2=47+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  LMN1=22
                  LMN2=22+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  LMN1=43
                  LMN2=43+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  LMN1=38
                  LMN2=38+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  LMN1=21
                  LMN2=21+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  LMN1=42
                  LMN2=42+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  LMN1=37
                  LMN2=37+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  LMN1=36
                  LMN2=36+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                ELSE
                  CALL Halt('ExplicitBraElements.Inc: Wrong NSDen')
                ENDIF
             ENDIF
          ENDDO
       CASE(6)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaX(3)=TwoZ*(RPX*LambdaX(2)-2.D0*LambdaX(1))
                LambdaX(4)=TwoZ*(RPX*LambdaX(3)-3.D0*LambdaX(2))
                LambdaX(5)=TwoZ*(RPX*LambdaX(4)-4.D0*LambdaX(3))
                LambdaX(6)=TwoZ*(RPX*LambdaX(5)-5.D0*LambdaX(4))
                LambdaX(7)=TwoZ*(RPX*LambdaX(6)-6.D0*LambdaX(5))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaY(3)=TwoZ*(RPY*LambdaY(2)-2.D0*LambdaY(1))
                LambdaY(4)=TwoZ*(RPY*LambdaY(3)-3.D0*LambdaY(2))
                LambdaY(5)=TwoZ*(RPY*LambdaY(4)-4.D0*LambdaY(3))
                LambdaY(6)=TwoZ*(RPY*LambdaY(5)-5.D0*LambdaY(4))
                LambdaY(7)=TwoZ*(RPY*LambdaY(6)-6.D0*LambdaY(5))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                LambdaZ(3)=TwoZ*(RPZ*LambdaZ(2)-2.D0*LambdaZ(1))
                LambdaZ(4)=TwoZ*(RPZ*LambdaZ(3)-3.D0*LambdaZ(2))
                LambdaZ(5)=TwoZ*(RPZ*LambdaZ(4)-4.D0*LambdaZ(3))
                LambdaZ(6)=TwoZ*(RPZ*LambdaZ(5)-5.D0*LambdaZ(4))
                LambdaZ(7)=TwoZ*(RPZ*LambdaZ(6)-6.D0*LambdaZ(5))
                Wght=Cube%Wght(I)
                IF(NSDen.EQ.1)THEN
                  dEdRho=Cube%Vals(I,1)
                  dEdAbsGradRho2=Cube%Vals(I,2)
                  GradRhoX=Cube%Vals(I,3)
                  GradRhoY=Cube%Vals(I,4)
                  GradRhoZ=Cube%Vals(I,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(1)=Ket(1)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(4)=Ket(4)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(10)=Ket(10)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(20)=Ket(20)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(35)=Ket(35)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(56)=Ket(56)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(7)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(84)=Ket(84)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(3)=Ket(3)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(9)=Ket(9)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(19)=Ket(19)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(34)=Ket(34)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(55)=Ket(55)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(83)=Ket(83)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(7)=Ket(7)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(17)=Ket(17)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(32)=Ket(32)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(53)=Ket(53)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(81)=Ket(81)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(14)=Ket(14)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(29)=Ket(29)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(50)=Ket(50)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(78)=Ket(78)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(25)=Ket(25)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(46)=Ket(46)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(74)=Ket(74)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(41)=Ket(41)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(69)=Ket(69)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(63)=Ket(63)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(2)=Ket(2)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(8)=Ket(8)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(18)=Ket(18)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(33)=Ket(33)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(54)=Ket(54)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(82)=Ket(82)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(6)=Ket(6)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(16)=Ket(16)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(31)=Ket(31)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(52)=Ket(52)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(80)=Ket(80)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(13)=Ket(13)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(28)=Ket(28)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(49)=Ket(49)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(77)=Ket(77)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(24)=Ket(24)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(45)=Ket(45)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(73)=Ket(73)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(40)=Ket(40)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(68)=Ket(68)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(62)=Ket(62)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(5)=Ket(5)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(15)=Ket(15)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(30)=Ket(30)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(51)=Ket(51)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(79)=Ket(79)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(12)=Ket(12)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(27)=Ket(27)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(48)=Ket(48)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(76)=Ket(76)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(23)=Ket(23)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(44)=Ket(44)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(72)=Ket(72)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(39)=Ket(39)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(67)=Ket(67)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(61)=Ket(61)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(11)=Ket(11)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(26)=Ket(26)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(47)=Ket(47)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(75)=Ket(75)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(22)=Ket(22)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(43)=Ket(43)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(71)=Ket(71)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(38)=Ket(38)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(66)=Ket(66)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(60)=Ket(60)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(21)=Ket(21)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(42)=Ket(42)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(70)=Ket(70)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(37)=Ket(37)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(65)=Ket(65)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(59)=Ket(59)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(36)=Ket(36)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(64)=Ket(64)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(58)=Ket(58)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(7)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(57)=Ket(57)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                ELSEIF(NSDen.EQ.3)THEN
                  I1=I+  NGrid
                  I2=I+2*NGrid
                  dEdRhoA=Cube%Vals(I ,1)
                  dEdRhoB=Cube%Vals(I1,1)
                  dEdAbsGradRho2AA=Cube%Vals(I ,2)
                  dEdAbsGradRho2BB=Cube%Vals(I1,2)
                  dEdAbsGradRho2AB=Cube%Vals(I2,2)
                  GradRhoXA=Cube%Vals(I ,3)
                  GradRhoYA=Cube%Vals(I ,4)
                  GradRhoZA=Cube%Vals(I ,5)
                  GradRhoXB=Cube%Vals(I1,3)
                  GradRhoYB=Cube%Vals(I1,4)
                  GradRhoZB=Cube%Vals(I1,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  LMN1=1
                  LMN2=1+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  LMN1=4
                  LMN2=4+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  LMN1=10
                  LMN2=10+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  LMN1=20
                  LMN2=20+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  LMN1=35
                  LMN2=35+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  LMN1=56
                  LMN2=56+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(7)
                  LMN1=84
                  LMN2=84+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  LMN1=3
                  LMN2=3+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  LMN1=9
                  LMN2=9+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  LMN1=19
                  LMN2=19+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  LMN1=34
                  LMN2=34+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  LMN1=55
                  LMN2=55+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  LMN1=83
                  LMN2=83+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  LMN1=7
                  LMN2=7+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  LMN1=17
                  LMN2=17+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  LMN1=32
                  LMN2=32+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  LMN1=53
                  LMN2=53+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  LMN1=81
                  LMN2=81+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  LMN1=14
                  LMN2=14+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  LMN1=29
                  LMN2=29+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  LMN1=50
                  LMN2=50+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  LMN1=78
                  LMN2=78+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  LMN1=25
                  LMN2=25+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  LMN1=46
                  LMN2=46+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  LMN1=74
                  LMN2=74+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  LMN1=41
                  LMN2=41+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  LMN1=69
                  LMN2=69+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  LMN1=63
                  LMN2=63+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  LMN1=2
                  LMN2=2+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  LMN1=8
                  LMN2=8+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  LMN1=18
                  LMN2=18+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  LMN1=33
                  LMN2=33+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  LMN1=54
                  LMN2=54+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  LMN1=82
                  LMN2=82+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  LMN1=6
                  LMN2=6+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  LMN1=16
                  LMN2=16+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  LMN1=31
                  LMN2=31+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  LMN1=52
                  LMN2=52+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  LMN1=80
                  LMN2=80+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  LMN1=13
                  LMN2=13+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  LMN1=28
                  LMN2=28+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  LMN1=49
                  LMN2=49+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  LMN1=77
                  LMN2=77+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  LMN1=24
                  LMN2=24+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  LMN1=45
                  LMN2=45+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  LMN1=73
                  LMN2=73+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  LMN1=40
                  LMN2=40+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  LMN1=68
                  LMN2=68+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  LMN1=62
                  LMN2=62+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  LMN1=5
                  LMN2=5+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  LMN1=15
                  LMN2=15+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  LMN1=30
                  LMN2=30+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  LMN1=51
                  LMN2=51+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  LMN1=79
                  LMN2=79+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  LMN1=12
                  LMN2=12+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  LMN1=27
                  LMN2=27+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  LMN1=48
                  LMN2=48+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  LMN1=76
                  LMN2=76+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  LMN1=23
                  LMN2=23+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  LMN1=44
                  LMN2=44+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  LMN1=72
                  LMN2=72+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  LMN1=39
                  LMN2=39+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  LMN1=67
                  LMN2=67+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  LMN1=61
                  LMN2=61+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  LMN1=11
                  LMN2=11+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  LMN1=26
                  LMN2=26+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  LMN1=47
                  LMN2=47+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  LMN1=75
                  LMN2=75+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  LMN1=22
                  LMN2=22+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  LMN1=43
                  LMN2=43+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  LMN1=71
                  LMN2=71+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  LMN1=38
                  LMN2=38+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  LMN1=66
                  LMN2=66+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  LMN1=60
                  LMN2=60+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  LMN1=21
                  LMN2=21+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  LMN1=42
                  LMN2=42+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  LMN1=70
                  LMN2=70+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  LMN1=37
                  LMN2=37+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  LMN1=65
                  LMN2=65+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  LMN1=59
                  LMN2=59+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  LMN1=36
                  LMN2=36+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  LMN1=64
                  LMN2=64+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  LMN1=58
                  LMN2=58+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(7)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  LMN1=57
                  LMN2=57+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                ELSE
                  CALL Halt('ExplicitBraElements.Inc: Wrong NSDen')
                ENDIF
             ENDIF
          ENDDO
       CASE(7)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaX(3)=TwoZ*(RPX*LambdaX(2)-2.D0*LambdaX(1))
                LambdaX(4)=TwoZ*(RPX*LambdaX(3)-3.D0*LambdaX(2))
                LambdaX(5)=TwoZ*(RPX*LambdaX(4)-4.D0*LambdaX(3))
                LambdaX(6)=TwoZ*(RPX*LambdaX(5)-5.D0*LambdaX(4))
                LambdaX(7)=TwoZ*(RPX*LambdaX(6)-6.D0*LambdaX(5))
                LambdaX(8)=TwoZ*(RPX*LambdaX(7)-7.D0*LambdaX(6))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaY(3)=TwoZ*(RPY*LambdaY(2)-2.D0*LambdaY(1))
                LambdaY(4)=TwoZ*(RPY*LambdaY(3)-3.D0*LambdaY(2))
                LambdaY(5)=TwoZ*(RPY*LambdaY(4)-4.D0*LambdaY(3))
                LambdaY(6)=TwoZ*(RPY*LambdaY(5)-5.D0*LambdaY(4))
                LambdaY(7)=TwoZ*(RPY*LambdaY(6)-6.D0*LambdaY(5))
                LambdaY(8)=TwoZ*(RPY*LambdaY(7)-7.D0*LambdaY(6))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                LambdaZ(3)=TwoZ*(RPZ*LambdaZ(2)-2.D0*LambdaZ(1))
                LambdaZ(4)=TwoZ*(RPZ*LambdaZ(3)-3.D0*LambdaZ(2))
                LambdaZ(5)=TwoZ*(RPZ*LambdaZ(4)-4.D0*LambdaZ(3))
                LambdaZ(6)=TwoZ*(RPZ*LambdaZ(5)-5.D0*LambdaZ(4))
                LambdaZ(7)=TwoZ*(RPZ*LambdaZ(6)-6.D0*LambdaZ(5))
                LambdaZ(8)=TwoZ*(RPZ*LambdaZ(7)-7.D0*LambdaZ(6))
                Wght=Cube%Wght(I)
                IF(NSDen.EQ.1)THEN
                  dEdRho=Cube%Vals(I,1)
                  dEdAbsGradRho2=Cube%Vals(I,2)
                  GradRhoX=Cube%Vals(I,3)
                  GradRhoY=Cube%Vals(I,4)
                  GradRhoZ=Cube%Vals(I,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(1)=Ket(1)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(4)=Ket(4)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(10)=Ket(10)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(20)=Ket(20)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(35)=Ket(35)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(56)=Ket(56)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(7)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(84)=Ket(84)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(7)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(7)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(7)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(8)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(120)=Ket(120)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(3)=Ket(3)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(9)=Ket(9)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(19)=Ket(19)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(34)=Ket(34)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(55)=Ket(55)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(83)=Ket(83)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(6)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(7)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(119)=Ket(119)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(7)=Ket(7)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(17)=Ket(17)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(32)=Ket(32)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(53)=Ket(53)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(81)=Ket(81)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(117)=Ket(117)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(14)=Ket(14)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(29)=Ket(29)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(50)=Ket(50)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(78)=Ket(78)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(114)=Ket(114)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(25)=Ket(25)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(46)=Ket(46)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(74)=Ket(74)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(110)=Ket(110)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(41)=Ket(41)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(69)=Ket(69)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(105)=Ket(105)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(63)=Ket(63)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(7)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(6)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(99)=Ket(99)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(0)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(8)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(7)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(92)=Ket(92)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(2)=Ket(2)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(8)=Ket(8)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(18)=Ket(18)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(33)=Ket(33)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(54)=Ket(54)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(82)=Ket(82)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(7)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(118)=Ket(118)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(6)=Ket(6)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(16)=Ket(16)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(31)=Ket(31)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(52)=Ket(52)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(80)=Ket(80)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(116)=Ket(116)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(13)=Ket(13)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(28)=Ket(28)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(49)=Ket(49)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(77)=Ket(77)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(113)=Ket(113)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(24)=Ket(24)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(45)=Ket(45)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(73)=Ket(73)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(109)=Ket(109)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(40)=Ket(40)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(68)=Ket(68)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(104)=Ket(104)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(62)=Ket(62)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(5)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(98)=Ket(98)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(6)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(91)=Ket(91)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(5)=Ket(5)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(15)=Ket(15)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(30)=Ket(30)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(51)=Ket(51)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(79)=Ket(79)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(6)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(115)=Ket(115)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(12)=Ket(12)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(27)=Ket(27)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(48)=Ket(48)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(76)=Ket(76)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(112)=Ket(112)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(23)=Ket(23)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(44)=Ket(44)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(72)=Ket(72)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(108)=Ket(108)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(39)=Ket(39)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(67)=Ket(67)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(103)=Ket(103)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(61)=Ket(61)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(4)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(97)=Ket(97)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(5)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(90)=Ket(90)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(11)=Ket(11)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(26)=Ket(26)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(47)=Ket(47)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(75)=Ket(75)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(5)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(111)=Ket(111)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(22)=Ket(22)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(43)=Ket(43)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(71)=Ket(71)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(107)=Ket(107)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(38)=Ket(38)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(66)=Ket(66)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(102)=Ket(102)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(60)=Ket(60)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(3)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(96)=Ket(96)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(4)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(89)=Ket(89)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(21)=Ket(21)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(42)=Ket(42)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(70)=Ket(70)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(4)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(106)=Ket(106)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(37)=Ket(37)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(65)=Ket(65)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(101)=Ket(101)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(59)=Ket(59)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(2)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(95)=Ket(95)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(3)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(88)=Ket(88)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(36)=Ket(36)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(64)=Ket(64)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(3)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(100)=Ket(100)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(58)=Ket(58)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(6)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(5)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(1)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(94)=Ket(94)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(2)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(87)=Ket(87)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(7)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(57)=Ket(57)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(7)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(6)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(6)*LambdaY(0)*LambdaZ(2)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(93)=Ket(93)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(7)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(6)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(6)*LambdaY(1)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(86)=Ket(86)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                  PrimDist=LambdaX(7)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(8)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(7)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(7)*LambdaY(0)*LambdaZ(1)
                  GradBraRhoDot=GradRhoX*GradPrimDistX&
                  +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                  Ket(85)=Ket(85)&
                  +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                ELSEIF(NSDen.EQ.3)THEN
                  I1=I+  NGrid
                  I2=I+2*NGrid
                  dEdRhoA=Cube%Vals(I ,1)
                  dEdRhoB=Cube%Vals(I1,1)
                  dEdAbsGradRho2AA=Cube%Vals(I ,2)
                  dEdAbsGradRho2BB=Cube%Vals(I1,2)
                  dEdAbsGradRho2AB=Cube%Vals(I2,2)
                  GradRhoXA=Cube%Vals(I ,3)
                  GradRhoYA=Cube%Vals(I ,4)
                  GradRhoZA=Cube%Vals(I ,5)
                  GradRhoXB=Cube%Vals(I1,3)
                  GradRhoYB=Cube%Vals(I1,4)
                  GradRhoZB=Cube%Vals(I1,5)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  LMN1=1
                  LMN2=1+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  LMN1=4
                  LMN2=4+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  LMN1=10
                  LMN2=10+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  LMN1=20
                  LMN2=20+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  LMN1=35
                  LMN2=35+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  LMN1=56
                  LMN2=56+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(7)
                  LMN1=84
                  LMN2=84+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(7)
                  GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(7)
                  GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(7)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(8)
                  LMN1=120
                  LMN2=120+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  LMN1=3
                  LMN2=3+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  LMN1=9
                  LMN2=9+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  LMN1=19
                  LMN2=19+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  LMN1=34
                  LMN2=34+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  LMN1=55
                  LMN2=55+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  LMN1=83
                  LMN2=83+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(6)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(7)
                  LMN1=119
                  LMN2=119+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  LMN1=7
                  LMN2=7+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  LMN1=17
                  LMN2=17+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  LMN1=32
                  LMN2=32+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  LMN1=53
                  LMN2=53+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  LMN1=81
                  LMN2=81+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(6)
                  LMN1=117
                  LMN2=117+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  LMN1=14
                  LMN2=14+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  LMN1=29
                  LMN2=29+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  LMN1=50
                  LMN2=50+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  LMN1=78
                  LMN2=78+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(5)
                  LMN1=114
                  LMN2=114+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  LMN1=25
                  LMN2=25+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  LMN1=46
                  LMN2=46+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  LMN1=74
                  LMN2=74+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(4)
                  LMN1=110
                  LMN2=110+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  LMN1=41
                  LMN2=41+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  LMN1=69
                  LMN2=69+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(1)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(0)*LambdaY(6)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(5)*LambdaZ(3)
                  LMN1=105
                  LMN2=105+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  LMN1=63
                  LMN2=63+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(1)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(0)*LambdaY(7)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(6)*LambdaZ(2)
                  LMN1=99
                  LMN2=99+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(0)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(1)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(0)*LambdaY(8)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(0)*LambdaY(7)*LambdaZ(1)
                  LMN1=92
                  LMN2=92+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  LMN1=2
                  LMN2=2+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  LMN1=8
                  LMN2=8+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  LMN1=18
                  LMN2=18+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  LMN1=33
                  LMN2=33+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  LMN1=54
                  LMN2=54+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  LMN1=82
                  LMN2=82+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(6)
                  GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(6)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(7)
                  LMN1=118
                  LMN2=118+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  LMN1=6
                  LMN2=6+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  LMN1=16
                  LMN2=16+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  LMN1=31
                  LMN2=31+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  LMN1=52
                  LMN2=52+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  LMN1=80
                  LMN2=80+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(6)
                  LMN1=116
                  LMN2=116+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  LMN1=13
                  LMN2=13+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  LMN1=28
                  LMN2=28+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  LMN1=49
                  LMN2=49+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  LMN1=77
                  LMN2=77+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(5)
                  LMN1=113
                  LMN2=113+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  LMN1=24
                  LMN2=24+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  LMN1=45
                  LMN2=45+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  LMN1=73
                  LMN2=73+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(4)
                  LMN1=109
                  LMN2=109+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  LMN1=40
                  LMN2=40+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  LMN1=68
                  LMN2=68+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(2)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(1)*LambdaY(5)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(4)*LambdaZ(3)
                  LMN1=104
                  LMN2=104+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  LMN1=62
                  LMN2=62+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(2)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(1)*LambdaY(6)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(5)*LambdaZ(2)
                  LMN1=98
                  LMN2=98+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(1)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(2)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(1)*LambdaY(7)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(1)*LambdaY(6)*LambdaZ(1)
                  LMN1=91
                  LMN2=91+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  LMN1=5
                  LMN2=5+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  LMN1=15
                  LMN2=15+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  LMN1=30
                  LMN2=30+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  LMN1=51
                  LMN2=51+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  LMN1=79
                  LMN2=79+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(5)
                  GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(5)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(6)
                  LMN1=115
                  LMN2=115+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  LMN1=12
                  LMN2=12+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  LMN1=27
                  LMN2=27+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  LMN1=48
                  LMN2=48+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  LMN1=76
                  LMN2=76+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(5)
                  LMN1=112
                  LMN2=112+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  LMN1=23
                  LMN2=23+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  LMN1=44
                  LMN2=44+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  LMN1=72
                  LMN2=72+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(4)
                  LMN1=108
                  LMN2=108+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  LMN1=39
                  LMN2=39+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  LMN1=67
                  LMN2=67+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(3)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(2)*LambdaY(4)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(3)*LambdaZ(3)
                  LMN1=103
                  LMN2=103+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  LMN1=61
                  LMN2=61+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(3)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(2)*LambdaY(5)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(4)*LambdaZ(2)
                  LMN1=97
                  LMN2=97+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(2)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(3)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(2)*LambdaY(6)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(2)*LambdaY(5)*LambdaZ(1)
                  LMN1=90
                  LMN2=90+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  LMN1=11
                  LMN2=11+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  LMN1=26
                  LMN2=26+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  LMN1=47
                  LMN2=47+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  LMN1=75
                  LMN2=75+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(4)
                  GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(4)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(5)
                  LMN1=111
                  LMN2=111+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  LMN1=22
                  LMN2=22+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  LMN1=43
                  LMN2=43+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  LMN1=71
                  LMN2=71+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(4)
                  LMN1=107
                  LMN2=107+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  LMN1=38
                  LMN2=38+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  LMN1=66
                  LMN2=66+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(4)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(3)*LambdaY(3)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(2)*LambdaZ(3)
                  LMN1=102
                  LMN2=102+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  LMN1=60
                  LMN2=60+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(4)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(3)*LambdaY(4)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(3)*LambdaZ(2)
                  LMN1=96
                  LMN2=96+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(3)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(4)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(3)*LambdaY(5)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(3)*LambdaY(4)*LambdaZ(1)
                  LMN1=89
                  LMN2=89+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  LMN1=21
                  LMN2=21+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  LMN1=42
                  LMN2=42+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  LMN1=70
                  LMN2=70+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(3)
                  GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(3)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(4)
                  LMN1=106
                  LMN2=106+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  LMN1=37
                  LMN2=37+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  LMN1=65
                  LMN2=65+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(5)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(4)*LambdaY(2)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(1)*LambdaZ(3)
                  LMN1=101
                  LMN2=101+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  LMN1=59
                  LMN2=59+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(5)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(4)*LambdaY(3)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(2)*LambdaZ(2)
                  LMN1=95
                  LMN2=95+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(4)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(5)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(4)*LambdaY(4)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(4)*LambdaY(3)*LambdaZ(1)
                  LMN1=88
                  LMN2=88+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  LMN1=36
                  LMN2=36+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  LMN1=64
                  LMN2=64+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistX=-LambdaX(6)*LambdaY(0)*LambdaZ(2)
                  GradPrimDistY=-LambdaX(5)*LambdaY(1)*LambdaZ(2)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(0)*LambdaZ(3)
                  LMN1=100
                  LMN2=100+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  LMN1=58
                  LMN2=58+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(6)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(5)*LambdaY(2)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(1)*LambdaZ(2)
                  LMN1=94
                  LMN2=94+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(5)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(6)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(5)*LambdaY(3)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(5)*LambdaY(2)*LambdaZ(1)
                  LMN1=87
                  LMN2=87+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(6)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(7)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  LMN1=57
                  LMN2=57+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(6)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistX=-LambdaX(7)*LambdaY(0)*LambdaZ(1)
                  GradPrimDistY=-LambdaX(6)*LambdaY(1)*LambdaZ(1)
                  GradPrimDistZ=-LambdaX(6)*LambdaY(0)*LambdaZ(2)
                  LMN1=93
                  LMN2=93+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(6)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(7)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(6)*LambdaY(2)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(6)*LambdaY(1)*LambdaZ(1)
                  LMN1=86
                  LMN2=86+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                  PrimDist=LambdaX(7)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistX=-LambdaX(8)*LambdaY(0)*LambdaZ(0)
                  GradPrimDistY=-LambdaX(7)*LambdaY(1)*LambdaZ(0)
                  GradPrimDistZ=-LambdaX(7)*LambdaY(0)*LambdaZ(1)
                  LMN1=85
                  LMN2=85+OffSDen
                  GRhoAG=GradRhoXA*GradPrimDistX&
                  +GradRhoYA*GradPrimDistY+GradRhoZA*GradPrimDistZ
                  GRhoBG=GradRhoXB*GradPrimDistX&
                  +GradRhoYB*GradPrimDistY+GradRhoZB*GradPrimDistZ
                  Ket(LMN1)=Ket(LMN1)&
                  +Wght*(dEdRhoA*PrimDist+2D0*dEdAbsGradRho2AA*GRhoAG&
                  +dEdAbsGradRho2AB*GRhoBG)
                  Ket(LMN2)=Ket(LMN2)&
                  +Wght*(dEdRhoB*PrimDist+2D0*dEdAbsGradRho2BB*GRhoBG&
                  +dEdAbsGradRho2AB*GRhoAG)
                ELSE
                  CALL Halt('ExplicitBraElements.Inc: Wrong NSDen')
                ENDIF
             ENDIF
          ENDDO
       CASE(8:)
          CALL Halt("Increase HGEll in Modules/GlobalScalars.F90 and remake")
       END SELECT
