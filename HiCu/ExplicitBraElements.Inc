       Z=Prim%Z
       TwoZ=Two*Z
       SELECT CASE(Prim%Ell)
       CASE(0)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                Wght=Cube%Wght(I)
                dEdRho=Cube%Vals(I,1)
                dEdAbsGradRho2=Cube%Vals(I,2)
                GradRhoX=Cube%Vals(I,3)
                GradRhoY=Cube%Vals(I,4)
                GradRhoZ=Cube%Vals(I,5)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(1)=Prim%Ket(1)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
             ENDIF
          ENDDO
       CASE(1)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                Wght=Cube%Wght(I)
                dEdRho=Cube%Vals(I,1)
                dEdAbsGradRho2=Cube%Vals(I,2)
                GradRhoX=Cube%Vals(I,3)
                GradRhoY=Cube%Vals(I,4)
                GradRhoZ=Cube%Vals(I,5)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(1)=Prim%Ket(1)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(4)=Prim%Ket(4)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(3)=Prim%Ket(3)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(2)=Prim%Ket(2)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
             ENDIF
          ENDDO
       CASE(2)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaX(3)=TwoZ*(RPX*LambdaX(2)-2.D0*LambdaX(1))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaY(3)=TwoZ*(RPY*LambdaY(2)-2.D0*LambdaY(1))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                LambdaZ(3)=TwoZ*(RPZ*LambdaZ(2)-2.D0*LambdaZ(1))
                Wght=Cube%Wght(I)
                dEdRho=Cube%Vals(I,1)
                dEdAbsGradRho2=Cube%Vals(I,2)
                GradRhoX=Cube%Vals(I,3)
                GradRhoY=Cube%Vals(I,4)
                GradRhoZ=Cube%Vals(I,5)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(1)=Prim%Ket(1)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(4)=Prim%Ket(4)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(10)=Prim%Ket(10)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(3)=Prim%Ket(3)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(9)=Prim%Ket(9)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(7)=Prim%Ket(7)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(2)=Prim%Ket(2)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(8)=Prim%Ket(8)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(6)=Prim%Ket(6)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(5)=Prim%Ket(5)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
             ENDIF
          ENDDO
       CASE(3)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaX(3)=TwoZ*(RPX*LambdaX(2)-2.D0*LambdaX(1))
                LambdaX(4)=TwoZ*(RPX*LambdaX(3)-3.D0*LambdaX(2))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaY(3)=TwoZ*(RPY*LambdaY(2)-2.D0*LambdaY(1))
                LambdaY(4)=TwoZ*(RPY*LambdaY(3)-3.D0*LambdaY(2))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                LambdaZ(3)=TwoZ*(RPZ*LambdaZ(2)-2.D0*LambdaZ(1))
                LambdaZ(4)=TwoZ*(RPZ*LambdaZ(3)-3.D0*LambdaZ(2))
                Wght=Cube%Wght(I)
                dEdRho=Cube%Vals(I,1)
                dEdAbsGradRho2=Cube%Vals(I,2)
                GradRhoX=Cube%Vals(I,3)
                GradRhoY=Cube%Vals(I,4)
                GradRhoZ=Cube%Vals(I,5)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(1)=Prim%Ket(1)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(4)=Prim%Ket(4)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(10)=Prim%Ket(10)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(20)=Prim%Ket(20)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(3)=Prim%Ket(3)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(9)=Prim%Ket(9)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(19)=Prim%Ket(19)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(7)=Prim%Ket(7)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(17)=Prim%Ket(17)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(14)=Prim%Ket(14)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(2)=Prim%Ket(2)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(8)=Prim%Ket(8)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(18)=Prim%Ket(18)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(6)=Prim%Ket(6)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(16)=Prim%Ket(16)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(13)=Prim%Ket(13)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(5)=Prim%Ket(5)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(15)=Prim%Ket(15)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(12)=Prim%Ket(12)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(11)=Prim%Ket(11)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
             ENDIF
          ENDDO
       CASE(4)
          DO I=1,NGrid 
             RPx=Cube%Grid(I,1)-Prim%P(1)
             RPy=Cube%Grid(I,2)-Prim%P(2)
             RPz=Cube%Grid(I,3)-Prim%P(3)
             RP2=RPx**2+RPy**2+RPz**2
             X=Z*RP2
             IF(X<Exp_Switch)THEN
                J=AINT(X*Exp_Grid)
                Xpt=Exp_0(J)+X*(Exp_1(J)+X*(Exp_2(J)+X*(Exp_3(J)+X*Exp_4(J))))
                LambdaX(0)=Xpt
                LambdaY(0)=One
                LambdaZ(0)=One
                LambdaX(1)=TwoZ*RPx*Xpt
                LambdaY(1)=TwoZ*RPy
                LambdaZ(1)=TwoZ*RPz
                LambdaX(2)=TwoZ*(RPX*LambdaX(1)-LambdaX(0))
                LambdaX(3)=TwoZ*(RPX*LambdaX(2)-2.D0*LambdaX(1))
                LambdaX(4)=TwoZ*(RPX*LambdaX(3)-3.D0*LambdaX(2))
                LambdaX(5)=TwoZ*(RPX*LambdaX(4)-4.D0*LambdaX(3))
                LambdaY(2)=TwoZ*(RPY*LambdaY(1)-LambdaY(0))
                LambdaY(3)=TwoZ*(RPY*LambdaY(2)-2.D0*LambdaY(1))
                LambdaY(4)=TwoZ*(RPY*LambdaY(3)-3.D0*LambdaY(2))
                LambdaY(5)=TwoZ*(RPY*LambdaY(4)-4.D0*LambdaY(3))
                LambdaZ(2)=TwoZ*(RPZ*LambdaZ(1)-LambdaZ(0))
                LambdaZ(3)=TwoZ*(RPZ*LambdaZ(2)-2.D0*LambdaZ(1))
                LambdaZ(4)=TwoZ*(RPZ*LambdaZ(3)-3.D0*LambdaZ(2))
                LambdaZ(5)=TwoZ*(RPZ*LambdaZ(4)-4.D0*LambdaZ(3))
                Wght=Cube%Wght(I)
                dEdRho=Cube%Vals(I,1)
                dEdAbsGradRho2=Cube%Vals(I,2)
                GradRhoX=Cube%Vals(I,3)
                GradRhoY=Cube%Vals(I,4)
                GradRhoZ=Cube%Vals(I,5)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(1)=Prim%Ket(1)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(4)=Prim%Ket(4)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(2)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(10)=Prim%Ket(10)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(3)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(4)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(20)=Prim%Ket(20)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(0)*LambdaZ(4)
                GradPrimDistX=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                GradPrimDistY=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                GradPrimDistZ=-LambdaX(0)*LambdaY(0)*LambdaZ(5)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(35)=Prim%Ket(35)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(3)=Prim%Ket(3)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(9)=Prim%Ket(9)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(2)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(19)=Prim%Ket(19)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(1)*LambdaZ(3)
                GradPrimDistX=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                GradPrimDistY=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                GradPrimDistZ=-LambdaX(0)*LambdaY(1)*LambdaZ(4)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(34)=Prim%Ket(34)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(7)=Prim%Ket(7)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(17)=Prim%Ket(17)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(2)*LambdaZ(2)
                GradPrimDistX=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                GradPrimDistY=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(0)*LambdaY(2)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(32)=Prim%Ket(32)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(14)=Prim%Ket(14)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(3)*LambdaZ(1)
                GradPrimDistX=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                GradPrimDistY=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(0)*LambdaY(3)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(29)=Prim%Ket(29)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(0)*LambdaY(4)*LambdaZ(0)
                GradPrimDistX=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                GradPrimDistY=-LambdaX(0)*LambdaY(5)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(0)*LambdaY(4)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(25)=Prim%Ket(25)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(2)=Prim%Ket(2)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(8)=Prim%Ket(8)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(2)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(18)=Prim%Ket(18)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(0)*LambdaZ(3)
                GradPrimDistX=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                GradPrimDistY=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                GradPrimDistZ=-LambdaX(1)*LambdaY(0)*LambdaZ(4)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(33)=Prim%Ket(33)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(6)=Prim%Ket(6)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(1)
                GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(16)=Prim%Ket(16)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(1)*LambdaZ(2)
                GradPrimDistX=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                GradPrimDistY=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(1)*LambdaY(1)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(31)=Prim%Ket(31)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(13)=Prim%Ket(13)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(2)*LambdaZ(1)
                GradPrimDistX=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                GradPrimDistY=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(1)*LambdaY(2)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(28)=Prim%Ket(28)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(1)*LambdaY(3)*LambdaZ(0)
                GradPrimDistX=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                GradPrimDistY=-LambdaX(1)*LambdaY(4)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(1)*LambdaY(3)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(24)=Prim%Ket(24)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(5)=Prim%Ket(5)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(15)=Prim%Ket(15)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(0)*LambdaZ(2)
                GradPrimDistX=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                GradPrimDistY=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                GradPrimDistZ=-LambdaX(2)*LambdaY(0)*LambdaZ(3)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(30)=Prim%Ket(30)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(12)=Prim%Ket(12)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(1)*LambdaZ(1)
                GradPrimDistX=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                GradPrimDistY=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(2)*LambdaY(1)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(27)=Prim%Ket(27)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(2)*LambdaY(2)*LambdaZ(0)
                GradPrimDistX=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                GradPrimDistY=-LambdaX(2)*LambdaY(3)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(2)*LambdaY(2)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(23)=Prim%Ket(23)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(11)=Prim%Ket(11)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(3)*LambdaY(0)*LambdaZ(1)
                GradPrimDistX=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                GradPrimDistY=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                GradPrimDistZ=-LambdaX(3)*LambdaY(0)*LambdaZ(2)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(26)=Prim%Ket(26)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(3)*LambdaY(1)*LambdaZ(0)
                GradPrimDistX=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                GradPrimDistY=-LambdaX(3)*LambdaY(2)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(3)*LambdaY(1)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(22)=Prim%Ket(22)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
                PrimDist=LambdaX(4)*LambdaY(0)*LambdaZ(0)
                GradPrimDistX=-LambdaX(5)*LambdaY(0)*LambdaZ(0)
                GradPrimDistY=-LambdaX(4)*LambdaY(1)*LambdaZ(0)
                GradPrimDistZ=-LambdaX(4)*LambdaY(0)*LambdaZ(1)
                GradBraRhoDot=GradRhoX*GradPrimDistX&
                +GradRhoY*GradPrimDistY+GradRhoZ*GradPrimDistZ
                Prim%Ket(21)=Prim%Ket(21)&
                +Wght*(dEdRho*PrimDist+dEdAbsGradRho2*GradBraRhoDot)
             ENDIF
          ENDDO
       CASE(5:)
          
 CALL Halt("Increase MaxEll in MondoMods/GlobalScalars.F90 and remake")
       END SELECT
