#b3lyp
clear all

AUToGPa=2.94210119872236e+04;

eps1=1e-6;
eps2=1e-1;
# a b c alpha beta gamma
t0=[ 9.574460    10.258702    11.991359    90.0000    90.0000    90.0000 ];
t1=[9.0957370    10.258702    11.991359    90.0000    90.0000    90.0000 #A
    9.3829708    10.258702    11.991359    90.0000    90.0000    90.0000
    9.7659492    10.258702    11.991359    90.0000    90.0000    90.0000 
    10.053183    10.258702    11.991359    90.0000    90.0000    90.0000
#B
    9.574460     9.745766    11.991359    90.0000    90.0000    90.0000
    9.574460    10.053527    11.991359    90.0000    90.0000    90.0000
    9.574460    10.463876    11.991359    90.0000    90.0000    90.0000
    9.574460    10.771637    11.991359    90.0000    90.0000    90.0000
#C
#    9.574460    10.258702    11.391791    90.0000    90.0000    90.0000
#    9.574460    10.258702    11.751531    90.0000    90.0000    90.0000
#    9.574460    10.258702    12.231186    90.0000    90.0000    90.0000
#    9.574460    10.258702    12.590926    90.0000    90.0000    90.0000
#Alp
#    9.574460    10.258702    11.991359    88.2000    90.0000    90.0000
#    9.574460    10.258702    11.991359    89.1000    90.0000    90.0000
#    9.574460    10.258702    11.991359    90.9000    90.0000    90.0000
#    9.574460    10.258702    11.991359    91.8000    90.0000    90.0000
#Bet
#    9.574460    10.258702    11.991359    90.0000    88.2000    90.0000
#    9.574460    10.258702    11.991359    90.0000    89.1000    90.0000
#    9.574460    10.258702    11.991359    90.0000    90.9000    90.0000
#    9.574460    10.258702    11.991359    90.0000    91.8000    90.0000
#Gam
#    9.574460    10.258702    11.991359    90.0000    90.0000    88.2000
#    9.574460    10.258702    11.991359    90.0000    90.0000    89.1000
#    9.574460    10.258702    11.991359    90.0000    90.0000    90.9000
#    9.574460    10.258702    11.991359    90.0000    90.0000    91.8000
    ];
#stress as 11 22 33 12 13 23
s=[0.6388578616E-03  0.1511523615E-03  0.1540036346E-03 -0.8395050268E-07 -0.2050785640E-06  0.1326262923E-06 #-5 #A
   0.2466834491E-03  0.5211895074E-04  0.5293411332E-04 -0.1065735907E-06 -0.3085017718E-07 -0.1586739176E-06 #-2
  -0.2351984206E-03 -0.4195124518E-04 -0.4429518066E-04 -0.1097624458E-06 -0.9801873038E-08 -0.1009261330E-06 # 2
  -0.5634634280E-03 -0.8656668637E-04 -0.9483521308E-04 -0.1069148471E-07  0.7090104829E-07 -0.6741264913E-07 # 5
#B
   0.1363546851E-03  0.4135857638E-03  0.1531053709E-03  0.1149939877E-06  0.4578688688E-07 -0.6017311687E-07 #-5
   0.4967044646E-04  0.1550399908E-03  0.5576234129E-04 -0.5091149745E-07 -0.5823747410E-07 -0.3689454208E-07 #-2
  -0.4405262932E-04 -0.1407310687E-03 -0.5074316533E-04 -0.8665897851E-07  0.1998347109E-07 -0.1028044218E-06 # 2
  -0.9839343133E-04 -0.3210030612E-03 -0.1184246329E-03 -0.1046884301E-06 -0.8620172940E-07  0.3861009117E-07 # 5
#C
# #-5
#  0.5098020128E-04  0.5538899727E-04  0.1859400030E-03 -0.7185874229E-07  0.8480244428E-08 -0.9359369798E-07 #-2
# -0.4593056178E-04 -0.5061508306E-04 -0.1672303426E-03 -0.3812828071E-07 -0.4024603438E-07 -0.5760849578E-07 # 2
# -0.1063513357E-03 -0.1173354938E-03 -0.3764117649E-03 -0.1491143579E-07 -0.4836933053E-07  0.1555770776E-07 # 5
#Alp
# #-5
# #-2
# # 2
# # 5
#Bet
# #-5
# #-2
# # 2
# # 5
#Gam
# #-5
# #-2
# # 2
# # 5
   ];

N=size(t1,1);
s=s';
#Compute M0=(a,b,c)
M0=GetM(t0);
#Compute M1=(a,b,c)
for i=1:N
  M1(:,:,i)=GetM(t1(i,:));
end
#Compute e as 11 22 33 2*12 2*13 2*23
for i=1:N
  a(:,:,i)=M1(:,:,i)*inv(M0)-diag([1,1,1]);
  a(:,:,i)=0.5*(a(:,:,i)+a(:,:,i)');
  e(1,i)=  a(1,1,i);
  e(2,i)=  a(2,2,i);
  e(3,i)=  a(3,3,i);
  e(4,i)=2*a(1,2,i);
  e(5,i)=2*a(1,3,i);
  e(6,i)=2*a(2,3,i);
end
#svd e
[u,d,v]=svd(e);
#filter d
n=0;
for i=1:min(size(d))
  if(abs(d(i,i))>eps1)
    n=n+1;
  end
end
#compute c
c=zeros(6,6);
c=-s*v(:,1:n)*inv(d(1:n,1:n))*u(:,1:n)'  *AUToGPa;
#filter c
for i=1:6;for j=1:6
if(abs(c(i,j))<eps2)
  c(i,j)=0;
end
end;end
#print out
c



