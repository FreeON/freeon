%% LyX 1.1 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[english]{article}
\usepackage[T1]{fontenc}
\usepackage{babel}
\usepackage{graphics}
\usepackage{longtable}

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
\providecommand{\LyX}{L\kern-.1667em\lower.25em\hbox{Y}\kern-.125emX\@}
%% Special footnote code from the package 'stblftnt.sty'
%% Author: Robin Fairbairns -- Last revised Dec 13 1996
\let\SF@@footnote\footnote
\def\footnote{\ifx\protect\@typeset@protect
    \expandafter\SF@@footnote
  \else
    \expandafter\SF@gobble@opt
  \fi
}
\expandafter\def\csname SF@gobble@opt \endcsname{\@ifnextchar[%]
  \SF@gobble@twobracket
  \@gobble
}
\edef\SF@gobble@opt{\noexpand\protect
  \expandafter\noexpand\csname SF@gobble@opt \endcsname}
\def\SF@gobble@twobracket[#1]#2{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Textclass specific LaTeX commands.
 \newcommand{\lyxaddress}[1]{
   \par {\raggedright #1 
   \vspace{1.4em}
   \noindent\par}
 }

\makeatother
\begin{document}

\title{\textbf{Linear scaling computation of the Fock matrix VI. Gaussian
orbital methods for simulation of periodic systems}}


\author{C.J. Tymczak, Matt Challacombe and Eric Schwegler}

\maketitle

\lyxaddress{Theoretical Division, Los Alamos National Laboratory, Los Alamos,
New Mexico 87545 }

\begin{abstract}
Periodic boundary conditions have been implemented in the linear scaling
Quantum Chemistry code \textbf{MondoSCF}. For the two-electron Coulomb
matrix, this has been achieved with an exact multipole expansion of
the long range Coulomb field. This yields a spherically summed boundary
condition that is easily transformed to Ewald boundary conditions.
In order to achieve linear scaling of the local Coulomb field, a Quantum
Chemical Tree Code (QCTC) is used. Periodic boundary conditions have
also been incorporated into calculations of the local exchange-correlation
matrix and the exact-exchange matrix. A Hierarchical Cubature (HiCu),
pure Cartesian adaptive grid is used for the local exchange-correlation
matrix. This method achieves linear scaling through the use of advanced
data structures (k-d trees) that maximally exploits locality of the
density. Finally, the current capabilities of MondoSCF for large condensed
phases will be demonstrated.
\end{abstract}
\vfill\vfill\vfill \textbf{LA-UR-5555} \eject


\section{INTRODUCTION}

When simulating bulk behavior in solids or liquids, Periodic Boundary
Conditions (PBC) are often essential to employ \cite{Allen90}. Therefore,
we have implemented Periodic boundary conditions into the linear scaling
Quantum Chemistry code \textbf{MondoSCF} \cite{Challacombe96,Challacombe97,Challacombe99}.
For the one electron matrix this has been achieved by a re-summation
over periodic cell images, which because of locality leads to an efficient
calculation of the one electron matices. For the two electron matrices
various methods are employed. For the two-electron Coulomb matrix,
we achieve this via an exact multipole expansion of the long range
Coulomb field \cite{White94,Challacombe97b}. This yields a spherically
summed boundary condition that is easily transformed to Ewald boundary
condition \cite{Redlack72,Redlack75}. In order to achieve linear
scaling of the local Coulomb field, a Quantum Chemical Tree Code (QCTC)
is used {[}ref{]}. For the calculations of the local exchange-correlation
matrix, a Hierarchical Cubature (HiCu), pure Cartesian adaptive grid
is used. This method achieves linear scaling through the use of advanced
data structures (k-d trees) that maximally exploits locality of the
density, and allows for an efficient treatment of the periodic effects
{[}ref{]}. And finally we exploit the locallity of the basis functions
to calculate the exact exchange matrix. 

To demonstrate the capabilities of MondoSCF, we show results for three
test condensed phases, Sodium Cloride, Magnesium Oxide and Carbon
in the diamond structure. We then compare these results to the periodic
Gaussian code \textbf{Crystal98} {[}ref{]}. \textbf{}Next we demonstrate
the utility of the code on very large systems such as zeolite. Finally
we give some conclusion concerning the accuracy and utility of MondoSCF
and future research directions.


\section{One-Electron Matrices}

The first step in including periodic boundary conditions into our
linear scaling code is to determine the minimal modifications to the
one-electron integrals needed to obtain this. We incorporate periodic
boundary conditions into our linear scaling method by modifying the
integrals. Consider the non-periodic overlap matrix

\begin{equation}
\label{Sab_norm}
S_{ab}=\int _{V_{\infty }}\, d{\mathbf{r}}\, \phi _{a}({\mathbf{r}})\phi _{b}({\mathbf{r}})
\end{equation}
 where \( \{\phi _{a}(x),\phi _{b}(x)\} \) are the atomic orbitals
(LCAO) at atom \( a \) and atom \( b \) and \( V_{\infty } \) is
the integration over all space. In the periodic case this is replaced
by {[}ref{]},

\begin{equation}
\label{Sab_pbc1}
S_{ab}^{PBC}=\sum _{\mathbf{R},\mathbf{R}'}\int _{V_{cell}}\, d{\mathbf{r}}\, \phi _{a}({\mathbf{r}+\mathbf{R}})\phi _{b}({\mathbf{r}+\mathbf{R}'})
\end{equation}
where, \( V_{cell} \) is the integration over the simulation cell,
and \( \{\mathbf{R},\mathbf{R}'\} \) are the brava lattice vectors,
this is illustrated in figure \ref{figure: SimCell}, where \( \left\{ {\mathbf{a},\mathbf{b},\mathbf{c}}\right\}  \)
are the primitive lattice vectors. Because of the locality of the
atomic orbitals, we can remove the double sum over lattice vectors
to get

\begin{equation}
\label{Sab_pbc2}
S_{ab}^{PBC}=\sum _{\mathbf{R}}\int _{V_{\infty }}\, d{\mathbf{r}}\, \phi _{a}({\mathbf{r}})\phi _{b}({\mathbf{r}+\mathbf{R}})
\end{equation}
We will use this Periodic Localization Transformation (PLT) repeatedly
in what follows. Let us present some useful definitions:

\begin{equation}
\label{rho_loc}
\rho ^{loc}({\mathbf{r}})=\sum _{\mathbf{R}}\sum _{ab}{\mathbf{P}}_{ab}\phi _{a}({\mathbf{r}})\phi _{b}({\mathbf{r}+\mathbf{R}})
\end{equation}
and because of periodicity,

\begin{equation}
\label{rho_pbc}
\rho ^{PBC}({\mathbf{r}})=\sum _{\mathbf{R}}\, \rho ^{loc}({\mathbf{r}+\mathbf{R}})
\end{equation}
We also define:\begin{equation}
\label{rho_loc_ab}
\rho _{ab}^{loc}({\mathbf{r}})=\sum _{\mathbf{R}}\phi _{a}({\mathbf{r}})\phi _{b}({\mathbf{r}+\mathbf{R}})
\end{equation}


\begin{equation}
\label{rho_pbc_ab}
\rho _{ab}^{PBC}({\mathbf{r}})=\sum _{\mathbf{R}}\, \rho _{ab}^{loc}({\mathbf{r}+\mathbf{R}})
\end{equation}
Which allows us to rewrite the overlap matrix as

\begin{equation}
\label{Sab_pbc_3}
S_{ab}^{PBC}=\int _{V_{\infty }}\, d{\mathbf{r}}\, \rho ^{loc}_{ab}({\mathbf{r}}).
\end{equation}
Finally, we can rewrite the kinectic energy matrix as

\begin{equation}
\label{Tab_pbc}
T^{PBC}_{ab}=-\frac{1}{2}\sum _{\mathbf{R}}\int _{V_{\infty }}\, d{\mathbf{r}}\, \phi _{a}({\mathbf{r}+\mathbf{R}})\nabla ^{2}\phi _{b}({\mathbf{r}})
\end{equation}



\section{The Two-Electron matrices}


\subsection{The Coulomb matrix}

In order to calculate the coulomb matix effiencintly, we transform
the two-electron Coulomb integrals into integrals over all space with
local distributions via PLT transformation and equations (\ref{rho_pbc})
and (\ref{rho_pbc_ab}) {[}ref{]}, \begin{eqnarray}
J_{ab}^{PBC} & = & \frac{1}{2}\int _{V_{cell}}\int _{V_{\infty }}\, d{\mathbf{r}}\, d{\mathbf{r}'}\frac{\rho _{ab}^{PBC}\left( {\mathbf{r}}\right) \: \rho ^{PBC}\left( \mathbf{r}'\right) }{\left| \mathbf{r}-\mathbf{r}'\right| }\begin{array}{c}
\\

\end{array}\label{Jab_pbc1} \\
 & = & \frac{1}{2}\sum _{\mathbf{R}'}\int _{V_{\infty }}\int _{V_{\infty }}\, d{\mathbf{r}}\, d{\mathbf{r}'}\frac{\rho _{ab}^{loc}\left( {\mathbf{r}}\right) \: \rho ^{loc}\left( {\mathbf{r}'}+{\mathbf{R}'}\right) }{\left| \mathbf{r}-\mathbf{r}'\right| }\begin{array}{c}
\\

\end{array}\label{Jab_pbc2} 
\end{eqnarray}
However, this is still a long ranged intergral. Let us separate the
Coulomb integral into three pieces \[
J_{ab}^{PBC}=J_{ab}^{QCTC}+J_{ab}^{PFF}+J_{ab}^{EC}\]
where \begin{eqnarray}
J_{ab}^{QCTC} & = & \frac{1}{2}\sum _{{\mathbf{R}'}\in V_{in}}\, \int _{V_{\infty }}\, \int _{V_{\infty }}\, d{\mathbf{r}}\, d{\mathbf{r}'}\frac{\rho ^{loc}_{ab}\left( {\mathbf{r}}\right) \: \rho ^{loc}\left( {\mathbf{r}'+\mathbf{R}'}\right) }{\left| \mathbf{r}-\mathbf{r}'\right| }\begin{array}{c}
\\

\end{array}\label{Jqctc} \\
J_{ab}^{PFF} & = & \frac{1}{2}\sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, \int _{V_{\infty }}\, \int _{V_{\infty }}\, \mathbf{Q}d{\mathbf{r}}\, d{\mathbf{r}'}\frac{\rho _{ab}^{loc}\left( {\mathbf{r}}\right) \: \rho ^{loc}\left( {\mathbf{r}'+\mathbf{R}'}\right) }{\left| \mathbf{r}-\mathbf{r}'\right| }\begin{array}{c}
\\

\end{array}\label{Jpff} \\
J_{ab}^{EC} & = & \frac{1}{2}\sum _{{\mathbf{R}'}\in S_{\infty }}\, \int _{V_{\infty }}\, \int _{S_{\infty }}\, d{\mathbf{r}}\, d{\mathbf{r}'}\frac{\rho _{ab}^{loc}\left( {\mathbf{r}}\right) \: \rho ^{loc}\left( {\mathbf{r}'+\mathbf{R}'}\right) }{\left| \mathbf{r}-\mathbf{r}'\right| }\begin{array}{c}
\\

\end{array}\label{Jec} 
\end{eqnarray}
 and \( V_{in} \) is the volume which contains the inner cells, \( V_{\infty } \)
is the total volume and \( S_{\infty } \) is the surface at infinity
which contributes a shape dependent potential to the center cell.
This is depicted in figure \ref{figure: ReplicateCells}. Let us now
define and discuss the calculation of each terms.


\subsubsection{The Quantum Chemical Tree Code: The direct Coulomb matrix}

In-order to achieve linear scaling, we use a quantum chemical tree
code {[}ref{]} to compute the integral in equation (\ref{Jqctc}).
This requires that we replace the integrals in equation (\ref{Jqctc})
with the approximate spherical multipole expansion to order \( L \)
and \( L' \),\[
\frac{1}{2}\sum _{{\mathbf{R}'}\in V_{in}}\int _{V_{\infty }}\, d{\mathbf{r}}\, d{\mathbf{r}'}\frac{\rho _{ab}^{loc}\left( {\mathbf{r}}\right) \: \rho ^{loc}\left( {\mathbf{r}'+\mathbf{R}'}\right) }{\left| \mathbf{r}-\mathbf{r}'\right| }\approx \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \begin{array}{c}
\\

\end{array}\]
\[
\frac{1}{2}\sum _{\mathbf{R}}\sum _{\mathbf{R}'\in V_{in}}\sum _{\left\langle i\right\rangle }\int _{V_{\infty }}\, d{\mathbf{r}}\, d{\mathbf{r}'}\frac{\phi _{a}({\mathbf{r}})\phi _{b}({\mathbf{r}+\mathbf{R}})\: \Lambda ^{\left\langle i\right\rangle }\left( {\mathbf{r}'+\mathbf{R}'}\right) }{\left| \mathbf{r}-\mathbf{r}'\right| }\qquad \qquad \qquad \begin{array}{c}
\\

\end{array}\]
\begin{equation}
\label{QCTC}
+\frac{1}{2}\sum _{\mathbf{R}}\sum _{\mathbf{R}'\in V_{in}}\sum _{l=0}^{L}\, \sum _{l'=0}^{L'}\, \sum _{m=-l}^{l}\, \sum _{m'=-l'}^{l'}\, \left( -1\right) ^{l}\, \rho _{ab,l}^{m}\left[ \mathbf{Q}(\mathbf{R})\right] \, M_{l+l'}^{m+m'}[\mathbf{Q}-\mathbf{P}-\mathbf{R}']\, \widetilde{\Lambda }_{l'}^{m'}[\mathbf{P}]\begin{array}{c}
\\

\end{array}
\end{equation}
 where

\begin{equation}
\label{sp_rho_ab}
\rho _{ab,l}^{m}\left[ \mathbf{Q}(\mathbf{R})\right] =\int _{V_{\infty }}\, d{\mathbf{x}}\, O_{l}^{m}\left[ \mathbf{r}-\mathbf{Q}(\mathbf{R})\right] \phi _{a}({\mathbf{r}})\phi _{b}({\mathbf{r}+\mathbf{R}}),
\end{equation}
\( \Lambda ^{\left\langle i\right\rangle } \) are the set of distributions
of the local density which overlap \( \phi _{a}({\mathbf{r}})\phi _{b}({\mathbf{r}+\mathbf{R}}) \)
(therefore these integrals must be done explicitely) , \( \mathbf{Q}(\mathbf{R}) \)
is the center of the distribution \( \phi _{a}({\mathbf{r}})\phi _{b}({\mathbf{r}+\mathbf{R}}) \),
\( \widetilde{\Lambda }^{\left\langle j\right\rangle } \)are the
set of distributuions of the local density which do not overlap \( \phi _{a}({\mathbf{r}})\phi _{b}({\mathbf{r}+\mathbf{R}}) \),
are organized on a tree, allow us to achieve linear scaling, and \begin{equation}
\label{sp_rho_loc}
\widetilde{\Lambda }^{m}_{l}\left[ \mathbf{P}\right] =\sum _{\left\langle j\neq i\right\rangle }\int _{V_{\infty }}\, d{\mathbf{x}}\, O_{l}^{m}\left[ {\mathbf{r}-\mathbf{P}}\right] \widetilde{\Lambda }^{\left\langle j\right\rangle }\left( {\mathbf{x}}\right) 
\end{equation}
are the multipoles of these densities. The multipoles are are defined
as

\begin{eqnarray}
O_{l}^{m}\left[ {\mathbf{R}}\right]  & = & \frac{\left| {\mathbf{R}}\right| ^{l}P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) \, e^{-im\phi _{\mathbf{R}}}}{\left( l+m\right) !}\begin{array}{c}
\\

\end{array}\label{sp_mult_O} \\
M_{l}^{m}\left[ {\mathbf{R}}\right]  & = & \frac{\left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) \, e^{-im\phi _{\mathbf{R}}}}{\left| {\mathbf{R}}\right| ^{l+1}}\begin{array}{c}
\\

\end{array}\label{sp_mult_M} 
\end{eqnarray}
 In Appendix A we give a short derivation of the overlap, or penetration
error bound that we use and a more detail analyisis will be given
in refference {[}ref{]}. In Appendix B we also give a short derivation
of the multipole error bound that we use, where also a more detailed
analyisis will be given in reference {[}ref{]}. 


\subsubsection{The Periodic Far Field Coulomb matrix}

To obtain the periodic far field correction to the matrix elements
we replace the integral in equation (\ref{Jpff}) with the multipole
sum {[}ref{]}

\begin{eqnarray}
J_{ab}^{PFF} & = & \frac{1}{2}\sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, \int _{V_{\infty }}\, d{\mathbf{x}}\, d{\mathbf{x}'}\frac{\rho _{ab}^{loc}\left( {\mathbf{x}}\right) \: \rho ^{loc}\left( {\mathbf{x}'+\mathbf{R}'}\right) }{\left| \mathbf{x}-\mathbf{x}'\right| }\begin{array}{c}
\\

\end{array}\label{jpff_2} \\
 & = & \frac{1}{2}\sum _{{\mathbf{R}}\in V_{\infty }-V_{in}}\, \sum _{l=0}^{L}\, \sum _{l'=0}^{L'}\, \sum _{m=-l}^{l}\, \sum _{m'=-l'}^{l'}\label{sp_jpff} \\
 &  & \qquad \left( -1\right) ^{l}\, \rho _{ab,l}^{m}[{\mathbf{R}_{0}}]\, M_{l+l'}^{m+m'}[{\mathbf{R}}]\, \rho _{loc,l'}^{m'}[{\mathbf{R}_{0}}]
\end{eqnarray}
where \( \mathbf{R}_{0} \) is an arbitrary point in the simulation
cell (usually the center of the cell). Let us define\begin{equation}
\label{ScriptM}
{\cal M}_{l}^{m}=\sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, M_{l}^{m}[\mathbf{R}]
\end{equation}
Which allow us to rewrite\begin{equation}
\label{sp_jpff_2}
J_{ab}^{PFF}=\frac{1}{2}\sum _{l=0}^{L}\, \sum _{l'=0}^{L'}\, \sum _{m=-l}^{l}\, \sum _{m'=-l'}^{l'}\, \left( -1\right) ^{l}\, \rho _{ab,l}^{m}[{\mathbf{Q}}]\, {\cal M}_{l+l'}^{m+m'}\, \rho _{loc,l'}^{m'}[{\mathbf{Q}}]
\end{equation}
 For \( l=1 \) and \( 2 \) euqtion (\ref{ScriptM}) is a conditional
summation. In Appendix C we describe an efficient method which allow
us calculate these conditional summations. The only task remaining
is to determine the region of the inner box summation or the multipole
order \( L \) which we have to expand to. Using equation (? ) from
refernce {[}ref{]} we obtain for the error bound\[
\tau \leq \frac{{\cal O}_{L+1}\left[ \mathbf{R}_{0}\right] }{\left| \left| \mathbf{R}_{max}\right| ^{2}-\left| \mathbf{d}_{max}\right| ^{2}\right| ^{\frac{L+2}{2}}}\]
where \( \mathbf{d}_{max} \) is the distance from farthest distibution
in the simulation cell to \( \mathbf{R}_{0} \), and \( \mathbf{R}_{max} \)
is the distance to the nearest cell in the sum in equation (\ref{ScriptM}). 

In the next section we describe the corrections to the Coulomb matrix
which allow us to obtain Ewald boundary conditions inorder to obtain
translational invariance in the matrix elements, and also allows us
to compare directly to \textbf{Crystal98}. Figure \ref{figure: ErrorPFF}
shows the error of the energy as we increase \( L \) from \( 4 \)
to \( 64 \) for two different inner cell sums for a classical system
of \( 64 \) water molecules. As can be seen we obtain very rapid
convergence.


\subsubsection{The Ewald Correction matrix}

The correction to the Coulomb matrix is strongly dependent on how
the periodic multipole tensor is summed. If the matrix is a spherically
ordered lattice sum, then the connection between the spherically ordered
potential and the Ewald potential is \cite{Redlack72}, \begin{equation}
\label{EW_pot}
\Phi _{Ew}\left( \mathbf{x}\right) =\Phi _{ss}\left( \mathbf{x}\right) -\frac{4\pi }{3}{\left( \mathbf{x}-\mathbf{R}_{0}\right) \cdot \mathbf{D}}+\frac{2\pi }{3}Q
\end{equation}
in terms of the matrix elements of \( J_{ab}^{PBC} \) this gives
the corrections\begin{eqnarray}
J_{ab}^{EC} & = & \int _{V_{\infty }}\, d{\mathbf{x}}\, \rho ^{loc}_{ab}\left( {\mathbf{x}}\right) \left\{ \frac{2\pi }{3}Q-\frac{4\pi }{3}\left( \mathbf{x}-\mathbf{R}_{0}\right) \cdot \mathbf{D}\right\} \begin{array}{c}
\\

\end{array}\label{Jab_ec} \\
 & = & \frac{2\pi }{3}Q\, S_{ab}^{PBC}-\frac{4\pi }{3}\mathbf{d}_{ab}\cdot \mathbf{D}\label{Jab_ec_2} 
\end{eqnarray}
where

\begin{eqnarray}
{\mathbf{d}}_{ab} & = & \int _{V_{\infty }}\, d{\mathbf{x}}\, \left( \mathbf{x}-\mathbf{R}_{0}\right) \rho ^{loc}_{ab}\left( \mathbf{x}\right) \begin{array}{c}
\\

\end{array}\label{dab} \\
{\mathbf{D}} & = & \int _{V_{\infty }}\, d{\mathbf{x}}\, \left( \mathbf{x}-\mathbf{R}_{0}\right) \rho ^{loc}\left( \mathbf{x}\right) \begin{array}{c}
\\

\end{array}\label{D} \\
Q & = & \int _{V_{\infty }}\, d{\mathbf{x}}\, \left( \mathbf{x}-\mathbf{R}_{0}\right) ^{2}\rho ^{loc}\left( \mathbf{x}\right) \begin{array}{c}
\\

\end{array}\label{Q} 
\end{eqnarray}
are the dipole and quadrapole moments. In appendix B we give a short
derivation of these terms


\subsection{The DFT exchange correlation matrix}

To calculate the DFT exchange correlation matrix in the periodic case,
we take advantage of the periodicity of the functions being integrated
and the locality of the basis functions {[}ref{]},

\begin{eqnarray}
K_{ab}^{PBC} & = & \int _{V_{cell}}\, d\mathbf{x}\, \rho _{ab}^{PBC}\left( \mathbf{x}\right) \: V_{xc}\left( \rho ^{PBC}\left( \mathbf{x}\right) \right) \begin{array}{c}
\\

\end{array}\label{Kab_pbc_1} \\
 & = & \int _{V_{HiCu}}\, d\mathbf{x}\, \rho _{ab}^{PBC}\left( \mathbf{x}\right) \: V_{xc}\left( \rho ^{PBC}\left( \mathbf{x}\right) \right) \begin{array}{c}
\\

\end{array}\label{Kab_pbc_2} \\
 & = & \sum _{RR'}\int _{V_{HiCu}}\, d\mathbf{x}\, \phi _{a}(\mathbf{x}+R)\phi _{b}(\mathbf{x}+R')\, V_{xc}\left( \sum _{R''}\, \rho ^{loc}\left( \mathbf{x}+R''\right) \right) \begin{array}{c}
\\

\end{array}\label{Kab_pbc_3} 
\end{eqnarray}
where \( V_{HiCu} \) is the cubic region shown in figure \ref{figure: SimCell}.
This transformation is allowable because of the periodicity of the
function, and it is ideally suited for the method we use to calculate
our exchange-correlation matrix, which is based on a cartesian {}``Gaussian
quadrature'' integration of a rectangular region. To calculate the
exchange correlation matrix in periodic system we need to use equation
(\ref{Kab_pbc_3}). This could be prohibitively expensive because
of the double sum if not for the locality of the HiCu grid. We have
determined that the the computational cost increases by about a factor
of two. This is achieved by splitting the problem into two steps

\begin{itemize}
\item First, we calculate the exchange-correlation potential on the HiCu
grid using the periodically summed local density \( \rho ^{loc}\left( \mathbf{x}\right)  \),
because of the k-d tree structure of the density this is not computationally
expensive.
\item Next, we directly calculate the integral of equation (\ref{Kab_pbc_3}),
where we obtain significant increase in efficacy by exploiting the
localization of the atomic orbitals. 
\end{itemize}

\subsection{The exact exchange matrix}


\section{Verification}

Table \ref{table:ComToCrystal98_1}-\ref{table:ComToCrystal98_3}
displays our results for several test systems, Sodium Cloride, Magnesium
oxide , Diamond and Graphite. We chose these systems because they
are well studied and form a distributions of the many bounding mechanisms
which are possible, from Ionic to covallent {[}ref{]}.


\subsubsection{Sodium Cloride}

Table \ref{table:ComToCrystal98_1} shows our results for the total
energy for Sodium Cloride as compared to results obtained from \textbf{Crystal98}.
We test this system in two different cell geometries, one cubic and
the other orthorombic. Also we use three different basis sets STO-3G,
3-21G and 6-31G{*}{*}. We only use the Slater-Dirac functional because
of convergence issues with \textbf{Crystal98}. We obtain excellent
agreement with \textbf{Crystal98} to the accuracy of there results,
however, \textbf{MondoSCF} is capable of obtaining very precise results,
beyond the capacity of \textbf{Crystal98} because we do not use fitting
functions in the calculations of the Coulomb or the exchange-correlation
energies. 


\subsubsection{Magnesium Oxide}

Table \ref{table:ComToCrystal98_2} shows our results for the total
energy for Magnesium Oxide as compared to results obtained from \textbf{Crystal98}.
Because of the high degree of Ionic bounding in this system, \textbf{Crystal98}
does substantially better then for sodium Cloride. This allows for
a much closer scrutiny of the energies then for the previous system.
Again, we obtain excellent agreement with \textbf{Crystal98} for three
different basis sets to within the accuracy of these results.


\subsubsection{Diamond}

Table \ref{table:ComToCrystal98_3} shows our results for the total
energy for Diamond and Graphite as compared to results obtained from
\textbf{Crystal98}.


\section{Scaling}

For testing of linear scaling, we us a set of dense molecular nitrogen
systems obtained from molecular dynamics simulations. Figure \ref{figure:DenseNitrogen}
shows a Iso-surface potential plot for the largest test system, a
dense gas of 100 \( N_{2} \) nitrogen molecules. The electronic iso-surface
is at a density of 0.4, and the colors represent the Coulomb potential
projected upon this surface, yellow being positive and blue being
negative. Figure \ref{figure: Scaling_Matrix_Build} shows our scaling
results of the dense nitrogen periodic system for both the \( J_{QCTC} \)
and \( K_{xc} \) matrix builds for two different error thresholds.
Figure \ref{figure:Scaling_Diag} also shows scaling results, for
these same system and thresholds, for the overlap matrix inverter
and the density matrix calculator. Even in this dense periodic system,
linear scaling commences very early, around twenty molecules. Also,
we mention the fact that the crossover for linear scaling for the
density matrix solver, as opposed to the eigen-solver, is around 50
molecules even for these small basis set systems. 


\subsection{Zeolite}


\section{CONCLUSIONS}

Periodic Boundary Conditions are often essential to employ when simulating
bulk behavior in solids or liquids. We have implemented Periodic boundary
conditions into the linear scaling Quantum Chemistry code \textbf{MondoSCF}.
For the one electron matrices this has been achieved by a re-summation
over periodic cell images, which because of locality leads to an efficient
calculation of the one electron integrals. For the two-electron Coulomb
matrix, this has been achieved with an exact multipole expansion of
the long range Coulomb field. This yields a spherically summed boundary
condition that is easily transformed to Ewald boundary conditions.
In order to achieve linear scaling of the local Coulomb field, a Quantum
Chemical Tree Code (QCTC) is used. We have also incorporated Periodic
boundary conditions into calculations of the local exchange-correlation
matrix. A Hierarchical Cubature (HiCu), pure Cartesian adaptive grid
is used. This method achieves linear scaling through the use of advanced
data structures (k-d trees) that maximally exploits locality of the
density, and allows for an efficient treatment of the periodic effects.
Next, we show the capabilities of MondoSCF for three test condensed
phases , Sodium Cloride, Magnesium Oxide and Carbon in the Diamond
and graphite structures. We then compare these results to the periodic
Gaussian code \textbf{Crystal98.} Next we demonstrate the utility
of the code on very large systems such as zeolite. Finally we give
some conclusion concerning the accuracy and utility of MondoSCF and
future research directions.


\section*{ACKNOWLEDGMENTS}

We would like to acknowledge Tommy Sewell and Ed Kober for there advise
and support. 

\eject

\bibliographystyle{plain}
\bibliography{../Bibs/GaussianPapers}


\eject


\section*{\center{Appendix A}}


\subsection*{The Penetration Acceptibility Criterion (PAC)}

Let us consider a generized distribution centered at \( \mathbf{P} \)

\[
\rho _{\mathbf{P}}\left( \mathbf{r}\right) =\sum _{l+m+n=L}d_{lmn}\Lambda ^{\mathbf{P}}_{lmn}\left( \mathbf{r}\right) \]
where

\[
\Lambda ^{\mathbf{P}}_{lmn}\left( \mathbf{r}\right) =\left( x-P_{x}\right) ^{l}\left( y-P_{y}\right) ^{m}\left( z-P_{z}\right) ^{n}\exp \left( -\xi _{\mathbf{P}}\left( \mathbf{x}-\mathbf{P}\right) ^{2}\right) \]
Using Cramer's Inequality we can show\[
\rho _{\mathbf{P}}\left( \mathbf{r}\right) =\sum _{lmn}d_{lmn}\Lambda ^{\mathbf{P}}_{lmn}\left( \mathbf{r}\right) \leq C_{\mathbf{P}}\exp \left( -\widetilde{\xi }_{\mathbf{P}}\left( \mathbf{x}-\mathbf{P}\right) ^{2}\right) \]
where

\[
C_{\mathbf{P}}=\sum _{lmn}\left| d_{lmn}\right| \sqrt{l!\, m!\, n!\, \left( 2\, \widetilde{\xi }_{\mathbf{P}}\right) ^{l+m+n}}\]
\[
\widetilde{\xi }_{\mathbf{P}}=\left\{ \begin{array}{c}
\xi _{\mathbf{P}}\\
\xi _{\mathbf{P}}/2
\end{array}\right. \begin{array}{c}
\quad L=0\\
\quad {\rm otherwise}
\end{array}\]
This allow us to treat all distributions as if they where s-type gausians,
which allows us to easilly calculate the penetration error as,

\[
\left( \frac{\pi }{\widetilde{\xi }_{\mathbf{P}}}\right) ^{\frac{3}{2}}\left( \frac{\pi }{\widetilde{\xi }_{\mathbf{Q}}}\right) ^{\frac{3}{2}}\frac{C_{\mathbf{P}}C_{\mathbf{Q}}}{\left| \mathbf{P}-\mathbf{Q}\right| }{\rm erfc}\left( \sqrt{\frac{\widetilde{\xi }_{\mathbf{P}}\widetilde{\xi }_{\mathbf{Q}}}{\widetilde{\xi }_{\mathbf{P}}+\widetilde{\xi }_{\mathbf{Q}}}}\left| \mathbf{P}-\mathbf{Q}\right| \right) \geq \tau \]



\section*{\center{Appendix B} }


\subsection*{The Multipole Acceptibility Criterion (MAC)}

Let us start with the exact expansion of the coulomb intergral into
the multipole basis\[
\frac{1}{2}\sum _{l=0}^{L}\, \sum _{l'=0}^{L'}\, \sum _{m=-l}^{l}\, \sum _{m'=-l'}^{l'}\, \left( -1\right) ^{l}\, \rho _{ab,l}^{m}[{\mathbf{P}}]\, M_{l+l'}^{m+m'}[{\mathbf{P}-\mathbf{Q}}]\, \Lambda ^{m'}_{l'}[{\mathbf{Q}}]\]
Let us now assume that the primitive distributiion is of a single
algular momentum type, 

\[
\rho _{ab,l}^{m}[{\mathbf{P}}]=\rho _{ab,l}^{m}[{\mathbf{P}}]\delta _{l\, l_{p}}\]
which gives us\[
\frac{1}{2}\sum _{l'=0}^{L'}\, \sum _{m=-l_{p}}^{l_{p}}\, \sum _{m'=-l'}^{l'}\, \left( -1\right) ^{l}\, \rho _{ab,l_{p}}^{m}[{\mathbf{P}}]\, M_{l_{p}+l'}^{m+m'}[{\mathbf{P}-\mathbf{Q}}]\, \Lambda ^{m'}_{l'}[{\mathbf{Q}}]\]
The error in the calculation then is\[
\varepsilon _{l_{p}}=\left| \frac{1}{2}\sum _{l'=L'+1}^{\infty }\, \sum _{m=-l_{p}}^{l_{p}}\, \sum _{m'=-l'}^{l'}\, \left( -1\right) ^{l}\, \rho _{ab,l_{p}}^{m}[{\mathbf{P}}]\, M_{l_{p}+l'}^{m+m'}[{\mathbf{P}-\mathbf{Q}}]\, \Lambda ^{m'}_{l'}[{\mathbf{Q}}]\right| \]
First let us define\[
{\cal O}_{l}\left[ \left| \mathbf{r}\right| \right] =\sqrt{\sum _{m}(l-m)!(l+m)!\left| O_{l}^{m}(\mathbf{r})\right| ^{2}}=\left| \mathbf{r}\right| ^{l}\sqrt{\sum _{m}\frac{(l-m)!}{(l+m)!}\left| P_{l}^{m}(\mathbf{r})\right| ^{2}}\approx \left| \mathbf{r}\right| ^{l}\geq 0\]
Let us rewrite the error bound as

\begin{eqnarray*}
\varepsilon _{l_{p}} & \leq  & \left| \frac{1}{2}\sum _{l'=L'+1}^{\infty }\, \sum _{m=-l_{p}}^{l_{p}}\, \sum _{m'=-l'}^{l'}\, \rho _{ab,l_{p}}^{m}[{\mathbf{P}}]\, M_{l_{p}+l'}^{m+m'}[{\mathbf{P}-\mathbf{Q}}]\, \Lambda ^{m'}_{l'}[{\mathbf{Q}}]\right| \\
 & \leq  & \frac{1}{2}\sum _{l'=L'+1}^{\infty }\, \sum _{m=-l_{p}}^{l_{p}}\, \sum _{m'=-l'}^{l'}\, \frac{(l_{p}+l'-m_{p}-m')!}{(l_{p}+m_{p})!(l'+m')!}\\
 &  & \qquad \qquad \left| \frac{\int \, d^{3}\mathbf{r}\, \rho _{ab}(\mathbf{r})\left| \mathbf{r}-\mathbf{P}\right| ^{l_{p}}\, P_{l_{p}}^{m_{p}}[{\mathbf{P}}]\, P_{l_{p}+l'}^{m+m'}[{\mathbf{P}-\mathbf{Q}}]\int \, d^{3}\mathbf{r}\, \Lambda (\mathbf{r})\left| \mathbf{r}-\mathbf{Q}\right| ^{l'}\, P_{l'}^{m'}[{\mathbf{Q}}]}{\left| \mathbf{P}-\mathbf{Q}\right| ^{l_{p}+l'+1}}\right| 
\end{eqnarray*}
which we can rewrite as\begin{eqnarray*}
\varepsilon _{l_{p}} & \leq  & \frac{1}{2}\sum _{l'=L'+1}^{\infty }\, \sum _{m=-l_{p}}^{l_{p}}\, \sum _{m'=-l'}^{l'}\, \frac{(l_{p}+l'-m_{p}-m')!}{(l_{p}-m_{p})!(l'-m')!}\\
 &  & \left| \frac{\int \, d^{3}\mathbf{r}\, \rho _{ab}(\mathbf{r})\left| \mathbf{r}-\mathbf{P}\right| ^{l_{p}}\, \frac{(l_{p}-m_{p})!}{(l_{p}+m_{p})!}P_{l_{p}}^{m_{p}}[{\mathbf{P}}]\, P_{l_{p}+l'}^{m+m'}[{\mathbf{P}-\mathbf{Q}}]\int \, d^{3}\mathbf{r}\, \Lambda (\mathbf{r})\left| \mathbf{r}-\mathbf{Q}\right| ^{l'}\, \frac{(l'-m')!}{(l'+m')!}P_{l'}^{m'}[{\mathbf{Q}}]}{\left| \mathbf{P}-\mathbf{Q}\right| ^{l_{p}+l'+1}}\right| \\
 & \leq  & \frac{1}{2}\sum _{l'=L'+1}^{\infty }\, \sum _{m=-l_{p}}^{l_{p}}\, \sum _{m'=-l'}^{l'}\, \frac{(l_{p}+l'-m_{p}-m')!}{(l_{p}-m_{p})!(l'-m')!}\\
 &  & \frac{\left| \int \, d^{3}\mathbf{r}\, \rho _{ab}(\mathbf{r})\left| \mathbf{r}-\mathbf{P}\right| ^{l_{p}}\, \frac{(l_{p}-m_{p})!}{(l_{p}+m_{p})!}P_{l_{p}}^{m_{p}}[{\mathbf{P}}]\right| \left| P_{l_{p}+l'}^{m+m'}[{\mathbf{P}-\mathbf{Q}}]\right| \left| \int \, d^{3}\mathbf{r}\, \Lambda (\mathbf{r})\left| \mathbf{r}-\mathbf{Q}\right| ^{l'}\, \frac{(l'-m')!}{(l'+m')!}P_{l'}^{m'}[{\mathbf{Q}}]\right| }{\left| \mathbf{P}-\mathbf{Q}\right| ^{l_{p}+l'+1}}
\end{eqnarray*}
using the inequalities

\[
\begin{array}{c}
\left| \mathbf{a}\cdot \mathbf{b}\right| \leq \left| \mathbf{a}\right| \left| \mathbf{b}\right| \\
\left| P_{l}^{m}(\mathbf{R})\right| \leq 1\\
\sum _{m}\frac{(l-m)!}{(l+m)!}\left| \mathbf{r}\right| ^{l}\, P^{m}_{l}(\mathbf{r})\leq \sqrt{\sum \frac{(l-m)!}{(l+m)!}\left| \mathbf{r}\right| ^{2l}\, \left| P^{m}_{l}(\mathbf{r})\right| ^{2}}={\cal O}_{l}[\left| \mathbf{r}\right| ]
\end{array}\]
this gives us\begin{eqnarray*}
\varepsilon _{l_{p}} & \leq  & \frac{1}{2}\sum _{l'=L'+1}^{\infty }\, \sum _{m=-l_{p}}^{l_{p}}\, \sum _{m'=-l'}^{l'}\, \frac{(l_{p}+l'-m_{p}-m')!}{(l_{p}-m_{p})!(l'-m')!}\\
 &  & \frac{\left| \sum _{m_{p}'}\int \, d^{3}\mathbf{r}\, \rho _{ab}(\mathbf{r})\left| \mathbf{r}-\mathbf{P}\right| ^{l_{p}}\, \frac{(l_{p}-m'_{p})!}{(l_{p}+m'_{p})!}P_{l_{p}}^{m'_{p}}[{\mathbf{P}}]\right| \left| \sum _{m''}\int \, d^{3}\mathbf{r}\, \Lambda (\mathbf{r})\left| \mathbf{r}-\mathbf{Q}\right| ^{l'}\, \frac{(l'-m'')!}{(l'+m'')!}P_{l'}^{m''}[{\mathbf{Q}}]\right| }{\left| \mathbf{P}-\mathbf{Q}\right| ^{l_{p}+l'+1}}\\
 & \leq  & \frac{1}{2}\sum _{l'=L'+1}^{\infty }\, \sum _{m=-l_{p}}^{l_{p}}\, \sum _{m'=-l'}^{l'}\, \frac{(l_{p}+l'-m_{p}-m')!}{(l_{p}-m_{p})!(l'-m')!}\frac{{\cal O}_{l_{p}}[\mathbf{P},\, \rho ]\, {\cal O}_{l'}[\mathbf{Q},\, \Lambda ]}{\left| \mathbf{P}-\mathbf{Q}\right| ^{l_{p}+l'+1}}\\
 & \leq  & \frac{1}{2}\sum _{l=L+1}^{\infty }\frac{{\cal O}_{l_{p}}[\mathbf{P},\, \rho ]\, {\cal N}[l_{p},l]\, {\cal O}_{l}[\mathbf{Q},\, \Lambda ]}{\left| \mathbf{P}-\mathbf{Q}\right| ^{l_{p}+l+1}}
\end{eqnarray*}



\section*{\center{Appendix C}}


\subsection*{Computation of the \protect\( {\cal M}\protect \) Tensor}

Following the work of Nijboer-De Wette \cite{Nijboer57,Nijboer58a}.
We start by first partitioning  

\begin{equation}
\frac{1}{r^{l+1}}={\cal G}_{l}\left( \beta ,r\right) +{\cal F}_{l}\left( \beta ,r\right) 
\end{equation}
where

\begin{equation}
{\cal G}_{l}\left( \beta ,r\right) =\frac{\Gamma \left( l+\frac{1}{2},\beta ^{2}r^{2}\right) }{\Gamma \left( l+\frac{1}{2}\right) \, r^{l+1}}
\end{equation}
and\begin{equation}
{\cal F}_{l}\left( \beta ,r\right) =\frac{\gamma \left( l+\frac{1}{2},\beta ^{2}r^{2}\right) }{\Gamma \left( l+\frac{1}{2}\right) \, r^{l+1}}=\frac{\Gamma \left( l+\frac{1}{2}\right) -\Gamma \left( l+\frac{1}{2},\beta ^{2}r^{2}\right) }{\Gamma \left( l+\frac{1}{2}\right) \, r^{l+1}}
\end{equation}
where \( \beta  \) is a parameter which controls the convergence.
This allows the lattice sum to be partitioned into rapidly convergent
real and reciprocal space terms 

\begin{eqnarray}
{\cal M}^{m}_{l} & = & \sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, M_{l}^{m}[\mathbf{R}]\begin{array}{c}
\\

\end{array}\nonumber \\
 & = & \sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) e^{im\phi _{\mathbf{R}}}\, \left\{ {\cal G}_{l}\left( \beta ,\left| \mathbf{R}\right| \right) +{\cal F}_{l}\left( \beta ,\left| \mathbf{R}\right| \right) \right\} \begin{array}{c}
\\

\end{array}\nonumber \\
 & = & \sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) e^{im\phi _{\mathbf{R}}}\, {\cal G}_{l}\left( \beta ,\left| \mathbf{R}\right| \right) \begin{array}{c}
\\

\end{array}\nonumber \\
 & - & \sum _{{\mathbf{R}'}\in V_{in}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) e^{im\phi _{\mathbf{R}}}{\cal F}_{l}\left( \beta ,\left| \mathbf{R}\right| \right) \begin{array}{c}
\\

\end{array}\nonumber \\
 & + & \frac{4\pi ^{\frac{3}{2}}(\frac{i}{2})^{l}}{V_{cell}\Gamma \left( l+\frac{1}{2}\right) }\sum _{\mathbf{G}\neq \left\{ \emptyset \right\} }\, \left| \mathbf{G}\right| ^{l-2}e^{-\frac{\pi ^{2}\left| \mathbf{G}\right| ^{2}}{\beta ^{2}}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{G}}\right) \right) e^{im\phi _{\mathbf{G}}}
\end{eqnarray}
With an appropriate choice of \( \beta \sim \sqrt{\pi }/\left( V_{cell}\right) ^{\frac{1}{3}} \)
the periodic multipole interaction tensor can be computed. The only
potential problem is the computation of the incomplete gamma functions.
Previous approaches attempted to compute this function by the upward
recurrence relation

\begin{equation}
\Gamma \left( m+1,\, x\right) =m\Gamma \left( m,\, x\right) +x^{m}e^{-x}
\end{equation}
which is started by

\begin{equation}
\label{erfc}
\Gamma \left( \frac{1}{2},\, x\right) =\sqrt{\pi }\, {\rm erfc}\left( \sqrt{x}\right) 
\end{equation}
however, this leads a numerical instability in the calculation. For
large values of \( x \) and \( m \) the calculation of the gamma
function can quickly lose precision. We can remove this problem by
analytically summing the gamma function, collecting terms, and then
rewriting the gamma function as\begin{equation}
\Gamma \left( m+\frac{1}{2},\, x\right) =\Gamma \left( m+\frac{1}{2}\right) \left\{ {\rm erfc}\left( \sqrt{x}\right) +\sqrt{\frac{x}{\pi }}\sum _{n=0}^{m-1}(S_{n}\, x\, e^{-\frac{x}{n}})^{n}\right\} 
\end{equation}
where

\begin{equation}
\label{SN}
S_{n}=\left( \frac{\Gamma \left( \frac{1}{2}\right) }{\Gamma \left( n+\frac{3}{2}\right) }\right) ^{\frac{1}{max(n,1)}}
\end{equation}
Which are tabulated beforehand. We find that this version of the gamma
function is both easy to program and numerically very precise, even
at large \( x \) or \( m \). Table \ref{table:CubicMlm} shows the
matrix coefficients calculated for different cell shapes. We have
also computed the \( {\cal M} \) tensor in one and two dimensions.
The \( {\cal M} \) tensor in one dimension can be computed analytically

\begin{eqnarray*}
{\cal M}^{m}_{l} & = & \sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, M_{l}^{m}[\mathbf{R}]\\
 & = & \sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) e^{im\phi _{\mathbf{R}}}\, \left\{ \frac{1}{r^{l+1}}\right\} \\
 & = & \frac{\left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{0}\right) \right) e^{im\phi _{0}}}{a_{0}^{l+1}}\left\{ \sum _{n=n_{0}}^{\infty }\frac{1}{n^{l+1}}\right\} \\
 & = & \frac{\left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{0}\right) \right) e^{im\phi _{0}}}{a_{o}^{l+1}}\left\{ \zeta (l+1)-\sum _{n=1}^{n_{0}-1}\frac{1}{n^{l+1}}\right\} 
\end{eqnarray*}
where \( a_{0} \), \( \theta _{0} \) and \( \phi _{0} \) are the
intial box dimension and angles which are independent of the summation.
In two dimension, the foureier integrals for the calculation of \( {\cal M} \)
tensor become a lot more complicated, therefore we have chosen to
use the three dimensional formula's and obtain the two dimensional
moments via numerical integration, where we take the limit as the
nonperiodic direction goes to infinity,

\begin{eqnarray*}
{\cal M}^{m}_{l} & = & \sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) e^{im\phi _{\mathbf{R}}}\, {\cal G}_{l}\left( \beta ,\left| \mathbf{R}\right| \right) \\
 & - & \sum _{{\mathbf{R}'}\in V_{in}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) e^{im\phi _{\mathbf{R}}}{\cal F}_{l}\left( \beta ,\left| \mathbf{R}\right| \right) \\
 & + & \frac{4\pi ^{\frac{3}{2}}(\frac{i}{2})^{l}}{V_{cell}\Gamma \left( l+\frac{1}{2}\right) }\sum _{\mathbf{G}\neq \left\{ \emptyset \right\} }\, \left| \mathbf{G}\right| ^{l-2}e^{-\frac{\pi ^{2}\left| \mathbf{G}\right| ^{2}}{\beta ^{2}}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{G}}\right) \right) e^{im\phi _{\mathbf{G}}}\\
 & \Rightarrow  & \\
 & = & \sum _{{\mathbf{R}'}\in V_{\infty }-V_{in}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) e^{im\phi _{\mathbf{R}}}\, {\cal G}_{l}\left( \beta ,\left| \mathbf{R}\right| \right) \\
 & - & \sum _{{\mathbf{R}'}\in V_{in}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{R}}\right) \right) e^{im\phi _{\mathbf{R}}}{\cal F}_{l}\left( \beta ,\left| \mathbf{R}\right| \right) \\
 & + & \frac{4\pi ^{\frac{3}{2}}(\frac{i}{2})^{l}}{A_{cell}\Gamma \left( l+\frac{1}{2}\right) }\: \sum _{\mathbf{G}\neq \left\{ \emptyset \right\} }\, \int _{-\infty }^{\infty }\: dG_{z}\: \left| \mathbf{G}\right| ^{l-2}e^{-\frac{\pi ^{2}\left| \mathbf{G}\right| ^{2}}{\beta ^{2}}}\, \left( l-m\right) !\, P_{l}^{m}\left( \cos \left( \theta _{\mathbf{G}}\right) \right) e^{im\phi _{\mathbf{G}}}
\end{eqnarray*}
where \( A_{cell} \) is the area of the cell along the nonperiodic
direction. We have found that we can obtain the \( {\cal M} \) tensor
matrix elements to 8-10 digets of accuracy with this technique.


\section*{\center{Appendix D}}


\subsection*{Computation of the Dipole and Quadrapole Corrections }

Following the work of Redlack and Grindley \cite{Redlack72} we show
the corrections needed inorder to obtain ewald boundry conditions.
These corrections exist in both two and three directions and are due
the the field induced in the box from the surface at infinity, \( S_{\infty } \).
For three dimensions, 

\begin{equation}
\label{BN}
\Phi _{S_{\infty }}({\mathbf{x}})=\sum _{{\mathbf{R}'}\in S_{\infty }}\, \int _{V_{\infty }}\: d{\mathbf{x}'}\frac{\rho ^{loc}\left( {\mathbf{x}'+\mathbf{R}'}\right) }{\left| \mathbf{x}-\mathbf{x}'\right| }
\end{equation}
which if we write this as a multipole expansion\begin{equation}
\label{BN}
\Phi _{S_{\infty }}({\mathbf{x}})=\sum _{{\mathbf{R}'}\in S_{\infty }}\, \left[ \frac{{\mathbf{p}}\cdot \left( {\mathbf{x}-\mathbf{R}'}\right) }{\left| {\mathbf{x}-\mathbf{R}'}\right| ^{3}}+\frac{1}{2}\sum _{i,j}Q_{ij}\frac{\left( {\mathbf{x}-\mathbf{R}'}\right) _{i}\left( {\mathbf{x}-\mathbf{R}'}\right) _{j}}{\left| \left( {\mathbf{x}-\mathbf{R}'}\right) \right| ^{5}}+\ldots \right] 
\end{equation}
where \( {\mathbf{p}} \) and \( Q_{ij} \) are the dipole and quaripole
moments of \( \rho ^{loc}\left( {\mathbf{x}}\right)  \) . Both the
dipole and the quadripole terms contribute to the potential in the
cell, the dipole directly and the quaripole conditionally. Upon summation
over the surface, the dipole and quadripole contributions become\[
\Phi ^{3D}_{S_{\infty }}({\mathbf{x}})=-\frac{4\pi }{3V_{cell}}{\mathbf{p}}\cdot \left( {\mathbf{x}-\mathbf{R}'}\right) +\frac{2\pi }{3V_{cell}}\left( Q_{11}+Q_{22}+Q_{33}\right) .\]
For two dimensions only the dipole contributes to the potential within
the cell as

\[
\Phi ^{2D}_{S_{\infty }}(z)=-\frac{2\pi }{A_{cell}}p_{z}\, \left( z-R'_{z}\right) \]


\eject


\begin{table}

\caption{\label{table:ComToCrystal98_1} Comparison of Sodium Cloride test
systems to Crystal98}

{\centering \begin{tabular}{|c|c|c|c|c|c|}
\hline 
System&
Basis&
Functional&
Cell (A)&
Program&
Energy (Hartree)\\
\hline
\hline 
NaCl&
STO-3G&
Slater-Dirac&
\( \left\{ \begin{array}{c}
\left| a\right| =\left| b\right| =\left| c\right| =3.974\\
\alpha =\frac{\pi }{3},\beta =\frac{\pi }{3},N=2
\end{array}\right\}  \)&
MondoSCF&
\( -610.9751176 \)\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\( -610.972 \)\\
\hline 
&
STO-6G&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline 
&
STO-3G{*}{*}&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline
\hline 
NaCl&
STO-3G&
Slater-Dirac&
\( \left\{ \begin{array}{c}
\left| a\right| =\left| b\right| =\left| c\right| =5.630\\
\alpha =\frac{\pi }{2},\beta =\frac{\pi }{2},N=8
\end{array}\right\}  \)&
MondoSCF&
\( -2444.3583560 \)\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\( -2444.358 \)\\
\hline 
&
STO-6G&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline 
&
STO-3G{*}{*}&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline
\end{tabular}\par}
\vspace{0.3cm}
\end{table}



\begin{table}

\caption{\label{table:ComToCrystal98_2} Comparison of MgO test systems to
Crystal98}

{\centering \begin{tabular}{|c|c|c|c|c|c|}
\hline 
System&
Basis&
Functional&
Cell (A)&
Program&
Energy (Hartree)\\
\hline
\hline 
MgO&
STO-3G&
Slater-Dirac&
\( \left\{ \begin{array}{c}
\left| a\right| =\left| b\right| =\left| c\right| =2.9777\\
\alpha =\frac{\pi }{3},\beta =\frac{\pi }{3},N=2
\end{array}\right\}  \)&
MondoSCF&
\( -268.6324824 \)\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\( -268.6323 \)\\
\hline 
&
STO-6G&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\( -269.384298 \)9\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline 
&
STO-3G{*}{*}&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline
\hline 
MgO&
STO-3G&
Slater-Dirac&
\( \left\{ \begin{array}{c}
\left| a\right| =\left| b\right| =\left| c\right| =4.2112\\
\alpha =\frac{\pi }{3},\beta =\frac{\pi }{3},N=2
\end{array}\right\}  \)&
MondoSCF&
\( -1076.2137742 \)\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\( -1076.2138 \)\\
\hline 
&
STO-6G&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline 
&
STO-3G{*}{*}&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline
\end{tabular}\par}
\end{table}



\begin{table}

\caption{\label{table:ComToCrystal98_3} Comparison of Carbon test systems
to Crystal98}

{\centering \begin{tabular}{|c|c|c|c|c|c|}
\hline 
System&
Basis&
Functional&
Cell (A)&
Program&
Energy (Hartree)\\
\hline
\hline 
Diamond&
STO-3G&
Slater-Dirac&
\( \left\{ \begin{array}{c}
\left| a\right| =\left| b\right| =\left| c\right| =\\
\alpha =\frac{\pi }{2},\beta =\frac{\pi }{2},N=8
\end{array}\right\}  \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline 
&
STO-6G&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline 
&
3-21G&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline
\hline 
Graphite&
STO-3G&
Slater-Dirac&
\( \left\{ \begin{array}{c}
\left| a\right| =\left| b\right| =\left| c\right| =\\
\alpha =\frac{\pi }{2},\beta =\frac{\pi }{2},N=6
\end{array}\right\}  \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline 
&
3-21G&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline 
&
6-31G{*}{*}&
Slater-Dirac&
\( \begin{array}{c}
\\

\end{array} \)&
MondoSCF&
\\
\hline 
&
&
&
\( \begin{array}{c}
\\

\end{array} \)&
Crystal98&
\\
\hline
\end{tabular}\par}
\end{table}



\begin{table}

\caption{\label{table: ConvegOfNaCl} Total energy per atom for the sodium
cloride system for increasing system size}

{\centering \begin{tabular}{|c|c|c|}
\hline 
System Size (\( N) \)&
Energy (\( E \))&
\( \frac{E}{N} \)\\
\hline
\hline 
\( \, \, 2^{\dagger } \)&
\( -610.975117 \)&
\( -305.487559 \)\\
\hline 
\( 8 \)&
\( -2444.35835 \)&
\( -305.544794 \)\\
\hline 
\( \, \, 16^{\dagger } \)&
\( -4888.70023 \)&
\( -305.543765 \)\\
\hline 
\( \, \, 54^{\dagger } \)&
\( -16499.4900 \)&
\( -305.546111 \)\\
\hline 
\( 64 \)&
\( -19554.9556 \)&
\( -305.546181 \)\\
\hline 
\( \, \, 128^{\dagger } \)&
\( -39109.9115 \)&
\( -305.546184 \)\\
\hline 
\( 216 \)&
\( -65997.9768 \)&
\( -305.546185 \)\\
\hline
\end{tabular}\par}
\end{table}



\begin{table}

\caption{\label{table:CubicMlm} \protect\( {\cal M}_{l}^{m}\protect \) for
a cubic simulation cell \protect\( \left\{ \left| a\right| =1,\left| b\right| =1,\left| c\right| =1,\alpha =\frac{\pi }{2},\beta =\frac{\pi }{2}\right\} \protect \)
and an ortho-rombic simulation cell \protect\( \left\{ \left| a\right| =1,\left| b\right| =1,\left| c\right| =1,\alpha =\frac{2\pi }{3},\beta =\frac{2\pi }{3}\right\} \protect \)
where the central cell is substracted.}

\vspace{0.3cm}
{\centering \begin{longtable}{|c|c|c||c|c|c|}
\hline 
\multicolumn{2}{|c|}{}&
Cubic &
\multicolumn{2}{c|}{ }&
Ortho-rombic\\
\hline
\( \: \:  \)\( l \)\( \: \:  \)&
\( \:  \)\( m \)\( \:  \)&
\( \qquad \qquad  \)\( \quad  \)\( {\cal M}^{m}_{l} \)\( \qquad  \)\( \qquad  \)\( \quad  \)&
\( \: \:  \)\( l \)\( \: \:  \)&
\( \:  \)\( m \)\( \:  \)&
\( \qquad  \)\( \qquad  \)\( \quad  \)\( {\cal M}^{m}_{l} \)\( \qquad  \)\( \qquad  \)\( \quad  \)\\
\hline
4&
0&
0.3095492436410130D+01&
4&
0&
0.8832776225626217D+00 \\
&
4&
0.1547746218205053D+02&
&
3&
0.3122857982921809D+01 \\
\hline 
6&
0&
0.4796724494609411D+01&
6&
0&
-0.3501580359498343D+02\\
&
4&
-0.3357707146226664D+02&
&
3&
0.4332984629874099D+02\\
&
&
&
&
6&
-0.6740542192034350D+03\\
\hline 
8&
0&
0.4276164638449980D+03&
8&
0&
0.1394780314659910D+03\\
&
4&
0.4276164638450001D+03 &
&
3&
0.4931293093807656D+03\\
&
8&
0.2779507014992490D+05 &
&
6&
0.4931293093807656D+03\\
\hline 
10&
0&
0.3337055302939225D+04&
10&
0&
0.1760026471909184D+03\\
&
4&
-0.7341521666466320D+04&
&
3&
0.3422448296725441D+02\\
&
8&
-0.1248058683299270D+06&
&
6&
-0.5324080077525265D+03\\
&
&
&
&
9&
0.1105450799842411D+05\\
\hline 
12&
0&
0.3533770670774835D+06&
12&
0&
0.3441656356582020D+06\\
&
4&
0.2089749967040276D+06&
&
3&
-0.2988963294769746D+06\\
&
8&
0.2086201911558935D+07&
&
6&
0.1981829408275373D+07\\
&
12&
0.3193240788535041D+09&
&
9&
0.1399645778709430D+07\\
&
&
&
&
12&
0.4855992637030970D+09\\
\hline 
14&
0&
0.7186127463179821D+07&
14&
0&
-0.1057046901404442D+08\\
&
4&
-0.9239306738374122D+07&
&
3&
-0.1094473082593862D+08\\
&
8&
-0.5851560934303580D+08 &
&
6&
0.7172818259530190D+07\\
&
12&
-0.2243098358149698D+10&
&
9&
0.1166548139252476D+09\\
&
&
&
&
12&
-0.3299496399383880D+10\\
\hline 
16&
0&
0.1168988444587698D+10&
16&
0&
-0.1553204312146170D+09\\
&
4&
0.5469289478144757D+09&
&
3&
0.2790914628186657D+09\\
&
8&
0.2661931236843469D+10&
&
6&
0.1592904788101633D+10\\
&
12&
0.5130698388451003D+11&
&
9&
0.9241099613788853D+10\\
&
16&
0.1540161278003348D+14 &
&
12&
0.8723232135625955D+11 \\
&
&
&
&
15&
0.3299919999077370D+10\\
\hline
\end{longtable}\par}
\vspace{0.3cm}
\end{table}


\eject


\begin{figure}

\caption{\label{figure: SimCell} Simulation cell and interior region.}

{\centering \includegraphics{UnitCell.eps} \par}
\end{figure}



\begin{figure}

\caption{\label{figure: ReplicateCells} Regions which contribute to the Coulomb
Matrix}

{\centering \includegraphics{RepCell.eps} \par}
\end{figure}



\begin{figure}

\caption{\label{figure: ErrorPFF} Error in the Periodic Far Field approximation
with increasing \protect\( \mathbf{L}_{max}\protect \) for two different
inner cell sums for \protect\( 64\protect \) molecules of water.}

{\centering \includegraphics{PFFMultipoles_water.ps} \par}
\end{figure}

\begin{figure}

\caption{\label{figure:DenseNitrogen} Iso-surface potential of a 100 molecule
Dense Nitrogen system}

{\centering \resizebox*{0.8\textwidth}{0.5\textheight}{\includegraphics{N2.eps}} \par}
\end{figure}



\begin{figure}

\caption{\label{figure: Scaling_Matrix_Build} Scaling Results for the matrix
builds \protect\( J_{QCTC}\protect \) and \protect\( K_{xc}\protect \)
for the dense molecular nitrogen periodic system.}
\end{figure}



\begin{figure}

\caption{\label{figure:Scaling_Diag} Scaling results for the overlap matrix
inverter and the density matrix solver. }
\end{figure}



\begin{figure}

\caption{\label{figure: Iso_zeolite} Iso-surface plot of zeolite.}
\end{figure}



\end{document}
