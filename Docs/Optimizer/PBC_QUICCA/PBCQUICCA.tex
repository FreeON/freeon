% NOTE TO AIP TYPSETERS: TO CONVERT FROM TWO-COL TO PREPRINT, SWITCH
% COMMENTOUT COMMAND FROM A TO B IE. USE:
%
%%\documentclass[prl,twocolumn,showpacs,twocolumngrid,superbib]{revtex4}
%\documentclass[prl,twocolumn,twocolumngrid,superbib]{revtex4}
%\newcommand{\commentoutB}[1]{}
%\newcommand{\commentoutA}[1]{#1}
%
% INSTEAD OF THE FOLLOWING:
%
\newcommand{\commentoutB}[1]{#1}
\newcommand{\commentoutA}[1]{}
%\documentclass[prl,aps,preprint,showpacs,superbib]{revtex4}
\documentclass[prl,aps,preprint,superbib,12pt]{revtex4}

\usepackage{graphicx}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{alltt}
\usepackage{fancyhdr}
\newcommand{\bms}[1]{{\boldsymbol #1}}
\renewcommand{\thefootnote}{\fnsymbol{footnote}}

%\draft
%\tighten
\pagestyle{fancy}

\begin{document}

\title{Geometry Optimization of Crystals by the Quasi-\\
       Independent Curvilinear Coordinate Approximation\footnotemark[1]}

\author{K\'aroly N\'emeth\footnotemark[1]}
\author{Matt Challacombe}
\author{Christopher J. Tymczak}
\author{Valery Weber}

\affiliation{Theoretical Division,\\ Los Alamos National Laboratory, \\ Los Alamos, NM 87545, USA}

\date{\today}

\begin{abstract}
This paper presents a performance-assessment 
of the recently developed quasi-independent curvilinear coordinate
approximation (QUICCA) method [K. N\'emeth and M. Challacombe,
J. Chem. Phys. {\bf 121}, 2877, (2004)] for the optimization of crystal 
structures. 
We demonstrate that the concept of quasi-independent
curvilinear coordinates is valid also under periodic boundary 
conditions,
and it leads to highly efficient crystal structure optimizations
as illustrated by a series of test calculations. 
The asessment of QUICCA for the optimization of crystal structures
prooves that QUICCA is a generally applicable algorithm
that is highly efficient for the optimization of both isolated 
molecules and crystals while it preserves an unparalleled robustness 
and simplicity of implementation.
\end{abstract}

%\pacs{31.15.-p,31.15.Ne,02.60.Pn, 45.10.Db, 02.40.Hw} 

\maketitle

\footnotetext[1]{\tt KNemeth@LANL.Gov}

\section{Introduction}
Internal coordinates are now routinely used in the optimization of 
molecular structures by most standard quantum chemistry program 
packages. A wealth of experience in geometry optimization justifies
the application of internal coordinates and shows their
superiority as compared to Cartesians. The reason behind the
experience is that internal coordinates exhibit much less
vibrational coupling than Cartesian ones do 
\cite{PPulay69,GFogarasi79,GFogarasi92,PPulay77}.
By recent proposals of Kudin {\it et.al.} \cite{KKudin01} and of
Andzelm {\it et.al.} \cite{JAndzelm01} the foundations of 
internal coordinate
crystal structure optimizations are laid down. These authors
pointed out how to build Wilson's B matrix \cite{EWilson55} 
when periodic boundary conditions are present. They have also
presented a few examples for succesful application of internal 
coordinates for the optimization of crystal structures. It is 
important to note that the paper by Andzelm {\it et.al.}, in our best
understanding, does neither contain the definitions of 
internal coordinate derivatives with respect to lattice parameters,
nor does describe simultaneous internal coordinate relaxation
of both atomic positions and lattice parameters.
The paper by Kudin {\it et.al.} accounts for both of these
features. We find that the construction of Wilson's B matrix
is described in both papers in a less compact, more case-specific 
way, by considering each internal coordinate event by separate 
discussions. This may be instructive but less suitable for
a reader who is interested in quick implementation.
Therefore, we repeat the formulation with the aim of mathematical
compactness that may be better suited for implementation.
Our selection of symmetry unique internal coordinates and treatment
of constraints does also differ from the one proposed by the previous
authors.
More important than these interpretative differences,
our main goal was to
assess the performance of our recently developed robust internal
coordinate optimizer, that is based on the concept of
quasi-independent curvilinear coordinates (QUICCA) \cite{KNemeth04}.
Similar to Baker's test set \cite{JBaker93}, we have set up 
a test set of ten crystal structures that we believe is representative
enough to a very broad range of possible applications. We carry out
geometry optimizations on this test set with the same accuracy
that is used in Baker's test set for isolated molecules.
Test calculations are carried out with both constrained and
relaxed lattice parameters. The results indicate that
QUICCA is generally applicable to both isolated molecule and crystal
structure optimizations, with high efficiency and great robustness,
while preserving an unparalleled simplicity in the implementation.

\section{Lattice summation for Wilson's B matrix}
Let us consider a three-dimensional crystal with atomic 
Cartesian positions $X$ that extend the range $[-\infty,\infty]$
in all spacial directions. The periodicity of the crystal
is given by the lattice vectors $A$, $B$ and $C$.
For this infinitely large crystal, local internal coordinates ($\phi$) 
can be defined, as usual for isolated molecules. Let us now suppose,
that there is periodicity also in the set of internal coordinates.
This being the case is simply a consequence of applying the 
same rules for the 
construction of internal coordinates everywhere in the crystal.
If this periodicity exists, a unique set of primitive internal 
coordinates, $\phi^{(000)}$ can be defined. Each $i$-th element of this
set, $\phi^{(000)}_{i}$ depends on the Cartesian coordinates of
maximum four atoms: 
\begin{equation}
\phi^{(000)}_{i}=\phi^{(000)}_{i}[
(a_{i1},k_{i1},l_{i1},m_{i1}),
(a_{i2},k_{i2},l_{i2},m_{i2}),
(a_{i3},k_{i3},l_{i3},m_{i3}),
(a_{i4},k_{i4},l_{i4},m_{i4})],
\end{equation}
where $a_{ij}$ ($j=1,2,3,4$) denotes serial numbers of atoms in 
a reference cell, called the 
central cell, and the corresponding $k_{ij}$, $l_{ij}$ and $m_{ij}$ 
denote integer cell indices.
The translationally unique $a_{ij}$ atoms and the 
$k_{ij}$, $l_{ij}$ and $m_{ij}$ 
cell indices together determine
the atoms within the infinite crystal that compose 
the $i$-th internal coordinate of the $\phi^{(000)}$ set. 

It should be noted, that the elementary cell in the
internal coordinate space has a different meaning than what 
the elementary cell in the Cartesian space is. This should
be clear from the fact that the internal coordinate elementary cell 
containes such $\phi^{(000)}_{i}$ coordinates that connect
two or more different Cartesian cells. Furthermore, the internal
coordinate central cell $\phi^{(000)}$ may be located over atoms, 
that are far
from the Cartesian elementary cell. For the sake of simplicity,
we choose the internal coordinate elementary cell to be in maximum
possible overlap with the atoms of the Cartesian elementary cell.

All internal coordinates of the crystal can be retrieved
by applying the same $T_{k_{T}l_{T}m_{T}}=k_{T}A+l_{T}B+m_{T}C$ 
translation vector to the atoms of $\phi^{(000)}$: 
\begin{equation}
\phi^{(k_{T}l_{T}m_{T})}_{i}=\phi^{(000)}_{i}[
(a_{i1},k_{i1}',l_{i1}',m_{i1}'),
(a_{i2},k_{i2}',l_{i2}',m_{i2}'),
(a_{i3},k_{i3}',l_{i3}',m_{i3}'),
(a_{i4},k_{i4}',l_{i4}',m_{i4}')] ,
\end{equation}
where $k_{ij}'=k_{ij}+k_{T}$ and the same holds for the $l$ and $m$ 
cell indices.
$k_{T}$, $l_{T}$ and $m_{T}$ denote arbitrary integers.
The corresponding Cartesian coordinates transform as
\begin{equation}
X^{(k_{ij}+k_{T},l_{ij}+k_{T},m_{ij}+k_{T})}_{a_{ij}} 
= X^{(k_{ij},l_{ij},m_{ij})}_{a_{ij}} + T_{k_{T}l_{T}m_{T}} .
\end{equation} 
All vector quantities here and in the forthcoming derivation
denote row vectors, unless otherwise noted.
Now, let us consider the relationship of an infinitesimally small
Cartesian displacement, $\delta X$ and the corresponding $\delta \phi$
internal coordinate displacement.
Because of the translational symmetry, displacements are the same
in all internal coordinate cells:
\begin{equation}
\delta \phi^{(klm)}_{i} = \delta \phi^{(000)}_{i} 
\end{equation}
for any $i$-th internal coordinate.
The displacements of the Cartesian coordinates, however, do not equal
for different cells: 
\begin{equation} \label{cartdispl}
\delta X^{(klm}_{a_{ij}} = \delta X^{(000)}_{ij}) + k \delta A 
+ l \delta B + m \delta C ,
\end{equation}
with $\delta A$, $\delta B$ and $\delta C$
being the displacements of the lattice vectors. 
The different behaviour of the internal and the Cartesian displacements
reflects the fact, that internal coordinates describe relative
atomic displacements, while Cartesian ones are absolute displacements, 
relative to the Cartesian coordinate axis.

The relationship between the Cartesian and internal coordinate 
displacements can be expressed by Wilson's $B$ matrix:
\begin{equation}
\delta \phi = B \delta X
\end{equation}
where $B$ here has the size of $\infty \times \infty$ and its
elements are given by
\begin{equation}
B_{pq}= \frac{\partial \phi_{p}}{\partial X_{q}} , 
\end{equation}
where $X_{q}$ denotes a single Cartesian coordinate of the set $X$.

It is enough to investigate the relationship of the internal 
coordinates of the central cell and all the Cartesian coordinates,
since all other internal coordinate displacements equal with the 
central cell ones:
\begin{equation} \label{intdispl1}
\delta \phi^{(000)}_{i} = \sum_{q=1}^{\infty} B^{(000)}_{iq} \delta X_{q} .
\end{equation}
Here, $B^{(000)}_{iq}$ denotes elements of the $B$ matrix that refer to
the central internal coordinate cell. All $i$-th internal coordinates
are members of the central internal coordinate cell.
Now, let us further decompose $\delta X_{q}$ and $B^{(000)}_{iq}$ 
to contributions from Cartesian cells:
\begin{equation} \label{latsum1}
\delta \phi^{(000)}_{i} = 
\sum_{j=1}^{4} 
B^{(000)(k_{ij}l_{ij}m_{ij})}_{ia_{ij}} [ \delta X^{(000)}_{a_{ij}} + k_{ij} \delta A + 
l_{ij} \delta B + m_{ij} \delta C ]^{t} ,
\end{equation}
where the superscript $t$ denotes transposition
and $B^{(000)(k_{ij}l_{ij}m_{ij})}_{ia_{ij}}$ is defined by
\begin{equation} 
B^{(000)(k_{ij}l_{ij}m_{ij})}_{ia_{ij}} = \frac{\partial 
\phi^{(000)}_{i}}{\partial X^{(k_{ij}l_{ij}m_{ij})}_{a_{ij}}} .
\end{equation} 
The summation over $j$ goes over those atoms that compose 
the $i$-th internal coordinate. The number of 
these atoms never exceeds four if primitive internal coordinates are used.
In case of more complex internal coordinates that are linear 
combinations of primitive ones, the $B$ matrix of the composite 
internal coordinates will be built
by appropriately transforming the $B$ matrix of the primitives. 
We do not consider this case further in the 
present paper.
Observe that $B^{(000)(k_{ij}l_{ij}m_{ij})}_{ia_{ij}}$ is a 
vector with three components referring to the Cartesian components
of atom $a_{ij}$, {\it and} to the Cartesian components of the
lattice vectors $A$, $B$ and $C$.

Now, let us introduce the matrices $B^{(A)}$, $B^{(B)}$ and $B^{(C)}$.
$B^{(A)}$ is constructed by
\begin{equation} \label{matba}
B^{(A)}_{i} = \sum_{j=1}^{4} k_{ij} B^{(000)(k_{ij}l_{ij}m_{ij})}_{ia_{ij}} . 
\end{equation}
$B^{(B)}_{i}$ and $B^{(C)}_{i}$ are given by the same formula 
as $B^{(A)}_{i}$ except that
the multiplicativ factor $k_{ij}$ in Eqn. \ref{matba} is exchanged to 
$l_{ij}$ and $m_{ij}$, respectively. Each of these three matrices
are of the size $N_{i} \times 3$, where $N_{i}$ is the number of
internal coordinates in the central cell $\phi^{000}$.

The displacements of the lattice vectors affect the displacements
of the internal coordinates via the matrices 
$B^{(A)}$, $B^{(B)}$ and $B^{(C)}$.
A certain $j$-th component atom of the $i$-th internal
coordinate gives a nonzero contribution to those of these three
matrices for which it has a nonzero corresponding lattice index.
E.g. if the $j$-th atom is located in the cell $(100)$,
it will contribute only to $B^{(A)}$. It may also happen that
each of the four atoms of an internal coordinate contribute
to all three matrices, $B^{(A)}$, $B^{(B)}$ and $B^{(C)}$,
when all cell-indices of all component-atoms differ from zero.

Thus, Eqn. \ref{latsum1} can be rewritten to
\begin{equation} \label{latsum2}
\delta \phi^{(000)}_{i} = \left[ [\oplus_{j=1}^{4} 
B^{(000)(k_{ij}l_{ij}m_{ij})}_{ia_{ij}} 
] \oplus B^{(A)}_{i} \oplus B^{(B)}_{i} \oplus B^{(C)}_{i}
\right] 
\left[
[\oplus_{j=1}^{4} \delta X^{(000)}_{ia_{ij}} ] 
\oplus \delta A 
\oplus \delta B 
\oplus \delta C 
\right]^{t} .
\end{equation}
The first term in the bracket on the right hand side of Eqn. 
\ref{latsum2} provides $B^{\rm cr}$, the effective $B$ matrix for crystals:
\begin{equation}
B^{\rm cr}_{i} =
[\oplus_{j=1}^{4}
B^{(000)(k_{ij}l_{ij}m_{ij})}_{ia_{ij}}
] \oplus B^{(A)}_{i} \oplus B^{(B)}_{i} \oplus B^{(C)}_{i} ,
\end{equation}
while the second term provides the displacements of the atomic positions
and the lattice vectors.
The description of the effective $B$ matrix, $B^{\rm cr}$, 
as provided by Eqn. \ref{latsum2}, deals only with the
nonzero elements of $B^{\rm cr}$. However, it should be clear from the
formalism, that
$B^{\rm cr}$ has $3 \times (N+3)$ colums, where $N$ is the number of atoms
in the central cell. This can be seen from the fact, that the subscript 
$a_{ij}$ scans all atoms of the central cell.

The only thing that has yet left out from the determination of $B^{\rm cr}$ is
the computation of the values $B^{(000)(k_{ij}l_{ij}m_{ij})}_{ia_{ij}}$.
Whenever these values are to be computed, the absolute Cartesian positions
of any $j$-th atom of the $i$-th internal coordinate are generated, based
on the knowledge of the corresponding translationally unique atom $a_{ij}$
and the cell indices $k_{ij}$, $l_{ij}$ and $m_{ij}$. Once the absolute
Cartesian positions are recovered, $B^{(000)(k_{ij}l_{ij}m_{ij})}_{ia_{ij}}$
is determined exactly as for isolated molecules \cite{EWilson55}. Thus,
the derivation of $B^{\rm cr}$ is completed.

\section{Lattice summation for the inverse B matrix}

\bibliography{../../Bib/mondo_new}
\end{document}

