! ---------------------------------------------------------- 
! COMPUTES THE INTEGRAL CLASS (P P|S P) 
! ---------------------------------------------------------- 
   SUBROUTINE Int3313(Ax,Ay,Az,Bx,By,Bz,Cx,Cy,Cz, &  
                      Dx,Dy,Dz,ShlPrAC2,ShlPrBD2,I) 
      USE DerivedTypes
      USE GlobalScalars
      USE GammaF3
      USE ShellPairStruct
      IMPLICIT REAL(DOUBLE) (V,W)
      TYPE(ShellPair), POINTER :: ShlPrAC2,ShlPrBD2 
      REAL(DOUBLE),DIMENSION(3) :: AuxR
      REAL(DOUBLE),DIMENSION(10,4) :: MBarN=0D0
      REAL(DOUBLE),DIMENSION(4,4,1,4) :: I
      REAL(DOUBLE)  :: Zeta,Eta,r1xZpE,HfxZpE,r1x2E,r1x2Z,ExZpE,ZxZpE,Omega,Up,Uq,Upq
      REAL(DOUBLE)  :: Ax,Ay,Az,Bx,By,Bz,Cx,Cy,Cz,Dx,Dy,Dz,Qx,Qy,Qz,Px,Py,Pz,Wx,Wy,Wz
      REAL(DOUBLE)  :: QCx,QCy,QCz,PAx,PAy,PAz,PQx,PQy,PQz,WPx,WPy,WPz,WQx,WQy,WQz   
      REAL(DOUBLE)  :: T,ET,TwoT,InvT,SqInvT
      INTEGER       :: J,K,L
      DO J=1,ShlPrBD2%L ! K^2 VRR |N0) loop 
         Eta=ShlPrBD2%SP(1,J)
         Qx =ShlPrBD2%SP(2,J)
         Qy =ShlPrBD2%SP(3,J)
         Qz =ShlPrBD2%SP(4,J)
         Uq =ShlPrBD2%SP(5,J)
         QCx=Qx-Cx
         QCy=Qy-Cy
         QCz=Qz-Cz
         DO K=1,ShlPrAC2%L ! K^2 VRR (M0| loop 
            Zeta=ShlPrAC2%SP(1,K)
            Px  =ShlPrAC2%SP(2,K)
            Py  =ShlPrAC2%SP(3,K)
            Pz  =ShlPrAC2%SP(4,K)
            Up  =ShlPrAC2%SP(5,K)
            r1xZpE=One/(Zeta+Eta)
            Upq=SQRT(r1xZpE)*Up*Uq
            HfxZpE=Half/(Zeta+Eta)
            r1x2E=Half/Eta
            r1x2Z=Half/Zeta
            ExZpE=Eta*r1xZpE
            ZxZpE=Zeta*r1xZpE
            Omega=ExZpe+ZxZpE
            Wx=(Zeta*Px+Eta*Qx)*r1xZpE
            Wy=(Zeta*Py+Eta*Qy)*r1xZpE
            Wz=(Zeta*Pz+Eta*Qz)*r1xZpE
            PAx=Px-Ax
            PAy=Py-Ay
            PAz=Pz-Az
            PQx=Px-Qx
            PQy=Py-Qy
            PQz=Pz-Qz
            WPx=Wx-Px
            WPy=Wy-Py
            WPz=Wz-Pz
            WQx=Wx-Qx
            WQy=Wy-Qy
            WQz=Wz-Qz
            T=Omega*(PQx*PQx+PQy*PQy+PQz*PQz)
            IF(T<Gamma_Switch)THEN
              L=AINT(T*Gamma_Grid)
              V1=Upq
              V2=-Two*Omega
              ET=EXP(-T)
              TwoT=Two*T
              W3=(F3_0(L)+T*(F3_1(L)+T*(F3_2(L)+T*(F3_3(L)+T*F3_4(L)))))
              W2=+2.000000000000000D-01*(TwoT*W3+ET)
              W1=+3.333333333333333D-01*(TwoT*W2+ET)
              W0=TwoT*W1+ET
              AuxR(0)=V1*W0
              V1=V2*V1
              AuxR(1)=V1*W1
              V1=V2*V1
              AuxR(2)=V1*W2
              V1=V2*V1
              AuxR(3)=V1*W3
            ELSE
              InvT=One/T
              SqInvT=Upq*DSQRT(InvT)
              AuxR(0)=+8.862269254527580D-01*SqInvT
              SqInvT=SqInvT*InvT
              AuxR(1)=+4.431134627263790D-01*SqInvT
              SqInvT=SqInvT*InvT
              AuxR(2)=+6.646701940895685D-01*SqInvT
              SqInvT=SqInvT*InvT
              AuxR(3)=+1.661675485223921D+00*SqInvT
            ENDIF
            V1=AuxR(0)
            V2=PAx*V1
            V3=AuxR(1)
            V4=V3*WPx
            V5=PAy*V1
            V6=V3*WPy
            V7=PAz*V1
            V8=V3*WPz
            V9=-(ExZpE*V3)
            V10=V1+V9
            V11=r1x2Z*V10
            V12=V2+V4
            V13=PAx*V3
            V14=AuxR(2)
            V15=V14*WPx
            V16=V13+V15
            V17=V5+V6
            V18=PAx*V17
            V19=PAy*V3
            V20=V14*WPy
            V21=V19+V20
            V22=V21*WPx
            V23=V7+V8
            V24=PAx*V23
            V25=PAz*V3
            V26=V14*WPz
            V27=V25+V26
            V28=V27*WPx
            V29=PAy*V23
            V30=V27*WPy
            V31=QCx*V1
            V32=V3*WQx
            V33=HfxZpE*V3
            V34=QCx*V12
            V35=V16*WQx
            V36=QCx*V17
            V37=V21*WQx
            V38=QCx*V23
            V39=V27*WQx
            V40=HfxZpE*V16
            V41=QCx*V3
            V42=V14*WQx
            V43=V41+V42
            V44=-(ExZpE*V43)
            V45=V31+V32+V44
            V46=r1x2Z*V45
            V47=HfxZpE*V14
            V48=PAx*V14
            V49=AuxR(3)
            V50=V49*WPx
            V51=V48+V50
            V52=HfxZpE*V21
            V53=V18+V22
            V54=PAx*V21
            V55=PAy*V14
            V56=V49*WPy
            V57=V55+V56
            V58=V57*WPx
            V59=V54+V58
            V60=HfxZpE*V27
            V61=V24+V28
            V62=PAx*V27
            V63=PAz*V14
            V64=V49*WPz
            V65=V63+V64
            V66=V65*WPx
            V67=V62+V66
            V68=V29+V30
            V69=PAy*V27
            V70=V65*WPy
            V71=V69+V70
            V72=QCy*V12
            V73=V16*WQy
            V74=QCy*V17
            V75=V21*WQy
            V76=QCy*V23
            V77=V27*WQy
            V78=QCz*V12
            V79=V16*WQz
            V80=QCz*V17
            V81=V21*WQz
            V82=QCz*V23
            V83=V27*WQz
            MBarN(1,1)=V1+MBarN(1,1)
            MBarN(2,1)=V2+V4+MBarN(2,1)
            MBarN(3,1)=V5+V6+MBarN(3,1)
            MBarN(4,1)=V7+V8+MBarN(4,1)
            MBarN(5,1)=V11+PAx*V12+V16*WPx+MBarN(5,1)
            MBarN(6,1)=V18+V22+MBarN(6,1)
            MBarN(7,1)=V11+PAy*V17+V21*WPy+MBarN(7,1)
            MBarN(8,1)=V24+V28+MBarN(8,1)
            MBarN(9,1)=V29+V30+MBarN(9,1)
            MBarN(10,1)=V11+PAz*V23+V27*WPz+MBarN(10,1)
            MBarN(1,2)=V31+V32+MBarN(1,2)
            MBarN(2,2)=V33+V34+V35+MBarN(2,2)
            MBarN(3,2)=V36+V37+MBarN(3,2)
            MBarN(4,2)=V38+V39+MBarN(4,2)
            W1=PAx*(V33+V34+V35)+V40
            W2=V46+WPx*(QCx*V16+V47+V51*WQx)+MBarN(5,2)
            MBarN(5,2)=W1+W2
            MBarN(6,2)=V52+QCx*V53+V59*WQx+MBarN(6,2)
            W1=PAy*(V36+V37)+V46
            W2=WPy*(QCx*V21+V57*WQx)+MBarN(7,2)
            MBarN(7,2)=W1+W2
            MBarN(8,2)=V60+QCx*V61+V67*WQx+MBarN(8,2)
            MBarN(9,2)=QCx*V68+V71*WQx+MBarN(9,2)
            W1=PAz*(V38+V39)+V46
            W2=WPz*(QCx*V27+V65*WQx)+MBarN(10,2)
            MBarN(10,2)=W1+W2
            MBarN(1,3)=V1+MBarN(1,3)
            MBarN(2,3)=V72+V73+MBarN(2,3)
            MBarN(3,3)=V33+V74+V75+MBarN(3,3)
            MBarN(4,3)=V76+V77+MBarN(4,3)
            W1=V11+PAx*(V72+V73)
            W2=WPx*(QCy*V16+V51*WQy)+MBarN(5,3)
            MBarN(5,3)=W1+W2
            MBarN(6,3)=V40+QCy*V53+V59*WQy+MBarN(6,3)
            W1=V11+V52
            W2=PAy*(V33+V74+V75)
            W3=WPy*(QCy*V21+V47+V57*WQy)+MBarN(7,3)
            MBarN(7,3)=W1+W2+W3
            MBarN(8,3)=QCy*V61+V67*WQy+MBarN(8,3)
            MBarN(9,3)=V60+QCy*V68+V71*WQy+MBarN(9,3)
            W1=V11+PAz*(V76+V77)
            W2=WPz*(QCy*V27+V65*WQy)+MBarN(10,3)
            MBarN(10,3)=W1+W2
            MBarN(1,4)=V1+MBarN(1,4)
            MBarN(2,4)=V78+V79+MBarN(2,4)
            MBarN(3,4)=V80+V81+MBarN(3,4)
            MBarN(4,4)=V33+V82+V83+MBarN(4,4)
            W1=V11+PAx*(V78+V79)
            W2=WPx*(QCz*V16+V51*WQz)+MBarN(5,4)
            MBarN(5,4)=W1+W2
            MBarN(6,4)=QCz*V53+V59*WQz+MBarN(6,4)
            W1=V11+PAy*(V80+V81)
            W2=WPy*(QCz*V21+V57*WQz)+MBarN(7,4)
            MBarN(7,4)=W1+W2
            MBarN(8,4)=V40+QCz*V61+V67*WQz+MBarN(8,4)
            MBarN(9,4)=V52+QCz*V68+V71*WQz+MBarN(9,4)
            W1=V11+V60
            W2=PAz*(V33+V82+V83)
            W3=WPz*(QCz*V27+V47+V65*WQz)+MBarN(10,4)
            MBarN(10,4)=W1+W2+W3
         ENDDO ! (M0| loop
      ENDDO ! |N0) loop
      ! HRR 
      V1=MBarN(2,1)*CDx
      V2=MBarN(2,2)+V1
      V3=MBarN(6,1)*CDx
      V4=MBarN(3,1)*CDx
      V5=MBarN(3,2)+V4
      V6=MBarN(8,1)*CDx
      V7=MBarN(4,1)*CDx
      V8=MBarN(4,2)+V7
      V9=MBarN(9,1)*CDx
      V10=MBarN(2,1)*CDy
      V11=MBarN(2,3)+V10
      V12=MBarN(6,1)*CDy
      V13=MBarN(3,1)*CDy
      V14=MBarN(3,3)+V13
      V15=MBarN(8,1)*CDy
      V16=MBarN(4,1)*CDy
      V17=MBarN(4,3)+V16
      V18=MBarN(9,1)*CDy
      V19=MBarN(2,1)*CDz
      V20=MBarN(2,4)+V19
      V21=MBarN(6,1)*CDz
      V22=MBarN(3,1)*CDz
      V23=MBarN(3,4)+V22
      V24=MBarN(8,1)*CDz
      V25=MBarN(4,1)*CDz
      V26=MBarN(4,4)+V25
      V27=MBarN(9,1)*CDz
      I(2,2,1,2)=MBarN(5,2)+MBarN(5,1)*CDx+V2*ABx+I(2,2,1,2)
      I(3,2,1,2)=MBarN(6,2)+V3+V5*ABx+I(3,2,1,2)
      I(4,2,1,2)=MBarN(8,2)+V6+V8*ABx+I(4,2,1,2)
      I(2,3,1,2)=MBarN(6,2)+V3+V2*ABy+I(2,3,1,2)
      I(3,3,1,2)=MBarN(7,2)+MBarN(7,1)*CDx+V5*ABy+I(3,3,1,2)
      I(4,3,1,2)=MBarN(9,2)+V9+V8*ABy+I(4,3,1,2)
      I(2,4,1,2)=MBarN(8,2)+V6+V2*ABz+I(2,4,1,2)
      I(3,4,1,2)=MBarN(9,2)+V9+V5*ABz+I(3,4,1,2)
      I(4,4,1,2)=MBarN(10,2)+MBarN(10,1)*CDx+V8*ABz+I(4,4,1,2)
      I(2,2,1,3)=MBarN(5,3)+V11*ABx+MBarN(5,1)*CDy+I(2,2,1,3)
      I(3,2,1,3)=MBarN(6,3)+V12+V14*ABx+I(3,2,1,3)
      I(4,2,1,3)=MBarN(8,3)+V15+V17*ABx+I(4,2,1,3)
      I(2,3,1,3)=MBarN(6,3)+V12+V11*ABy+I(2,3,1,3)
      I(3,3,1,3)=MBarN(7,3)+MBarN(7,1)*CDy+V14*ABy+I(3,3,1,3)
      I(4,3,1,3)=MBarN(9,3)+V18+V17*ABy+I(4,3,1,3)
      I(2,4,1,3)=MBarN(8,3)+V15+V11*ABz+I(2,4,1,3)
      I(3,4,1,3)=MBarN(9,3)+V18+V14*ABz+I(3,4,1,3)
      I(4,4,1,3)=MBarN(10,3)+MBarN(10,1)*CDy+V17*ABz+I(4,4,1,3)
      I(2,2,1,4)=MBarN(5,4)+V20*ABx+MBarN(5,1)*CDz+I(2,2,1,4)
      I(3,2,1,4)=MBarN(6,4)+V21+V23*ABx+I(3,2,1,4)
      I(4,2,1,4)=MBarN(8,4)+V24+V26*ABx+I(4,2,1,4)
      I(2,3,1,4)=MBarN(6,4)+V21+V20*ABy+I(2,3,1,4)
      I(3,3,1,4)=MBarN(7,4)+V23*ABy+MBarN(7,1)*CDz+I(3,3,1,4)
      I(4,3,1,4)=MBarN(9,4)+V27+V26*ABy+I(4,3,1,4)
      I(2,4,1,4)=MBarN(8,4)+V24+V20*ABz+I(2,4,1,4)
      I(3,4,1,4)=MBarN(9,4)+V27+V23*ABz+I(3,4,1,4)
      I(4,4,1,4)=MBarN(10,4)+MBarN(10,1)*CDz+V26*ABz+I(4,4,1,4)
   END SUBROUTINE Int3313
