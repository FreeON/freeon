! ---------------------------------------------------------- 
! COMPUTES THE INTEGRAL CLASS (P S|P S) 
! ---------------------------------------------------------- 
   SUBROUTINE dInt3131(PrmBufB,LBra,PrmBufK,LKet,ACInfo,BDInfo, & 
                              OA,LDA,OB,LDB,OC,LDC,OD,LDD,GOA,GOB,GOC,GOD,NINT,PBC,dI) 
      USE DerivedTypes
      USE GlobalScalars
      USE ShellPairStruct
      USE GammaF2
      USE GammaF3
      IMPLICIT REAL(DOUBLE) (A,I,V,W)
      INTEGER        :: LBra,LKet,NINT
      REAL(DOUBLE)   :: PrmBufB(7,LBra),PrmBufK(7,LKet)
      TYPE(SmallAtomInfo) :: ACInfo,BDInfo
      TYPE(PBCInfo) :: PBC
      REAL(DOUBLE) :: dI(NINT,12)
      REAL(DOUBLE)  :: Zeta,Eta,r1xZpE,HfxZpE,r1x2E,r1x2Z,ExZpE,ZxZpE,Omega,Up,Uq,Upq
      REAL(DOUBLE)  :: Ax,Ay,Az,Bx,By,Bz,Cx,Cy,Cz,Dx,Dy,Dz,Qx,Qy,Qz,Px,Py,Pz
      REAL(DOUBLE)  :: QCx,QCy,QCz,PAx,PAy,PAz,PQx,PQy,PQz,WPx,WPy,WPz,WQx,WQy,WQz   
      REAL(DOUBLE)  :: T,ET,TwoT,InvT,SqInvT,ABx,ABy,ABz,CDx,CDy,CDz
      REAL(DOUBLE)  :: Alpha,Beta,Gamma
      INTEGER       :: OffSet,CrtSet
      INTEGER       :: OA,LDA,OB,LDB,OC,LDC,OD,LDD,J,K,L
      INTEGER       :: GOA,GOB,GOC,GOD
      REAL(DOUBLE)  :: FPQx,FPQy,FPQz
      CrtSet1=GOA
      CrtSet2=GOA+1
      CrtSet3=GOA+2
      CrtSet4=GOB+3
      CrtSet5=GOB+4
      CrtSet6=GOB+5
      CrtSet7=GOC+6
      CrtSet8=GOC+7
      CrtSet9=GOC+8
      CrtSet10=GOD+9
      CrtSet11=GOD+10
      CrtSet12=GOD+11
      I1Bar1=0.0d0
      I2Bar1=0.0d0
      I3Bar1=0.0d0
      I4Bar1=0.0d0
      I5Bar1=0.0d0
      I6Bar1=0.0d0
      I7Bar1=0.0d0
      I8Bar1=0.0d0
      I9Bar1=0.0d0
      I10Bar1=0.0d0
      I1Bar2=0.0d0
      I2Bar2=0.0d0
      I3Bar2=0.0d0
      I4Bar2=0.0d0
      I5Bar2=0.0d0
      I6Bar2=0.0d0
      I7Bar2=0.0d0
      I8Bar2=0.0d0
      I9Bar2=0.0d0
      I10Bar2=0.0d0
      I1Bar3=0.0d0
      I2Bar3=0.0d0
      I3Bar3=0.0d0
      I4Bar3=0.0d0
      I5Bar3=0.0d0
      I6Bar3=0.0d0
      I7Bar3=0.0d0
      I8Bar3=0.0d0
      I9Bar3=0.0d0
      I10Bar3=0.0d0
      I1Bar4=0.0d0
      I2Bar4=0.0d0
      I3Bar4=0.0d0
      I4Bar4=0.0d0
      I5Bar4=0.0d0
      I6Bar4=0.0d0
      I7Bar4=0.0d0
      I8Bar4=0.0d0
      I9Bar4=0.0d0
      I10Bar4=0.0d0
      I1Bar5=0.0d0
      I2Bar5=0.0d0
      I3Bar5=0.0d0
      I4Bar5=0.0d0
      I1Bar6=0.0d0
      I2Bar6=0.0d0
      I3Bar6=0.0d0
      I4Bar6=0.0d0
      I1Bar7=0.0d0
      I2Bar7=0.0d0
      I3Bar7=0.0d0
      I4Bar7=0.0d0
      I1Bar8=0.0d0
      I2Bar8=0.0d0
      I3Bar8=0.0d0
      I4Bar8=0.0d0
      I1Bar9=0.0d0
      I2Bar9=0.0d0
      I3Bar9=0.0d0
      I4Bar9=0.0d0
      I1Bar10=0.0d0
      I2Bar10=0.0d0
      I3Bar10=0.0d0
      I4Bar10=0.0d0
      Ia10Bar4=0D0
      Ia10Bar3=0D0
      Ia10Bar2=0D0
      Ia9Bar4=0D0
      Ia9Bar3=0D0
      Ia9Bar2=0D0
      Ia7Bar4=0D0
      Ia7Bar3=0D0
      Ia7Bar2=0D0
      Ia8Bar4=0D0
      Ia8Bar3=0D0
      Ia8Bar2=0D0
      Ia6Bar4=0D0
      Ia6Bar3=0D0
      Ia6Bar2=0D0
      Ia5Bar4=0D0
      Ia5Bar3=0D0
      Ia5Bar2=0D0
      Ib4Bar4=0D0
      Ib4Bar3=0D0
      Ib4Bar2=0D0
      Ib10Bar4=0D0
      Ib10Bar3=0D0
      Ib10Bar2=0D0
      Ib3Bar4=0D0
      Ib3Bar3=0D0
      Ib3Bar2=0D0
      Ib9Bar4=0D0
      Ib9Bar3=0D0
      Ib9Bar2=0D0
      Ib7Bar4=0D0
      Ib7Bar3=0D0
      Ib7Bar2=0D0
      Ib2Bar4=0D0
      Ib2Bar3=0D0
      Ib2Bar2=0D0
      Ib8Bar4=0D0
      Ib8Bar3=0D0
      Ib8Bar2=0D0
      Ib6Bar4=0D0
      Ib6Bar3=0D0
      Ib6Bar2=0D0
      Ib5Bar4=0D0
      Ib5Bar3=0D0
      Ib5Bar2=0D0
      Ic4Bar10=0D0
      Ic4Bar9=0D0
      Ic4Bar7=0D0
      Ic4Bar8=0D0
      Ic4Bar6=0D0
      Ic4Bar5=0D0
      Ic3Bar10=0D0
      Ic3Bar9=0D0
      Ic3Bar7=0D0
      Ic3Bar8=0D0
      Ic3Bar6=0D0
      Ic3Bar5=0D0
      Ic2Bar10=0D0
      Ic2Bar9=0D0
      Ic2Bar7=0D0
      Ic2Bar8=0D0
      Ic2Bar6=0D0
      Ic2Bar5=0D0
      Ax=ACInfo%Atm1X
      Ay=ACInfo%Atm1Y
      Az=ACInfo%Atm1Z
      Bx=ACInfo%Atm2X
      By=ACInfo%Atm2Y
      Bz=ACInfo%Atm2Z
      Cx=BDInfo%Atm1X
      Cy=BDInfo%Atm1Y
      Cz=BDInfo%Atm1Z
      Dx=BDInfo%Atm2X
      Dy=BDInfo%Atm2Y
      Dz=BDInfo%Atm2Z
      ABx=Ax-Bx
      ABy=Ay-By
      ABz=Az-Bz
      CDx=Cx-Dx
      CDy=Cy-Dy
      CDz=Cz-Dz
      DO J=1,LKet ! K^2 VRR |N0) loop 
         Eta=PrmBufK(1,J)
         Qx =PrmBufK(2,J)
         Qy =PrmBufK(3,J)
         Qz =PrmBufK(4,J)
         Uq =PrmBufK(5,J)
         Gamma =PrmBufK(6,J)
         QCx=Qx-Cx
         QCy=Qy-Cy
         QCz=Qz-Cz
         DO K=1,LBra ! K^2 VRR (M0| loop 
            Zeta=PrmBufB(1,K)
            Px  =PrmBufB(2,K)
            Py  =PrmBufB(3,K)
            Pz  =PrmBufB(4,K)
            Up  =PrmBufB(5,K)
            Alpha =PrmBufB(6,K)
            Beta  =PrmBufB(7,K)
            r1xZpE=One/(Zeta+Eta)
            Upq=SQRT(r1xZpE)*Up*Uq
            HfxZpE=Half/(Zeta+Eta)
            r1x2E=Half/Eta
            r1x2Z=Half/Zeta
            ExZpE=Eta*r1xZpE
            ZxZpE=Zeta*r1xZpE
            Omega=Eta*Zeta*r1xZpE
            PAx=Px-Ax
            PAy=Py-Ay
            PAz=Pz-Az
            PQx=Px-Qx
            PQy=Py-Qy
            PQz=Pz-Qz
      ! Need to be improved...
            FPQx = PQx*PBC%InvBoxSh%D(1,1)+PQy*PBC%InvBoxSh%D(1,2)+PQz*PBC%InvBoxSh%D(1,3)
            FPQy = PQy*PBC%InvBoxSh%D(2,2)+PQz*PBC%InvBoxSh%D(2,3)
            FPQz = PQz*PBC%InvBoxSh%D(3,3)
            IF(PBC%AutoW%I(1)==1) FPQx = FPQx-ANINT(ANINT(FPQx*1d9)*1d-9)
            IF(PBC%AutoW%I(2)==1) FPQy = FPQy-ANINT(ANINT(FPQy*1d9)*1d-9)
            IF(PBC%AutoW%I(3)==1) FPQz = FPQz-ANINT(ANINT(FPQz*1d9)*1d-9)
            PQx  = FPQx*PBC%BoxShape%D(1,1)+FPQy*PBC%BoxShape%D(1,2)+FPQz*PBC%BoxShape%D(1,3)
            PQy  = FPQy*PBC%BoxShape%D(2,2)+FPQz*PBC%BoxShape%D(2,3)
            PQz  = FPQz*PBC%BoxShape%D(3,3)
      !
            WPx = -Eta*PQx*r1xZpE
            WPy = -Eta*PQy*r1xZpE
            WPz = -Eta*PQz*r1xZpE
            WQx = Zeta*PQx*r1xZpE
            WQy = Zeta*PQy*r1xZpE
            WQz = Zeta*PQz*r1xZpE
            T=Omega*(PQx*PQx+PQy*PQy+PQz*PQz)
            IF(T<Gamma_Switch)THEN
              L=AINT(T*Gamma_Grid)
              ET=EXP(-T)
              TwoT=Two*T
              W3=(F3_0(L)+T*(F3_1(L)+T*(F3_2(L)+T*(F3_3(L)+T*F3_4(L)))))
              W2=+2.000000000000000D-01*(TwoT*W3+ET)
              W1=+3.333333333333333D-01*(TwoT*W2+ET)
              W0=TwoT*W1+ET
              AuxR0=Upq*W0
              AuxR1=Upq*W1
              AuxR2=Upq*W2
              AuxR3=Upq*W3
            ELSE
              InvT=One/T
              SqInvT=DSQRT(InvT)
              AuxR0=+8.862269254527580D-01*Upq*SqInvT
              SqInvT=SqInvT*InvT
              AuxR1=+4.431134627263790D-01*Upq*SqInvT
              SqInvT=SqInvT*InvT
              AuxR2=+6.646701940895685D-01*Upq*SqInvT
              SqInvT=SqInvT*InvT
              AuxR3=+1.661675485223921D+00*Upq*SqInvT
            ENDIF
            V1=AuxR0*PAx
            V2=AuxR1*WPx
            V3=V1+V2
            V4=AuxR0*PAy
            V5=AuxR1*WPy
            V6=V4+V5
            V7=AuxR0*PAz
            V8=AuxR1*WPz
            V9=V7+V8
            V10=-(AuxR1*ExZpE)
            V11=AuxR0+V10
            V12=r1x2Z*V11
            V13=AuxR1*PAx
            V14=AuxR2*WPx
            V15=V13+V14
            V16=PAx*V6
            V17=AuxR1*PAy
            V18=AuxR2*WPy
            V19=V17+V18
            V20=V19*WPx
            V21=V16+V20
            V22=PAx*V9
            V23=AuxR1*PAz
            V24=AuxR2*WPz
            V25=V23+V24
            V26=V25*WPx
            V27=V22+V26
            V28=PAy*V9
            V29=V25*WPy
            V30=V28+V29
            V31=AuxR0*QCx
            V32=AuxR1*WQx
            V33=V31+V32
            V34=AuxR1*HfxZpE
            V35=QCx*V3
            V36=V15*WQx
            V37=V34+V35+V36
            V38=QCx*V6
            V39=V19*WQx
            V40=V38+V39
            V41=QCx*V9
            V42=V25*WQx
            V43=V41+V42
            V44=HfxZpE*V15
            V45=AuxR2*HfxZpE
            V46=QCx*V15
            V47=AuxR2*PAx
            V48=AuxR3*WPx
            V49=V47+V48
            V50=V49*WQx
            V51=V45+V46+V50
            V52=AuxR1*QCx
            V53=AuxR2*WQx
            V54=V52+V53
            V55=-(ExZpE*V54)
            V56=V31+V32+V55
            V57=r1x2Z*V56
            V58=HfxZpE*V19
            V59=PAx*V19
            V60=AuxR2*PAy
            V61=AuxR3*WPy
            V62=V60+V61
            V63=V62*WPx
            V64=V59+V63
            V65=QCx*V19
            V66=V62*WQx
            V67=V65+V66
            V68=HfxZpE*V25
            V69=PAx*V25
            V70=AuxR2*PAz
            V71=AuxR3*WPz
            V72=V70+V71
            V73=V72*WPx
            V74=V69+V73
            V75=PAy*V25
            V76=V72*WPy
            V77=V75+V76
            V78=QCx*V25
            V79=V72*WQx
            V80=V78+V79
            V81=AuxR0*QCy
            V82=AuxR1*WQy
            V83=V81+V82
            V84=QCy*V3
            V85=V15*WQy
            V86=V84+V85
            V87=QCy*V6
            V88=V19*WQy
            V89=V34+V87+V88
            V90=QCy*V9
            V91=V25*WQy
            V92=V90+V91
            V93=QCy*V15
            V94=V49*WQy
            V95=V93+V94
            V96=AuxR1*QCy
            V97=AuxR2*WQy
            V98=V96+V97
            V99=-(ExZpE*V98)
            V100=V81+V82+V99
            V101=r1x2Z*V100
            V102=QCy*V19
            V103=V62*WQy
            V104=V102+V103+V45
            V105=QCy*V25
            V106=V72*WQy
            V107=V105+V106
            V108=AuxR0*QCz
            V109=AuxR1*WQz
            V110=V108+V109
            V111=QCz*V3
            V112=V15*WQz
            V113=V111+V112
            V114=QCz*V6
            V115=V19*WQz
            V116=V114+V115
            V117=QCz*V9
            V118=V25*WQz
            V119=V117+V118+V34
            V120=QCz*V15
            V121=V49*WQz
            V122=V120+V121
            V123=AuxR1*QCz
            V124=AuxR2*WQz
            V125=V123+V124
            V126=-(ExZpE*V125)
            V127=V108+V109+V126
            V128=r1x2Z*V127
            V129=QCz*V19
            V130=V62*WQz
            V131=V129+V130
            V132=QCz*V25
            V133=V72*WQz
            V134=V132+V133+V45
            V135=-(AuxR1*ZxZpE)
            V136=AuxR0+V135
            V137=r1x2E*V136
            V138=-(V15*ZxZpE)
            V139=V1+V138+V2
            V140=r1x2E*V139
            V141=-(V19*ZxZpE)
            V142=V141+V4+V5
            V143=r1x2E*V142
            V144=-(V25*ZxZpE)
            V145=V144+V7+V8
            V146=r1x2E*V145
            V147=HfxZpE*V98
            V148=HfxZpE*V125
            RawI1Bar1=AuxR0
            I1Bar1=RawI1Bar1+I1Bar1
            RawI2Bar1=V3
            I2Bar1=RawI2Bar1+I2Bar1
            RawI3Bar1=V6
            I3Bar1=RawI3Bar1+I3Bar1
            RawI4Bar1=V9
            I4Bar1=RawI4Bar1+I4Bar1
            RawI5Bar1=V12+PAx*V3+V15*WPx
            I5Bar1=RawI5Bar1+I5Bar1
            RawI6Bar1=V21
            I6Bar1=RawI6Bar1+I6Bar1
            RawI7Bar1=V12+PAy*V6+V19*WPy
            I7Bar1=RawI7Bar1+I7Bar1
            RawI8Bar1=V27
            I8Bar1=RawI8Bar1+I8Bar1
            RawI9Bar1=V30
            I9Bar1=RawI9Bar1+I9Bar1
            RawI10Bar1=V12+PAz*V9+V25*WPz
            I10Bar1=RawI10Bar1+I10Bar1
            RawI1Bar2=V33
            I1Bar2=RawI1Bar2+I1Bar2
            RawI2Bar2=V37
            I2Bar2=RawI2Bar2+I2Bar2
            RawI3Bar2=V40
            I3Bar2=RawI3Bar2+I3Bar2
            RawI4Bar2=V43
            I4Bar2=RawI4Bar2+I4Bar2
            RawI5Bar2=PAx*V37+V44+V57+V51*WPx
            I5Bar2=RawI5Bar2+I5Bar2
            RawI6Bar2=QCx*V21+V58+V64*WQx
            I6Bar2=RawI6Bar2+I6Bar2
            RawI7Bar2=PAy*V40+V57+V67*WPy
            I7Bar2=RawI7Bar2+I7Bar2
            RawI8Bar2=QCx*V27+V68+V74*WQx
            I8Bar2=RawI8Bar2+I8Bar2
            RawI9Bar2=QCx*V30+V77*WQx
            I9Bar2=RawI9Bar2+I9Bar2
            RawI10Bar2=PAz*V43+V57+V80*WPz
            I10Bar2=RawI10Bar2+I10Bar2
            RawI1Bar3=V83
            I1Bar3=RawI1Bar3+I1Bar3
            RawI2Bar3=V86
            I2Bar3=RawI2Bar3+I2Bar3
            RawI3Bar3=V89
            I3Bar3=RawI3Bar3+I3Bar3
            RawI4Bar3=V92
            I4Bar3=RawI4Bar3+I4Bar3
            RawI5Bar3=V101+PAx*V86+V95*WPx
            I5Bar3=RawI5Bar3+I5Bar3
            RawI6Bar3=QCy*V21+V44+V64*WQy
            I6Bar3=RawI6Bar3+I6Bar3
            RawI7Bar3=V101+V58+PAy*V89+V104*WPy
            I7Bar3=RawI7Bar3+I7Bar3
            RawI8Bar3=QCy*V27+V74*WQy
            I8Bar3=RawI8Bar3+I8Bar3
            RawI9Bar3=QCy*V30+V68+V77*WQy
            I9Bar3=RawI9Bar3+I9Bar3
            RawI10Bar3=V101+PAz*V92+V107*WPz
            I10Bar3=RawI10Bar3+I10Bar3
            RawI1Bar4=V110
            I1Bar4=RawI1Bar4+I1Bar4
            RawI2Bar4=V113
            I2Bar4=RawI2Bar4+I2Bar4
            RawI3Bar4=V116
            I3Bar4=RawI3Bar4+I3Bar4
            RawI4Bar4=V119
            I4Bar4=RawI4Bar4+I4Bar4
            RawI5Bar4=PAx*V113+V128+V122*WPx
            I5Bar4=RawI5Bar4+I5Bar4
            RawI6Bar4=QCz*V21+V64*WQz
            I6Bar4=RawI6Bar4+I6Bar4
            RawI7Bar4=PAy*V116+V128+V131*WPy
            I7Bar4=RawI7Bar4+I7Bar4
            RawI8Bar4=QCz*V27+V44+V74*WQz
            I8Bar4=RawI8Bar4+I8Bar4
            RawI9Bar4=QCz*V30+V58+V77*WQz
            I9Bar4=RawI9Bar4+I9Bar4
            RawI10Bar4=PAz*V119+V128+V68+V134*WPz
            I10Bar4=RawI10Bar4+I10Bar4
            RawI1Bar5=V137+QCx*V33+V54*WQx
            I1Bar5=RawI1Bar5+I1Bar5
            RawI2Bar5=V140+QCx*V37+HfxZpE*V54+V51*WQx
            I2Bar5=RawI2Bar5+I2Bar5
            RawI3Bar5=V143+QCx*V40+V67*WQx
            I3Bar5=RawI3Bar5+I3Bar5
            RawI4Bar5=V146+QCx*V43+V80*WQx
            I4Bar5=RawI4Bar5+I4Bar5
            RawI1Bar6=QCx*V83+V98*WQx
            I1Bar6=RawI1Bar6+I1Bar6
            RawI2Bar6=V147+QCx*V86+V95*WQx
            I2Bar6=RawI2Bar6+I2Bar6
            RawI3Bar6=QCx*V89+V104*WQx
            I3Bar6=RawI3Bar6+I3Bar6
            RawI4Bar6=QCx*V92+V107*WQx
            I4Bar6=RawI4Bar6+I4Bar6
            RawI1Bar7=V137+QCy*V83+V98*WQy
            I1Bar7=RawI1Bar7+I1Bar7
            RawI2Bar7=V140+QCy*V86+V95*WQy
            I2Bar7=RawI2Bar7+I2Bar7
            RawI3Bar7=V143+V147+QCy*V89+V104*WQy
            I3Bar7=RawI3Bar7+I3Bar7
            RawI4Bar7=V146+QCy*V92+V107*WQy
            I4Bar7=RawI4Bar7+I4Bar7
            RawI1Bar8=QCx*V110+V125*WQx
            I1Bar8=RawI1Bar8+I1Bar8
            RawI2Bar8=QCx*V113+V148+V122*WQx
            I2Bar8=RawI2Bar8+I2Bar8
            RawI3Bar8=QCx*V116+V131*WQx
            I3Bar8=RawI3Bar8+I3Bar8
            RawI4Bar8=QCx*V119+V134*WQx
            I4Bar8=RawI4Bar8+I4Bar8
            RawI1Bar9=QCy*V110+V125*WQy
            I1Bar9=RawI1Bar9+I1Bar9
            RawI2Bar9=QCy*V113+V122*WQy
            I2Bar9=RawI2Bar9+I2Bar9
            RawI3Bar9=QCy*V116+V148+V131*WQy
            I3Bar9=RawI3Bar9+I3Bar9
            RawI4Bar9=QCy*V119+V134*WQy
            I4Bar9=RawI4Bar9+I4Bar9
            RawI1Bar10=QCz*V110+V137+V125*WQz
            I1Bar10=RawI1Bar10+I1Bar10
            RawI2Bar10=QCz*V113+V140+V122*WQz
            I2Bar10=RawI2Bar10+I2Bar10
            RawI3Bar10=QCz*V116+V143+V131*WQz
            I3Bar10=RawI3Bar10+I3Bar10
            RawI4Bar10=QCz*V119+V146+V148+V134*WQz
            I4Bar10=RawI4Bar10+I4Bar10
            Ia10Bar4=Ia10Bar4+Alpha*RawI10Bar4
            Ia10Bar3=Ia10Bar3+Alpha*RawI10Bar3
            Ia10Bar2=Ia10Bar2+Alpha*RawI10Bar2
            Ia9Bar4=Ia9Bar4+Alpha*RawI9Bar4
            Ia9Bar3=Ia9Bar3+Alpha*RawI9Bar3
            Ia9Bar2=Ia9Bar2+Alpha*RawI9Bar2
            Ia7Bar4=Ia7Bar4+Alpha*RawI7Bar4
            Ia7Bar3=Ia7Bar3+Alpha*RawI7Bar3
            Ia7Bar2=Ia7Bar2+Alpha*RawI7Bar2
            Ia8Bar4=Ia8Bar4+Alpha*RawI8Bar4
            Ia8Bar3=Ia8Bar3+Alpha*RawI8Bar3
            Ia8Bar2=Ia8Bar2+Alpha*RawI8Bar2
            Ia6Bar4=Ia6Bar4+Alpha*RawI6Bar4
            Ia6Bar3=Ia6Bar3+Alpha*RawI6Bar3
            Ia6Bar2=Ia6Bar2+Alpha*RawI6Bar2
            Ia5Bar4=Ia5Bar4+Alpha*RawI5Bar4
            Ia5Bar3=Ia5Bar3+Alpha*RawI5Bar3
            Ia5Bar2=Ia5Bar2+Alpha*RawI5Bar2
            Ib4Bar4=Ib4Bar4+Beta*RawI4Bar4
            Ib4Bar3=Ib4Bar3+Beta*RawI4Bar3
            Ib4Bar2=Ib4Bar2+Beta*RawI4Bar2
            Ib10Bar4=Ib10Bar4+Beta*RawI10Bar4
            Ib10Bar3=Ib10Bar3+Beta*RawI10Bar3
            Ib10Bar2=Ib10Bar2+Beta*RawI10Bar2
            Ib3Bar4=Ib3Bar4+Beta*RawI3Bar4
            Ib3Bar3=Ib3Bar3+Beta*RawI3Bar3
            Ib3Bar2=Ib3Bar2+Beta*RawI3Bar2
            Ib9Bar4=Ib9Bar4+Beta*RawI9Bar4
            Ib9Bar3=Ib9Bar3+Beta*RawI9Bar3
            Ib9Bar2=Ib9Bar2+Beta*RawI9Bar2
            Ib7Bar4=Ib7Bar4+Beta*RawI7Bar4
            Ib7Bar3=Ib7Bar3+Beta*RawI7Bar3
            Ib7Bar2=Ib7Bar2+Beta*RawI7Bar2
            Ib2Bar4=Ib2Bar4+Beta*RawI2Bar4
            Ib2Bar3=Ib2Bar3+Beta*RawI2Bar3
            Ib2Bar2=Ib2Bar2+Beta*RawI2Bar2
            Ib8Bar4=Ib8Bar4+Beta*RawI8Bar4
            Ib8Bar3=Ib8Bar3+Beta*RawI8Bar3
            Ib8Bar2=Ib8Bar2+Beta*RawI8Bar2
            Ib6Bar4=Ib6Bar4+Beta*RawI6Bar4
            Ib6Bar3=Ib6Bar3+Beta*RawI6Bar3
            Ib6Bar2=Ib6Bar2+Beta*RawI6Bar2
            Ib5Bar4=Ib5Bar4+Beta*RawI5Bar4
            Ib5Bar3=Ib5Bar3+Beta*RawI5Bar3
            Ib5Bar2=Ib5Bar2+Beta*RawI5Bar2
            Ic4Bar10=Ic4Bar10+Gamma*RawI4Bar10
            Ic4Bar9=Ic4Bar9+Gamma*RawI4Bar9
            Ic4Bar7=Ic4Bar7+Gamma*RawI4Bar7
            Ic4Bar8=Ic4Bar8+Gamma*RawI4Bar8
            Ic4Bar6=Ic4Bar6+Gamma*RawI4Bar6
            Ic4Bar5=Ic4Bar5+Gamma*RawI4Bar5
            Ic3Bar10=Ic3Bar10+Gamma*RawI3Bar10
            Ic3Bar9=Ic3Bar9+Gamma*RawI3Bar9
            Ic3Bar7=Ic3Bar7+Gamma*RawI3Bar7
            Ic3Bar8=Ic3Bar8+Gamma*RawI3Bar8
            Ic3Bar6=Ic3Bar6+Gamma*RawI3Bar6
            Ic3Bar5=Ic3Bar5+Gamma*RawI3Bar5
            Ic2Bar10=Ic2Bar10+Gamma*RawI2Bar10
            Ic2Bar9=Ic2Bar9+Gamma*RawI2Bar9
            Ic2Bar7=Ic2Bar7+Gamma*RawI2Bar7
            Ic2Bar8=Ic2Bar8+Gamma*RawI2Bar8
            Ic2Bar6=Ic2Bar6+Gamma*RawI2Bar6
            Ic2Bar5=Ic2Bar5+Gamma*RawI2Bar5
         ENDDO ! (M0| loop
      ENDDO ! |N0) loop
      ! HRR 
      V1=-I1Bar2
      V2=-I2Bar1
      V3=-I3Bar1
      V4=-I4Bar1
      V5=-I1Bar3
      V6=-I1Bar4
      OffSet=(OA+0)*LDA+(OB+0)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia5Bar2+V1+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=ABx*Ib2Bar2+Ib5Bar2+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic2Bar5+V2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia6Bar2+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=ABy*Ib2Bar2+Ib6Bar2+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic2Bar6+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia8Bar2+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=ABz*Ib2Bar2+Ib8Bar2+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic2Bar8+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+1)*LDA+(OB+0)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia6Bar2+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=ABx*Ib3Bar2+Ib6Bar2+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic3Bar5+V3+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia7Bar2+V1+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=ABy*Ib3Bar2+Ib7Bar2+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic3Bar6+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia9Bar2+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=ABz*Ib3Bar2+Ib9Bar2+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic3Bar8+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+2)*LDA+(OB+0)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia8Bar2+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=ABx*Ib4Bar2+Ib8Bar2+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic4Bar5+V4+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia9Bar2+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=ABy*Ib4Bar2+Ib9Bar2+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic4Bar6+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia10Bar2+V1+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib10Bar2+ABz*Ib4Bar2+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic4Bar8+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+0)*LDA+(OB+0)*LDB+(OC+1)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia5Bar3+V5+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=ABx*Ib2Bar3+Ib5Bar3+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic2Bar6+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia6Bar3+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=ABy*Ib2Bar3+Ib6Bar3+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic2Bar7+V2+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia8Bar3+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=ABz*Ib2Bar3+Ib8Bar3+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic2Bar9+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+1)*LDA+(OB+0)*LDB+(OC+1)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia6Bar3+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=ABx*Ib3Bar3+Ib6Bar3+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic3Bar6+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia7Bar3+V5+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=ABy*Ib3Bar3+Ib7Bar3+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic3Bar7+V3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia9Bar3+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=ABz*Ib3Bar3+Ib9Bar3+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic3Bar9+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+2)*LDA+(OB+0)*LDB+(OC+1)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia8Bar3+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=ABx*Ib4Bar3+Ib8Bar3+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic4Bar6+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia9Bar3+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=ABy*Ib4Bar3+Ib9Bar3+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic4Bar7+V4+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia10Bar3+V5+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib10Bar3+ABz*Ib4Bar3+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic4Bar9+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+0)*LDA+(OB+0)*LDB+(OC+2)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia5Bar4+V6+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=ABx*Ib2Bar4+Ib5Bar4+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic2Bar8+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia6Bar4+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=ABy*Ib2Bar4+Ib6Bar4+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic2Bar9+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia8Bar4+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=ABz*Ib2Bar4+Ib8Bar4+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic2Bar10+V2+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+1)*LDA+(OB+0)*LDB+(OC+2)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia6Bar4+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=ABx*Ib3Bar4+Ib6Bar4+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic3Bar8+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia7Bar4+V6+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=ABy*Ib3Bar4+Ib7Bar4+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic3Bar9+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia9Bar4+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=ABz*Ib3Bar4+Ib9Bar4+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic3Bar10+V3+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+2)*LDA+(OB+0)*LDB+(OC+2)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia8Bar4+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=ABx*Ib4Bar4+Ib8Bar4+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic4Bar8+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia9Bar4+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=ABy*Ib4Bar4+Ib9Bar4+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic4Bar9+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia10Bar4+V6+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib10Bar4+ABz*Ib4Bar4+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic4Bar10+V4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
   END SUBROUTINE dInt3131
