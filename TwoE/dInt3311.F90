! ---------------------------------------------------------- 
! COMPUTES THE INTEGRAL CLASS (P P|S S) 
! ---------------------------------------------------------- 
   SUBROUTINE dInt3311(PrmBufB,LBra,PrmBufK,LKet,ACInfo,BDInfo, & 
                              OA,LDA,OB,LDB,OC,LDC,OD,LDD,GOA,GOB,GOC,GOD,NINT,PBC,dI) 
      USE DerivedTypes
      USE GlobalScalars
      USE ShellPairStruct
      USE GammaF2
      USE GammaF3
      IMPLICIT REAL(DOUBLE) (A,I,V,W)
      INTEGER        :: LBra,LKet,NINT
      REAL(DOUBLE)   :: PrmBufB(7,LBra),PrmBufK(7,LKet)
      TYPE(SmallAtomInfo) :: ACInfo,BDInfo
      TYPE(PBCInfo) :: PBC
      REAL(DOUBLE) :: dI(NINT,12)
      REAL(DOUBLE)  :: Zeta,Eta,r1xZpE,HfxZpE,r1x2E,r1x2Z,ExZpE,ZxZpE,Omega,Up,Uq,Upq
      REAL(DOUBLE)  :: Ax,Ay,Az,Bx,By,Bz,Cx,Cy,Cz,Dx,Dy,Dz,Qx,Qy,Qz,Px,Py,Pz
      REAL(DOUBLE)  :: QCx,QCy,QCz,PAx,PAy,PAz,PQx,PQy,PQz,WPx,WPy,WPz,WQx,WQy,WQz   
      REAL(DOUBLE)  :: T,ET,TwoT,InvT,SqInvT,ABx,ABy,ABz,CDx,CDy,CDz
      REAL(DOUBLE)  :: Alpha,Beta,Gamma
      INTEGER       :: OffSet,CrtSet
      INTEGER       :: OA,LDA,OB,LDB,OC,LDC,OD,LDD,J,K,L
      INTEGER       :: GOA,GOB,GOC,GOD
      REAL(DOUBLE)  :: FPQx,FPQy,FPQz
      CrtSet1=GOA
      CrtSet2=GOA+1
      CrtSet3=GOA+2
      CrtSet4=GOB+3
      CrtSet5=GOB+4
      CrtSet6=GOB+5
      CrtSet7=GOC+6
      CrtSet8=GOC+7
      CrtSet9=GOC+8
      CrtSet10=GOD+9
      CrtSet11=GOD+10
      CrtSet12=GOD+11
      I1Bar1=0.0d0
      I2Bar1=0.0d0
      I3Bar1=0.0d0
      I4Bar1=0.0d0
      I5Bar1=0.0d0
      I6Bar1=0.0d0
      I7Bar1=0.0d0
      I8Bar1=0.0d0
      I9Bar1=0.0d0
      I10Bar1=0.0d0
      I11Bar1=0.0d0
      I12Bar1=0.0d0
      I13Bar1=0.0d0
      I14Bar1=0.0d0
      I15Bar1=0.0d0
      I16Bar1=0.0d0
      I17Bar1=0.0d0
      I18Bar1=0.0d0
      I19Bar1=0.0d0
      I20Bar1=0.0d0
      I1Bar2=0.0d0
      I2Bar2=0.0d0
      I3Bar2=0.0d0
      I4Bar2=0.0d0
      I5Bar2=0.0d0
      I6Bar2=0.0d0
      I7Bar2=0.0d0
      I8Bar2=0.0d0
      I9Bar2=0.0d0
      I10Bar2=0.0d0
      I1Bar3=0.0d0
      I2Bar3=0.0d0
      I3Bar3=0.0d0
      I4Bar3=0.0d0
      I5Bar3=0.0d0
      I6Bar3=0.0d0
      I7Bar3=0.0d0
      I8Bar3=0.0d0
      I9Bar3=0.0d0
      I10Bar3=0.0d0
      I1Bar4=0.0d0
      I2Bar4=0.0d0
      I3Bar4=0.0d0
      I4Bar4=0.0d0
      I5Bar4=0.0d0
      I6Bar4=0.0d0
      I7Bar4=0.0d0
      I8Bar4=0.0d0
      I9Bar4=0.0d0
      I10Bar4=0.0d0
      Ia10Bar1=0D0
      Ia20Bar1=0D0
      Ia9Bar1=0D0
      Ia19Bar1=0D0
      Ia7Bar1=0D0
      Ia17Bar1=0D0
      Ia14Bar1=0D0
      Ia8Bar1=0D0
      Ia18Bar1=0D0
      Ia6Bar1=0D0
      Ia16Bar1=0D0
      Ia13Bar1=0D0
      Ia5Bar1=0D0
      Ia15Bar1=0D0
      Ia12Bar1=0D0
      Ia11Bar1=0D0
      Ib4Bar1=0D0
      Ib10Bar1=0D0
      Ib20Bar1=0D0
      Ib3Bar1=0D0
      Ib9Bar1=0D0
      Ib19Bar1=0D0
      Ib7Bar1=0D0
      Ib17Bar1=0D0
      Ib14Bar1=0D0
      Ib2Bar1=0D0
      Ib8Bar1=0D0
      Ib18Bar1=0D0
      Ib6Bar1=0D0
      Ib16Bar1=0D0
      Ib13Bar1=0D0
      Ib5Bar1=0D0
      Ib15Bar1=0D0
      Ib12Bar1=0D0
      Ib11Bar1=0D0
      Ic4Bar4=0D0
      Ic4Bar3=0D0
      Ic4Bar2=0D0
      Ic10Bar4=0D0
      Ic10Bar3=0D0
      Ic10Bar2=0D0
      Ic3Bar4=0D0
      Ic3Bar3=0D0
      Ic3Bar2=0D0
      Ic9Bar4=0D0
      Ic9Bar3=0D0
      Ic9Bar2=0D0
      Ic7Bar4=0D0
      Ic7Bar3=0D0
      Ic7Bar2=0D0
      Ic2Bar4=0D0
      Ic2Bar3=0D0
      Ic2Bar2=0D0
      Ic8Bar4=0D0
      Ic8Bar3=0D0
      Ic8Bar2=0D0
      Ic6Bar4=0D0
      Ic6Bar3=0D0
      Ic6Bar2=0D0
      Ic5Bar4=0D0
      Ic5Bar3=0D0
      Ic5Bar2=0D0
      Ax=ACInfo%Atm1X
      Ay=ACInfo%Atm1Y
      Az=ACInfo%Atm1Z
      Bx=ACInfo%Atm2X
      By=ACInfo%Atm2Y
      Bz=ACInfo%Atm2Z
      Cx=BDInfo%Atm1X
      Cy=BDInfo%Atm1Y
      Cz=BDInfo%Atm1Z
      Dx=BDInfo%Atm2X
      Dy=BDInfo%Atm2Y
      Dz=BDInfo%Atm2Z
      ABx=Ax-Bx
      ABy=Ay-By
      ABz=Az-Bz
      CDx=Cx-Dx
      CDy=Cy-Dy
      CDz=Cz-Dz
      DO J=1,LKet ! K^2 VRR |N0) loop 
         Eta=PrmBufK(1,J)
         Qx =PrmBufK(2,J)
         Qy =PrmBufK(3,J)
         Qz =PrmBufK(4,J)
         Uq =PrmBufK(5,J)
         Gamma =PrmBufK(6,J)
         QCx=Qx-Cx
         QCy=Qy-Cy
         QCz=Qz-Cz
         DO K=1,LBra ! K^2 VRR (M0| loop 
            Zeta=PrmBufB(1,K)
            Px  =PrmBufB(2,K)
            Py  =PrmBufB(3,K)
            Pz  =PrmBufB(4,K)
            Up  =PrmBufB(5,K)
            Alpha =PrmBufB(6,K)
            Beta  =PrmBufB(7,K)
            r1xZpE=One/(Zeta+Eta)
            Upq=SQRT(r1xZpE)*Up*Uq
            HfxZpE=Half/(Zeta+Eta)
            r1x2E=Half/Eta
            r1x2Z=Half/Zeta
            ExZpE=Eta*r1xZpE
            ZxZpE=Zeta*r1xZpE
            Omega=Eta*Zeta*r1xZpE
            PAx=Px-Ax
            PAy=Py-Ay
            PAz=Pz-Az
            PQx=Px-Qx
            PQy=Py-Qy
            PQz=Pz-Qz
      ! Need to be improved...
            FPQx = PQx*PBC%InvBoxSh%D(1,1)+PQy*PBC%InvBoxSh%D(1,2)+PQz*PBC%InvBoxSh%D(1,3)
            FPQy = PQy*PBC%InvBoxSh%D(2,2)+PQz*PBC%InvBoxSh%D(2,3)
            FPQz = PQz*PBC%InvBoxSh%D(3,3)
            IF(PBC%AutoW%I(1)==1) FPQx = FPQx-ANINT(ANINT(FPQx*1d9)*1d-9)
            IF(PBC%AutoW%I(2)==1) FPQy = FPQy-ANINT(ANINT(FPQy*1d9)*1d-9)
            IF(PBC%AutoW%I(3)==1) FPQz = FPQz-ANINT(ANINT(FPQz*1d9)*1d-9)
            PQx  = FPQx*PBC%BoxShape%D(1,1)+FPQy*PBC%BoxShape%D(1,2)+FPQz*PBC%BoxShape%D(1,3)
            PQy  = FPQy*PBC%BoxShape%D(2,2)+FPQz*PBC%BoxShape%D(2,3)
            PQz  = FPQz*PBC%BoxShape%D(3,3)
      !
            WPx = -Eta*PQx*r1xZpE
            WPy = -Eta*PQy*r1xZpE
            WPz = -Eta*PQz*r1xZpE
            WQx = Zeta*PQx*r1xZpE
            WQy = Zeta*PQy*r1xZpE
            WQz = Zeta*PQz*r1xZpE
            T=Omega*(PQx*PQx+PQy*PQy+PQz*PQz)
            IF(T<Gamma_Switch)THEN
              L=AINT(T*Gamma_Grid)
              ET=EXP(-T)
              TwoT=Two*T
              W3=(F3_0(L)+T*(F3_1(L)+T*(F3_2(L)+T*(F3_3(L)+T*F3_4(L)))))
              W2=+2.000000000000000D-01*(TwoT*W3+ET)
              W1=+3.333333333333333D-01*(TwoT*W2+ET)
              W0=TwoT*W1+ET
              AuxR0=Upq*W0
              AuxR1=Upq*W1
              AuxR2=Upq*W2
              AuxR3=Upq*W3
            ELSE
              InvT=One/T
              SqInvT=DSQRT(InvT)
              AuxR0=+8.862269254527580D-01*Upq*SqInvT
              SqInvT=SqInvT*InvT
              AuxR1=+4.431134627263790D-01*Upq*SqInvT
              SqInvT=SqInvT*InvT
              AuxR2=+6.646701940895685D-01*Upq*SqInvT
              SqInvT=SqInvT*InvT
              AuxR3=+1.661675485223921D+00*Upq*SqInvT
            ENDIF
            V1=AuxR0*PAx
            V2=AuxR1*WPx
            V3=V1+V2
            V4=AuxR0*PAy
            V5=AuxR1*WPy
            V6=V4+V5
            V7=AuxR0*PAz
            V8=AuxR1*WPz
            V9=V7+V8
            V10=-(AuxR1*ExZpE)
            V11=AuxR0+V10
            V12=r1x2Z*V11
            V13=PAx*V3
            V14=AuxR1*PAx
            V15=AuxR2*WPx
            V16=V14+V15
            V17=V16*WPx
            V18=V12+V13+V17
            V19=PAx*V6
            V20=AuxR1*PAy
            V21=AuxR2*WPy
            V22=V20+V21
            V23=V22*WPx
            V24=V19+V23
            V25=PAy*V6
            V26=V22*WPy
            V27=V12+V25+V26
            V28=PAx*V9
            V29=AuxR1*PAz
            V30=AuxR2*WPz
            V31=V29+V30
            V32=V31*WPx
            V33=V28+V32
            V34=PAy*V9
            V35=V31*WPy
            V36=V34+V35
            V37=PAz*V9
            V38=V31*WPz
            V39=V12+V37+V38
            V40=-(ExZpE*V16)
            V41=V1+V2+V40
            V42=-(AuxR2*ExZpE)
            V43=AuxR1+V42
            V44=r1x2Z*V43
            V45=AuxR2*PAx
            V46=AuxR3*WPx
            V47=V45+V46
            V48=-(ExZpE*V22)
            V49=V4+V48+V5
            V50=r1x2Z*V49
            V51=PAx*V22
            V52=AuxR2*PAy
            V53=AuxR3*WPy
            V54=V52+V53
            V55=V54*WPx
            V56=V51+V55
            V57=r1x2Z*V41
            V58=-(ExZpE*V31)
            V59=V58+V7+V8
            V60=r1x2Z*V59
            V61=PAx*V31
            V62=AuxR2*PAz
            V63=AuxR3*WPz
            V64=V62+V63
            V65=V64*WPx
            V66=V61+V65
            V67=PAy*V31
            V68=V64*WPy
            V69=V67+V68
            V70=AuxR0*QCx
            V71=AuxR1*WQx
            V72=AuxR1*HfxZpE
            V73=QCx*V3
            V74=V16*WQx
            V75=V72+V73+V74
            V76=QCx*V6
            V77=V22*WQx
            V78=V76+V77
            V79=QCx*V9
            V80=V31*WQx
            V81=V79+V80
            V82=HfxZpE*V16
            V83=AuxR2*HfxZpE
            V84=AuxR1*QCx
            V85=AuxR2*WQx
            V86=V84+V85
            V87=-(ExZpE*V86)
            V88=V70+V71+V87
            V89=r1x2Z*V88
            V90=HfxZpE*V22
            V91=HfxZpE*V31
            V92=AuxR0*QCy
            V93=AuxR1*WQy
            V94=QCy*V3
            V95=V16*WQy
            V96=V94+V95
            V97=QCy*V6
            V98=V22*WQy
            V99=V72+V97+V98
            V100=QCy*V9
            V101=V31*WQy
            V102=V100+V101
            V103=AuxR1*QCy
            V104=AuxR2*WQy
            V105=V103+V104
            V106=-(ExZpE*V105)
            V107=V106+V92+V93
            V108=r1x2Z*V107
            V109=AuxR0*QCz
            V110=AuxR1*WQz
            V111=QCz*V3
            V112=V16*WQz
            V113=V111+V112
            V114=QCz*V6
            V115=V22*WQz
            V116=V114+V115
            V117=QCz*V9
            V118=V31*WQz
            V119=V117+V118+V72
            V120=AuxR1*QCz
            V121=AuxR2*WQz
            V122=V120+V121
            V123=-(ExZpE*V122)
            V124=V109+V110+V123
            V125=r1x2Z*V124
            RawI1Bar1=AuxR0
            I1Bar1=RawI1Bar1+I1Bar1
            RawI2Bar1=V3
            I2Bar1=RawI2Bar1+I2Bar1
            RawI3Bar1=V6
            I3Bar1=RawI3Bar1+I3Bar1
            RawI4Bar1=V9
            I4Bar1=RawI4Bar1+I4Bar1
            RawI5Bar1=V18
            I5Bar1=RawI5Bar1+I5Bar1
            RawI6Bar1=V24
            I6Bar1=RawI6Bar1+I6Bar1
            RawI7Bar1=V27
            I7Bar1=RawI7Bar1+I7Bar1
            RawI8Bar1=V33
            I8Bar1=RawI8Bar1+I8Bar1
            RawI9Bar1=V36
            I9Bar1=RawI9Bar1+I9Bar1
            RawI10Bar1=V39
            I10Bar1=RawI10Bar1+I10Bar1
            W1=PAx*V18
            W2=2.D0*r1x2Z*V41
            W3=WPx*(PAx*V16+V44+V47*WPx)
            RawI11Bar1=W1+W2+W3
            I11Bar1=RawI11Bar1+I11Bar1
            RawI12Bar1=PAx*V24+V50+V56*WPx
            I12Bar1=RawI12Bar1+I12Bar1
            RawI13Bar1=PAy*V24+V57+V56*WPy
            I13Bar1=RawI13Bar1+I13Bar1
            W1=PAy*V27
            W2=2.D0*r1x2Z*V49
            W3=WPy*(PAy*V22+V44+V54*WPy)
            RawI14Bar1=W1+W2+W3
            I14Bar1=RawI14Bar1+I14Bar1
            RawI15Bar1=PAx*V33+V60+V66*WPx
            I15Bar1=RawI15Bar1+I15Bar1
            RawI16Bar1=PAx*V36+V69*WPx
            I16Bar1=RawI16Bar1+I16Bar1
            RawI17Bar1=PAy*V36+V60+V69*WPy
            I17Bar1=RawI17Bar1+I17Bar1
            RawI18Bar1=PAz*V33+V57+V66*WPz
            I18Bar1=RawI18Bar1+I18Bar1
            RawI19Bar1=PAz*V36+V50+V69*WPz
            I19Bar1=RawI19Bar1+I19Bar1
            W1=PAz*V39
            W2=2.D0*r1x2Z*V59
            W3=WPz*(PAz*V31+V44+V64*WPz)
            RawI20Bar1=W1+W2+W3
            I20Bar1=RawI20Bar1+I20Bar1
            RawI1Bar2=V70+V71
            I1Bar2=RawI1Bar2+I1Bar2
            RawI2Bar2=V75
            I2Bar2=RawI2Bar2+I2Bar2
            RawI3Bar2=V78
            I3Bar2=RawI3Bar2+I3Bar2
            RawI4Bar2=V81
            I4Bar2=RawI4Bar2+I4Bar2
            RawI5Bar2=PAx*V75+V82+V89+WPx*(QCx*V16+V83+V47*WQx)
            I5Bar2=RawI5Bar2+I5Bar2
            RawI6Bar2=QCx*V24+V90+V56*WQx
            I6Bar2=RawI6Bar2+I6Bar2
            RawI7Bar2=PAy*V78+V89+WPy*(QCx*V22+V54*WQx)
            I7Bar2=RawI7Bar2+I7Bar2
            RawI8Bar2=QCx*V33+V91+V66*WQx
            I8Bar2=RawI8Bar2+I8Bar2
            RawI9Bar2=QCx*V36+V69*WQx
            I9Bar2=RawI9Bar2+I9Bar2
            RawI10Bar2=PAz*V81+V89+WPz*(QCx*V31+V64*WQx)
            I10Bar2=RawI10Bar2+I10Bar2
            RawI1Bar3=V92+V93
            I1Bar3=RawI1Bar3+I1Bar3
            RawI2Bar3=V96
            I2Bar3=RawI2Bar3+I2Bar3
            RawI3Bar3=V99
            I3Bar3=RawI3Bar3+I3Bar3
            RawI4Bar3=V102
            I4Bar3=RawI4Bar3+I4Bar3
            RawI5Bar3=V108+PAx*V96+WPx*(QCy*V16+V47*WQy)
            I5Bar3=RawI5Bar3+I5Bar3
            RawI6Bar3=QCy*V24+V82+V56*WQy
            I6Bar3=RawI6Bar3+I6Bar3
            RawI7Bar3=V108+V90+PAy*V99+WPy*(QCy*V22+V83+V54*WQy)
            I7Bar3=RawI7Bar3+I7Bar3
            RawI8Bar3=QCy*V33+V66*WQy
            I8Bar3=RawI8Bar3+I8Bar3
            RawI9Bar3=QCy*V36+V91+V69*WQy
            I9Bar3=RawI9Bar3+I9Bar3
            RawI10Bar3=PAz*V102+V108+WPz*(QCy*V31+V64*WQy)
            I10Bar3=RawI10Bar3+I10Bar3
            RawI1Bar4=V109+V110
            I1Bar4=RawI1Bar4+I1Bar4
            RawI2Bar4=V113
            I2Bar4=RawI2Bar4+I2Bar4
            RawI3Bar4=V116
            I3Bar4=RawI3Bar4+I3Bar4
            RawI4Bar4=V119
            I4Bar4=RawI4Bar4+I4Bar4
            RawI5Bar4=PAx*V113+V125+WPx*(QCz*V16+V47*WQz)
            I5Bar4=RawI5Bar4+I5Bar4
            RawI6Bar4=QCz*V24+V56*WQz
            I6Bar4=RawI6Bar4+I6Bar4
            RawI7Bar4=PAy*V116+V125+WPy*(QCz*V22+V54*WQz)
            I7Bar4=RawI7Bar4+I7Bar4
            RawI8Bar4=QCz*V33+V82+V66*WQz
            I8Bar4=RawI8Bar4+I8Bar4
            RawI9Bar4=QCz*V36+V90+V69*WQz
            I9Bar4=RawI9Bar4+I9Bar4
            RawI10Bar4=PAz*V119+V125+V91+WPz*(QCz*V31+V83+V64*WQz)
            I10Bar4=RawI10Bar4+I10Bar4
            Ia10Bar1=Ia10Bar1+Alpha*RawI10Bar1
            Ia20Bar1=Ia20Bar1+Alpha*RawI20Bar1
            Ia9Bar1=Ia9Bar1+Alpha*RawI9Bar1
            Ia19Bar1=Ia19Bar1+Alpha*RawI19Bar1
            Ia7Bar1=Ia7Bar1+Alpha*RawI7Bar1
            Ia17Bar1=Ia17Bar1+Alpha*RawI17Bar1
            Ia14Bar1=Ia14Bar1+Alpha*RawI14Bar1
            Ia8Bar1=Ia8Bar1+Alpha*RawI8Bar1
            Ia18Bar1=Ia18Bar1+Alpha*RawI18Bar1
            Ia6Bar1=Ia6Bar1+Alpha*RawI6Bar1
            Ia16Bar1=Ia16Bar1+Alpha*RawI16Bar1
            Ia13Bar1=Ia13Bar1+Alpha*RawI13Bar1
            Ia5Bar1=Ia5Bar1+Alpha*RawI5Bar1
            Ia15Bar1=Ia15Bar1+Alpha*RawI15Bar1
            Ia12Bar1=Ia12Bar1+Alpha*RawI12Bar1
            Ia11Bar1=Ia11Bar1+Alpha*RawI11Bar1
            Ib4Bar1=Ib4Bar1+Beta*RawI4Bar1
            Ib10Bar1=Ib10Bar1+Beta*RawI10Bar1
            Ib20Bar1=Ib20Bar1+Beta*RawI20Bar1
            Ib3Bar1=Ib3Bar1+Beta*RawI3Bar1
            Ib9Bar1=Ib9Bar1+Beta*RawI9Bar1
            Ib19Bar1=Ib19Bar1+Beta*RawI19Bar1
            Ib7Bar1=Ib7Bar1+Beta*RawI7Bar1
            Ib17Bar1=Ib17Bar1+Beta*RawI17Bar1
            Ib14Bar1=Ib14Bar1+Beta*RawI14Bar1
            Ib2Bar1=Ib2Bar1+Beta*RawI2Bar1
            Ib8Bar1=Ib8Bar1+Beta*RawI8Bar1
            Ib18Bar1=Ib18Bar1+Beta*RawI18Bar1
            Ib6Bar1=Ib6Bar1+Beta*RawI6Bar1
            Ib16Bar1=Ib16Bar1+Beta*RawI16Bar1
            Ib13Bar1=Ib13Bar1+Beta*RawI13Bar1
            Ib5Bar1=Ib5Bar1+Beta*RawI5Bar1
            Ib15Bar1=Ib15Bar1+Beta*RawI15Bar1
            Ib12Bar1=Ib12Bar1+Beta*RawI12Bar1
            Ib11Bar1=Ib11Bar1+Beta*RawI11Bar1
            Ic4Bar4=Ic4Bar4+Gamma*RawI4Bar4
            Ic4Bar3=Ic4Bar3+Gamma*RawI4Bar3
            Ic4Bar2=Ic4Bar2+Gamma*RawI4Bar2
            Ic10Bar4=Ic10Bar4+Gamma*RawI10Bar4
            Ic10Bar3=Ic10Bar3+Gamma*RawI10Bar3
            Ic10Bar2=Ic10Bar2+Gamma*RawI10Bar2
            Ic3Bar4=Ic3Bar4+Gamma*RawI3Bar4
            Ic3Bar3=Ic3Bar3+Gamma*RawI3Bar3
            Ic3Bar2=Ic3Bar2+Gamma*RawI3Bar2
            Ic9Bar4=Ic9Bar4+Gamma*RawI9Bar4
            Ic9Bar3=Ic9Bar3+Gamma*RawI9Bar3
            Ic9Bar2=Ic9Bar2+Gamma*RawI9Bar2
            Ic7Bar4=Ic7Bar4+Gamma*RawI7Bar4
            Ic7Bar3=Ic7Bar3+Gamma*RawI7Bar3
            Ic7Bar2=Ic7Bar2+Gamma*RawI7Bar2
            Ic2Bar4=Ic2Bar4+Gamma*RawI2Bar4
            Ic2Bar3=Ic2Bar3+Gamma*RawI2Bar3
            Ic2Bar2=Ic2Bar2+Gamma*RawI2Bar2
            Ic8Bar4=Ic8Bar4+Gamma*RawI8Bar4
            Ic8Bar3=Ic8Bar3+Gamma*RawI8Bar3
            Ic8Bar2=Ic8Bar2+Gamma*RawI8Bar2
            Ic6Bar4=Ic6Bar4+Gamma*RawI6Bar4
            Ic6Bar3=Ic6Bar3+Gamma*RawI6Bar3
            Ic6Bar2=Ic6Bar2+Gamma*RawI6Bar2
            Ic5Bar4=Ic5Bar4+Gamma*RawI5Bar4
            Ic5Bar3=Ic5Bar3+Gamma*RawI5Bar3
            Ic5Bar2=Ic5Bar2+Gamma*RawI5Bar2
         ENDDO ! (M0| loop
      ENDDO ! |N0) loop
      ! HRR 
      V1=-(ABx*I1Bar1)
      V2=-I2Bar1
      V3=ABx*Ia6Bar1
      V4=ABy*Ib5Bar1
      V5=ABy*Ib2Bar1
      V6=Ib6Bar1+V5
      V7=ABy*V6
      V8=ABx*Ia8Bar1
      V9=ABz*Ib5Bar1
      V10=ABz*Ib2Bar1
      V11=Ib8Bar1+V10
      V12=ABz*V11
      V13=-I3Bar1
      V14=ABy*Ib6Bar1
      V15=ABy*Ib3Bar1
      V16=Ib7Bar1+V15
      V17=ABy*V16
      V18=ABx*Ia9Bar1
      V19=ABz*Ib6Bar1
      V20=ABz*Ib3Bar1
      V21=Ib9Bar1+V20
      V22=ABz*V21
      V23=-I4Bar1
      V24=ABy*Ib8Bar1
      V25=ABy*Ib4Bar1
      V26=Ib9Bar1+V25
      V27=ABy*V26
      V28=ABz*Ib4Bar1
      V29=Ib10Bar1+V28
      V30=ABz*V29
      V31=ABz*Ib8Bar1
      V32=-(ABy*I1Bar1)
      V33=ABy*Ia6Bar1
      V34=ABy*Ia8Bar1
      V35=ABy*Ia9Bar1
      V36=ABz*Ib7Bar1
      V37=ABz*Ib9Bar1
      V38=-(ABz*I1Bar1)
      V39=ABz*Ia6Bar1
      V40=ABz*Ia8Bar1
      V41=ABz*Ia9Bar1
      OffSet=(OA+0)*LDA+(OB+0)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia11Bar1+ABx*Ia5Bar1+V1+V2+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=Ib11Bar1+ABx*Ib5Bar1+ABx*(ABx*Ib2Bar1+Ib5Bar1)+V2+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=ABx*Ic2Bar2+Ic5Bar2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia12Bar1+V3+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=Ib12Bar1+V4+V7+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=ABx*Ic2Bar3+Ic5Bar3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia15Bar1+V8+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib15Bar1+V12+V9+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=ABx*Ic2Bar4+Ic5Bar4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+1)*LDA+(OB+0)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia12Bar1+V3+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=Ib12Bar1+ABx*Ib6Bar1+ABx*(ABx*Ib3Bar1+Ib6Bar1)+V13+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=ABx*Ic3Bar2+Ic6Bar2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia13Bar1+ABx*Ia7Bar1+V1+V2+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=Ib13Bar1+V14+V17+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=ABx*Ic3Bar3+Ic6Bar3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia16Bar1+V18+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib16Bar1+V19+V22+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=ABx*Ic3Bar4+Ic6Bar4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+2)*LDA+(OB+0)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia15Bar1+V8+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=Ib15Bar1+ABx*Ib8Bar1+ABx*(ABx*Ib4Bar1+Ib8Bar1)+V23+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=ABx*Ic4Bar2+Ic8Bar2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia16Bar1+V18+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=Ib16Bar1+V24+V27+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=ABx*Ic4Bar3+Ic8Bar3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=ABx*Ia10Bar1+Ia18Bar1+V1+V2+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib18Bar1+V30+V31+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=ABx*Ic4Bar4+Ic8Bar4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+0)*LDA+(OB+1)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia12Bar1+ABy*Ia5Bar1+V13+V32+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=Ib12Bar1+V4+V7+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=ABy*Ic2Bar2+Ic6Bar2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia13Bar1+V33+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=Ib13Bar1+V14+V2+V7+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=ABy*Ic2Bar3+Ic6Bar3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia16Bar1+V34+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib16Bar1+V12+V19+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=ABy*Ic2Bar4+Ic6Bar4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+1)*LDA+(OB+1)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia13Bar1+V33+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=Ib13Bar1+V14+V17+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=ABy*Ic3Bar2+Ic7Bar2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia14Bar1+ABy*Ia7Bar1+V13+V32+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=Ib14Bar1+ABy*Ib7Bar1+V13+V17+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=ABy*Ic3Bar3+Ic7Bar3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia17Bar1+V35+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib17Bar1+V22+V36+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=ABy*Ic3Bar4+Ic7Bar4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+2)*LDA+(OB+1)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia16Bar1+V34+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=Ib16Bar1+V24+V27+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=ABy*Ic4Bar2+Ic9Bar2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia17Bar1+V35+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=Ib17Bar1+ABy*Ib9Bar1+V23+V27+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=ABy*Ic4Bar3+Ic9Bar3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=ABy*Ia10Bar1+Ia19Bar1+V13+V32+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib19Bar1+V30+V37+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=ABy*Ic4Bar4+Ic9Bar4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+0)*LDA+(OB+2)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia15Bar1+ABz*Ia5Bar1+V23+V38+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=Ib15Bar1+V12+V9+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=ABz*Ic2Bar2+Ic8Bar2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia16Bar1+V39+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=Ib16Bar1+V12+V19+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=ABz*Ic2Bar3+Ic8Bar3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia18Bar1+V40+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib18Bar1+V12+V2+V31+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=ABz*Ic2Bar4+Ic8Bar4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+1)*LDA+(OB+2)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia16Bar1+V39+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=Ib16Bar1+V19+V22+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=ABz*Ic3Bar2+Ic9Bar2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia17Bar1+ABz*Ia7Bar1+V23+V38+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=Ib17Bar1+V22+V36+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=ABz*Ic3Bar3+Ic9Bar3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=Ia19Bar1+V41+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=Ib19Bar1+V13+V22+V37+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=ABz*Ic3Bar4+Ic9Bar4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
      OffSet=(OA+2)*LDA+(OB+2)*LDB+(OC+0)*LDC+(OD+0)*LDD
      dI(OffSet,CrtSet1)=Ia18Bar1+V40+dI(OffSet,CrtSet1)
      dI(OffSet,CrtSet4)=Ib18Bar1+V30+V31+dI(OffSet,CrtSet4)
      dI(OffSet,CrtSet7)=Ic10Bar2+ABz*Ic4Bar2+dI(OffSet,CrtSet7)
      Tmp=-(dI(OffSet,CrtSet1)+dI(OffSet,CrtSet4)+dI(OffSet,CrtSet7))+dI(OffSet,CrtSet10)
      dI(OffSet,CrtSet10)=Tmp
            dI(OffSet,CrtSet2)=Ia19Bar1+V41+dI(OffSet,CrtSet2)
      dI(OffSet,CrtSet5)=Ib19Bar1+V30+V37+dI(OffSet,CrtSet5)
      dI(OffSet,CrtSet8)=Ic10Bar3+ABz*Ic4Bar3+dI(OffSet,CrtSet8)
      Tmp=-(dI(OffSet,CrtSet2)+dI(OffSet,CrtSet5)+dI(OffSet,CrtSet8))+dI(OffSet,CrtSet11)
      dI(OffSet,CrtSet11)=Tmp
            dI(OffSet,CrtSet3)=ABz*Ia10Bar1+Ia20Bar1+V23+V38+dI(OffSet,CrtSet3)
      dI(OffSet,CrtSet6)=ABz*Ib10Bar1+Ib20Bar1+V23+V30+dI(OffSet,CrtSet6)
      dI(OffSet,CrtSet9)=Ic10Bar4+ABz*Ic4Bar4+dI(OffSet,CrtSet9)
      Tmp=-(dI(OffSet,CrtSet3)+dI(OffSet,CrtSet6)+dI(OffSet,CrtSet9))+dI(OffSet,CrtSet12)
      dI(OffSet,CrtSet12)=Tmp
   END SUBROUTINE dInt3311
